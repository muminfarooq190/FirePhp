<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta property="fb:app_id" content="168534953203541"/>
  <meta name="page_fullname" content= 'RequestedTrips Show Page'  />
  
  <title>Trip #5058547 to Srinagar - TravelTriangle</title>

  <link href="https://assets.traveltriangle.com//assets/new_ui_images/favicon-272d35945da72afb1d18b254b1723e8b.ico" rel="shortcut icon" type="image/x-icon" />
  <link href="https://assets.traveltriangle.com//assets/new_ui_images/favicon-272d35945da72afb1d18b254b1723e8b.ico" rel="icon" type="image/x-icon" />

  <link href="https://assets.traveltriangle.com//assets/new_ui_css/agents/agent_dashboard-3c507a0e3d4d0431d0371c736f8cdf65.css" media="screen" rel="stylesheet" type="text/css" />

<!-- escalation matrix -->
  <script src="https://assets.traveltriangle.com//assets/agent/feedback/feedback-76e160e2be3b8ad5553b3e89bbd8b7e0.js" type="text/javascript"></script>
<!-- escalation matrix -->

  <script type="text/javascript">
    //todo find a better approach
    window.useRtms = true;
    window.rtmsUrl = 'wss://rtms.traveltriangle.com/connect/';
    window.rtmsAuthKey = '';

    var view_mode = '';
    if (view_mode == "dashboard") {
      $('meta[name=page_fullname]').attr('track', false);
    }
  </script>
  <script>
// window.addEventListener("load",function(){
    !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
            n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
        n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
            document,'script','//connect.facebook.net/en_US/fbevents.js');

    fbq('init', '526824380757665');
    fbq('track', "PageView");
     // },false);
     </script>
<noscript><img height="1" width="1" style="display:none"
               src="https://www.facebook.com/tr?id=526824380757665&ev=PageView&noscript=1"
/></noscript>
<!-- End Facebook Pixel Code
 -->

  <script>
  function fbq_event_trigger(event) {
      fbq('track', "CustomEvent", {event: event});
  }
</script>
    <!-- Start Visual Website Optimizer Asynchronous Code -->
<script type='text/javascript'>
var _vwo_code=(function(){
var account_id=274383,
settings_tolerance=2000,
library_tolerance=2500,
use_existing_jquery=false,
/* DO NOT EDIT BELOW THIS LINE */
f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);var a=d.createElement('style'),b='',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
</script>
<!-- End Visual Website Optimizer Asynchronous Code -->
  <script type="text/javascript">
  window.rtmsUrl = 'wss://rtms.traveltriangle.com/connect/';

  function getPlatformDetails(){
    var isMobileRequest = false;
    var isAndroidRequest = false;
    var isIosRequest = false;
    var segment_key = "", platform = "";

    var webview_request = false;

    if (webview_request){

      if(isIosRequest){
          segment_key = "2Gs16U2N88YJvFkIlKYvMtaZ1Mf3KlIc";
          platform = "Ios";
      }else{
        segment_key = "1bvFLF2DPGqFpN0PXcqnTEE9LZqXzt4k";
        platform = "Android";
      }
    }else{

      if(isMobileRequest){
        segment_key = "WtGPLltari0MpAz4CqSCMHuvTgeT05pB";
        platform = "MWeb";
      }else{
        segment_key = "UkXgrzVlOLb4I9DnctF3e0lvFoOrWcgc";
        platform = "Web";
      }
    }
    

    return { segment_key: segment_key, platform: platform}
  }

  var platformDetails = getPlatformDetails();

  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","timeout"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
    analytics.load(platformDetails.segment_key);
  }}();

  // Hold the current config, can be used as a link from application to js

  var SegmentConfig = {
    "platform": platformDetails.platform,
    "mobilePlatform": false,
    "eventURISeparator": "::",
    "pageTrackingId": "page-view-tracker",
    "all_global_vars" : {"trip_id":5058547,"user_id":278401,"user_role":"agent"},
    "all_noun_props" : {"Trip":{"created_at":"2019-06-16T12:03:34+05:30","from_location":"New Delhi,  Delhi","start_date":"2019-07-26","trip_days":4,"trip_stage":4,"op_id":56,"adult":4,"child":0,"budget":"20000..22000","is_test":false,"hotel_required":"Yes","flight_required":"No","hotel_category":"2 Star","booking_time":"in this week","cab_required":"Yes","type_of_tour":"Family"}},
    "segment_event_prefix_json" :  "",
    "trip_stage_mapping" : {"0":"NOT_SET","1":"TRIP_STAGE_TRIP_NOT_SURE","2":"TRIP_STAGE_DESTINATION_NOT_SURE","3":"TRIP_STAGE_DESTINATION_SURE","4":"TRIP_STAGE_FLIGHT_BOOKED_NEED_REMAIN_PACKAGE"}
  };
</script>

  <script src="https://assets.traveltriangle.com//assets/agent/desktop/booking_js/request_page_layout_js-f2cd0f600a4e9c89f9e0588b54ab3c07.js" type="text/javascript"></script>
<style>
.notificationReminder{
  display:flex;
  align-items: center;
  font-family: lato;
}
.quiteReminder{
  width:100%;
  display:inline-block;
}
.quiteReminder > div{
  float:right;
  position:relative;
}
.quiteReminder .quiteRemintderWraper {
    margin-bottom: 10px;
    background: #fff;
    width:340px;
    border-radius: 4px;
    box-shadow: 0 0 5px -2px #000;
    position: relative;
    padding: 15px 30px 20px 15px;
    transition: all .5s ease-in-out;
}
.closeQuiteReminder{
  position: absolute;
  top: 8px;
  right: 8px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: #d4d4d4;
  cursor: pointer;
  z-index:99;
}
.closeQuiteReminder:before{
    content: "";
    position: absolute;
    top: 9px;
    left: 5px;
    width: 10px;
    height: 1px;
    background: #000;
    transform: rotate(45deg);
}
.closeQuiteReminder:after{
    content: "";
    position: absolute;
    top: 9px;
    left: 5px;
    width: 10px;
    height: 1px;
    background: #000;
    transform: rotate(-45deg);
}
.notificationReminder .timerWraper{
  position: relative;
  min-width: 65px;
  height: 65px;
  background: #fff;
  border-radius: 100%;
  margin-right:16px;

}
.notificationReminder .timerWraper:before{
  content: "";
  display: block;
  width: 100%;
  height: 100%;
  border: 3px solid #d4d4d4;
  border-radius: 50%;
  box-sizing: border-box;
}
.timerWraper .barCanvash{
  position: absolute;
  top: 0;
  left: 0;
}
.watchTimerwraper{
  position:absolute;
  transform:translate(-50%,-50%);
  top:50%;
  left: 50%;
  text-align:center;
}
.watchTimerwraper .countDownTime{
 font-weight: bold;
 color:#3e3e3e;
 font-size: 14px;
}
.watchTimerwraper .contentTime{
  font-size:10px;
  color:#d4d4d4;
  float: left;
}
.remindWrapper{
  margin-bottom:15px;
  position:relative
}
.remindWrapper span{
  font-size:14px;
  color:#4dabf5;
  font-weight:bold;
  text-decoration:none;
  cursor:pointer
}
.reminderOpen span{
  font-size:14px;
  color:#4dabf5;
  font-weight:bold;
  text-decoration:none;
  cursor:pointer;
}
.remindWrapper .reminderTooltip {
    width: 170px;
    position: absolute;
    color: #3e3e3e;
    font-size: 14px;
    text-align: center;
    background: #e2e2e2;
    box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1);
    border-radius: 4px;
    right: -8px;
    top: -115px;
    display: none;
    z-index:99;
}
.remindWrapper span{
  white-space:nowrap
}
.reminderTooltip div{
  padding: 8px 0;
  cursor:pointer;
}
.reminderTooltip div:hover{
  background:#d4d4d4;
}
.reminderTooltip .rescheduleTimeCal{
  border-radius: 4px 4px 0 0;
}
.reminderTooltip .rescheduleTime1{
  border-radius: 0 0 4px 4px;
}
.reminderTripWraper{
margin-right:22px;
}
.reminderTripWraper .reminderUser{
  color: #3e3e3e;
  font-weight:900;
}
.reminderTripWraper #live-ticker-text,.reminderTripWraper #liveticker-trip-id{
  color: #3e3e3e;
}
.reminderTooltipWraper{
text-align:center;
}
#reminderWraper{
  position:fixed;
  right:15px;
  bottom:15px;
  z-index:999;
  max-width: 550px;
}
.schduleRemintderWraper{
  background:#efefef;
  padding: 8px 24px 8px 15px;
  border-radius:4px;
  box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.2);
  margin-bottom:8px;
}

.reminderCounts{
  display: none;
  font-size: 14px;
  color: #3e3e3e;
  background: #e4e4e4;
  padding: 5px 24px;
  text-align:right;
  font-style: italic;
  border-radius: 2px;
}
.overlayReminderPopup{
  position:fixed;
  width:100%;
  height:100%;
  top:0;
  left:0;
  background: rgba(0,0,0,0.6);
  z-index:9999;
  display:none;
}
.datePickerReminderWraper{
  position:absolute;
  transform: translate(-50%,-50%);
  top:50%;
  left:50%;
  background:#fff;
  border-radius: 4px;
  font-family:lato;
}
.datePickerReminderWraper .popupDateWraper{
padding: 0 80px 40px;
}
.datePickerReminderWraper .xdsoft_datetimepicker{
border:none!important;
}
.datePickerReminderWraper h1{
  font-size:20px;
  font-weight:bold;
  color:#fff;
  border-radius:4px 4px 0 0;
  background:#56c5c1;
  padding:12px 15px;
  margin:0;
  margin-bottom:32px;
}
.datePickerReminderWraper .xdsoft_datetimepicker{
  margin:0!important;
}
.datePickerReminderWraper .xdsoft_datetimepicker .xdsoft_datepicker{
  width:333px;
}
.datePickerReminderWraper .xdsoft_datetimepicker .xdsoft_calendar td>div{
padding: 8px 0;
}
.datePickerReminderWraper .xdsoft_datetimepicker .xdsoft_timepicker .xdsoft_time_box{
  height:215px;
}
.datePickerReminderWraper .xdsoft_datetimepicker .xdsoft_timepicker .xdsoft_time_box>div>div{
  height:30px;
  line-height:30px;
}
.datePickerReminderWraper .xdsoft_datetimepicker .xdsoft_mounthpicker{
  width:unset;
  height:34px;
}
.datePickerReminderWraper .reminderPopupBtn{
float: right;
padding:0 32px 24px 0;
}
.datePickerReminderWraper .reminderPopupBtn span{
  text-transform: uppercase;
  font-size: 16px;
  font-weight: bold;
  color: #4dabf5;
  cursor:pointer
}
.datePickerReminderWraper .reminderPopupBtn span:first-child{margin-right:48px;}
.datePickerReminderWraper .closeIconReminder{
position: absolute;
right:-24px;
width:15px;
height:15px;
cursor:pointer;
z-index:99999;
}
.datePickerReminderWraper .closeIconReminder:before{
  content: '';
  position: absolute;
  widtH: 2px;
  height: 15px;
  background: #fff;
  right:7px;
  transform: rotate(-45deg);
}
.datePickerReminderWraper .closeIconReminder:after{
  content: '';
  position: absolute;
  widtH: 2px;
  height: 15px;
  left:6px;
  background: #fff;
  transform: rotate(45deg);
}
.statusColor{
  color: #fff;
  font-weight: 900;
  font-size: 10px;
  padding: 3px 10px;
  border-radius: 2px;
  margin-right: 8px;
}

.rosterMsg{
  width: 350px;
  position: fixed;
  z-index: 99999999;
  padding: 0 10px;
  top:0;
  right:0;
  display:none;
}
.rosterMsg .tosterMid{
    width: 65%;
    margin-left: 80px;
    position: relative;
    float: left;
    font-family: Arial,Helvetica,sans-serif;
    font-size: 1em;
    text-align: left;
    padding: 10px 5px;
   
}
.rosterMsg .sucessRoster{
  width: 100%;
  min-height: 70px;
  overflow: hidden;
  margin: 10px 0;
  border-radius: 4px;
  position: relative;
  z-index: 2;
  color: #fff;
  opacity: .94;
  box-shadow: 2px 2px 10px rgba(0,0,0,.4);
}
.sucessRoster.active{
  background-color: #60bb71;  
}
.sucessRoster.errorMsg{
  background-color: #db6a64;  
}
.fadeIn {
    animation-name: fadeIn;
    animation-duration: .7s;
}
@keyframes mymove {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
.close-toastr {
  width: 10%;
  height: 100%;
  position: absolute;
  top: 20px;
  right: 0;
  background-color: transparent;
  font-size: 22px;
  line-height: 1;
  border: none;
  outline: none;
  text-align: center;
  color: #333;
  opacity: .5;
  vertical-align: baseline;
  cursor: pointer;
}
.rosterMsg .iconRight{
  display: inline-block;
  height: 40px;
  float: left;
  background-size: 100%;
  position: absolute;
  width: 40px;
  left: 15px;
  top: 10px;
}
.rosterMsg .iconRight.active{
  background-image: url("https://assets.traveltriangle.com//assets/new_ui_images/tick-49dadb6313e4ece187a2aaa654a3ea3e.svg");
}
.rosterMsg .iconRight.errorMsg{
  background-image: url("https://assets.traveltriangle.com//assets/new_ui_images/info-2902d05758d433053da921f5682ffb4f.svg");
}
.closeBtnX{width:24px; height:24px; position: relative;}
.closeBtnX:before {
    content: '';
    position: absolute;
    width: 2px;
    height: 24px;
    background: #fff;
    transform: rotate(45deg);
    top: 0px;
    left: 12px;
}
.closeBtnX:after {
    content: '';
    position: absolute;
    width: 2px;
    height: 24px;
    background: #fff;
    transform: rotate(-45deg);
    top: 0px;
    left: 12px;
}
.announcementNewtag{
  margin-left: 8px;
  border-radius: 8px;
  color: #fff;
  background: #e64c3b;
  display: inline-block;
  width: 37px;
  text-align: center;
  font-size: 10px;
  line-height: 16px;
}
.announcementLink a{
  display :flex;
  align-items: center;
}
</style>
  </head>
<body>
<div class="notice wFull toaster_msg justifyCenter alignCenter" id="toaster_msg" style="display: none;"><a class="flexFull m0" id="notice-msg"></a><span onclick="document.getElementById('toaster_msg').style.display='none';" class="fright cursorP" style="float: right">x</span></div>
<div class="loader-box-con image_class" id="agent_ajax_loading_id"></div>
<header id="header">
  <div class="container ">
    <div class="row">
      <div class="col-4" id="header-left">
        <div class="row">
              <div class="col-6">
              <div id="logo"><a href="https://traveltriangle.com/agents/dashboard"><span class="sprite-agent sprite-logo"></span>
              </a></div>
            </div>
            <div id="search" class="col-6" >
              <div class="seach-box">
                <input id="search_type" name="search_type" type="hidden" value="full" />
                <input class="gatracking" data-event="click" data-galocal-cta="Search" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" data-galocal-impersonatestatus="false" data-verb="Agent Clicked" id="global_search_field" maxlength="100" name="term" placeholder="Search" type="text" />
                <button><i class="fa fa-search" id = "search_button"></i></button>
              </div>
            </div>
        </div>
      </div>
      <div id="header-right" class="col-8">


        <ul id="top-nav" class="clear-fix top-nav-loggedin">

       <!-- <li> -->
          <!-- new icon added here -->
          <!-- <div class="combdivawardandiconplus"> -->
     <!--      <p class="newbannerfortag">New</p> -->
          <!-- <div class="imageiconforaward">
            <div class="overlayblankforhide">
            <div class="dropdownfornewiconaward">
              <div class="arrowwhitesmall">
              </div> --><!-- arrowwhitesmall -->
              <!-- <div class="sectiononhovershow">
                <p>News & Awards</p>
              </div> --><!-- sectiononhovershow -->
            <!-- </div> --><!-- dropdownfornewiconaward -->
            <!-- </div> -->
          <!-- </div> --><!-- imageiconforaward -->
          <!-- </div> --><!-- combdivawardandiconplus -->
     <!-- </li> -->

          <li>
            <a href="#" class="questionMarkButton">
              <!-- <span class="label-new">new</span> -->
            </a>
            <ul class="dropdown account_dropdown showHovered">
                <li>Queries/Feedbacks</li>
            </ul>
          </li>

          <li><a href="#" class="moneybag sprite-agent sprite-account-section-white-top"></a>

            <ul class="dropdown account_dropdown" id = "account_commission">
              <li><a href="/agents/278401/payment?action_id=dash_payments&amp;link_id=pl_statement" target="_blank">Accounts</a></li>
              <!--<li ></li>-->
              <!-- <li></li> -->
              <!-- <li><a href="#">My Calendar</a></li> -->
              <!-- <li><a href="#">My Inbox</a></li> -->
              <li><a href="/documents" target="_blank">Tax Invoices</a></li>
            </ul>
          </li>
          <li class="label-div"><a href="/agents/278401/view_report" class="statistic-chart sprite-agent sprite-statistic-main-icon" target="_blank"> </a><!-- <div class="label-new">New</div> -->
            <ul class="dropdown account_dropdown">
                <li>Statistics & Reports</li>
            </ul>
          </li>

          <li class="label-div"><a href="/agents/calendar" class="calendar sprite-agent sprite-white-calender-top" target="_blank"> </a><!-- <div class="label-new">New</div> -->
            <ul class="dropdown account_dropdown">
                <li>Calendar</li>
            </ul>
          </li>
          <li class="notification-menu"><a href="#" class="notification sprite-agent sprite-ringing-white-bell"></a><span id="notification-count" class="badge badge-red">0</span>
            <div class="dropdown-notifications">
              <div class="n-heading"><i class="fa fa-bell"></i>NOTIFICATIONS</div>   <!--n-heading-->
                <!-- <div class="n-categrioes-headings">
                  <div class="n-categrioes-parts">All <span>15</span></div>
                    <div class="n-categrioes-parts">Hot Followup <span>15</span></div>  n-categrioes-parts
                    <div class="n-categrioes-parts">Followup <span>15</span></div>
                    <div class="n-categrioes-parts">Booked <span>15</span></div>
                </div> --> <!--n-categrioes-headings-->
                <div class="details_div_con">
                </div>   <!--details_div_con-->

                <div class="details_div_con_main_2">
                    <p><a href="/agents/notifications_show" class="view_all js_ga_event_notification_view_all" target="_blank">View All</a></p>
                    <div class="clear"></div>
                    </div>  <!--details_div_con_main-->
                <div class="clear"></div>
            </div>   <!--dropdown-notifications-->
          </li>
            <li class="flightLinkHeader">
                <span class="center-spinner">
                    <span class="spinner-Wraper">
                        <span class="spinner-yellow">
                            <span class="bounce-sniper-wraper"></span>
                            <span class="double-bounce2-yellow"></span>
                        </span>
                    </span>
                    <span><a href="/agent/flights" data-event="click" data-galocal-category="Agent Header" data-galocal-section="Flight Icon" data-verb="Agent Clicked" id="flights-header-link" target="_blank">Flights</a></span>
                </span>
            </li>

          <li class="user-profile user-profile-updated">
            <!--<div class="user-dp"><img class="full-round" src="" alt=""/></div>-->
            <div class="row no-margin-row mb-10">
                <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                <div class="col-8 user-name-loggedin"><span>Fly Paradise Tours And Travels <i class="fa fa-angle-down user-name-loggedin-fa profile_down_icon"></i></span></div>
            </div>
            <ul class="dropdown" id = "my_profile_logout">
            <li class="li-without-img-link"><a href="/agents/3237383430312d466c79-Fly-Paradise-Tours-and-Travels" target="_blank">Public Profile View</a></li>
            <li class="li-without-img-link"><a href="/users/edit" target="_blank">Edit My Account</a></li>
            <li class="li-without-img-link"><a href="/users/password" target="_blank">Update Password</a></li>
              <li class="li-without-img-link"><a href="/requested_trips/5058547-Ashwani-Kumar?target=_blank">Profile Settings</a></li>
              <li class="li-without-img-link announcementLink"><a  href='https://traveltriangle.com/announcement/announcement.html' target='_blank'>Announcement <span class='announcementNewtag'>New</span></a></li>

              <!-- <li><a href="#">My Calendar</a></li> -->
              <!-- <li><a href="#">My Inbox</a></li> -->
              <li class='li-without-img-link logout'><a href="/users/sign_out">Sign Out</a></li>
              <li class="js-spocs-dashboardlinks row no-margin-row spocs-dashboardlinks">
              <ul>
              <li class="js-spocs-dashboardlinks-first spocs-dashboardlinks-first"><p class="spocs-dashboardlinks-heading">Spocs Dashboard <i class="fa fa-angle-down"></i></p></li>
                <div class="scroll_spoc_list">
                  <li>
                  <div class="row no-margin-row">
                    <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                    <div class="col-8 user-name-loggedin">
                    <a href="/agents/view_as_spoc">&lt;&lt;Me&gt;&gt;</a>
                    </div>
                  </div>
                </li>
                  <li>
                    <a href="/agents/view_as_spoc?sub_account_id=1629" class="spoc_name_list_item" data-name="Arifa">
                    <div class="row no-margin-row">
                      <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                      <div class="col-8 user-name-loggedin">
                        Arifa
                      </div>
                    </div>
</a>                  </li>
                  <li>
                    <a href="/agents/view_as_spoc?sub_account_id=2294" class="spoc_name_list_item" data-name="Fozia">
                    <div class="row no-margin-row">
                      <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                      <div class="col-8 user-name-loggedin">
                        Fozia
                      </div>
                    </div>
</a>                  </li>
                  <li>
                    <a href="/agents/view_as_spoc?sub_account_id=2292" class="spoc_name_list_item" data-name="Horia">
                    <div class="row no-margin-row">
                      <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                      <div class="col-8 user-name-loggedin">
                        Horia
                      </div>
                    </div>
</a>                  </li>
                  <li>
                    <a href="/agents/view_as_spoc?sub_account_id=2293" class="spoc_name_list_item" data-name="Insha">
                    <div class="row no-margin-row">
                      <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                      <div class="col-8 user-name-loggedin">
                        Insha
                      </div>
                    </div>
</a>                  </li>
                  <li>
                    <a href="/agents/view_as_spoc?sub_account_id=1632" class="spoc_name_list_item" data-name="Jumaira">
                    <div class="row no-margin-row">
                      <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                      <div class="col-8 user-name-loggedin">
                        Jumaira
                      </div>
                    </div>
</a>                  </li>
                  <li>
                    <a href="/agents/view_as_spoc?sub_account_id=2295" class="spoc_name_list_item" data-name="Maheen">
                    <div class="row no-margin-row">
                      <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                      <div class="col-8 user-name-loggedin">
                        Maheen
                      </div>
                    </div>
</a>                  </li>
                  <li>
                    <a href="/agents/view_as_spoc?sub_account_id=1631" class="spoc_name_list_item" data-name="Mohsina">
                    <div class="row no-margin-row">
                      <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                      <div class="col-8 user-name-loggedin">
                        Mohsina
                      </div>
                    </div>
</a>                  </li>
                  <li>
                    <a href="/agents/view_as_spoc?sub_account_id=1630" class="spoc_name_list_item" data-name="Sanna">
                    <div class="row no-margin-row">
                      <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                      <div class="col-8 user-name-loggedin">
                        Sanna
                      </div>
                    </div>
</a>                  </li>
                  <li>
                    <a href="/agents/view_as_spoc?sub_account_id=1633" class="spoc_name_list_item" data-name="sumair">
                    <div class="row no-margin-row">
                      <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                      <div class="col-8 user-name-loggedin">
                        sumair
                      </div>
                    </div>
</a>                  </li>
                  <li>
                    <a href="/agents/view_as_spoc?sub_account_id=2291" class="spoc_name_list_item" data-name="Tabiya">
                    <div class="row no-margin-row">
                      <div class="col-4 user-dp user-dp-loggedin"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></div>
                      <div class="col-8 user-name-loggedin">
                        Tabiya
                      </div>
                    </div>
</a>                  </li>
              </div>
              </ul>
              </li>
            </ul>



            </div>  <!-- spocs-dashboardlinks -->
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="security-feature-doc" style="display: none;"><a href="https://docs.google.com/presentation/d/1e4zmtdMxQg7dXodseIP9q2idD54ZTMfRji4iZ-f_urU/edit#slide=id.p" class="security-feature-doc-color" target="_blank">Security Doc</a></div>

</header>
<div class="overlayReminderPopup">
  <div class="datePickerReminderWraper">
  <span class="closeIconReminder"></span>
  <h1>Reschedule</h1>
   <div class="popupDateWraper">
   <input id="datetimepickerReminder" type="text" >
   <input type="hidden" class="reminderDateValue"/>
   </div>
   <div class="reminderPopupBtn">
   <span id="cancelPopupReminder">Cancel</span>
   <span id="ApplyPopupReminder">Apply</span>
   </div>
  </div>
</div>
<div id="reminderWraper">
<div class="quiteReminder"></div>
<div class="shedulereminderCon">
<div class="reminderCounts"></div>
<div class="scheduleReminder">
</div>
</div>
</div>
<div class="rosterMsg">
<div class='sucessRoster fadeIn'>
  <div>
  <span class="iconRight"></span>
  <div class='tosterMid'><p></p></div>
    <span class="close-toastr">✕</span>
  </div>
</div>
</div>
<script src="https://assets.traveltriangle.com//assets/new_ui_js/agents/agent_dashboard-c72baf045143ba48baee87aaa1fb4d94.js" type="text/javascript"></script>
<script src="https://assets.traveltriangle.com//assets/tinymce-d247a484109d0791474c511e227f0cab.js" type="text/javascript"></script>
<script type="text/javascript">
  $(".js-spocs-dashboardlinks-first").click(function(){
    $(this).find(".fa").toggleClass("rotate-180");
    $(".js-spocs-dashboardlinks").toggleClass("height-auto");
  });
</script>
<link href="https://assets.traveltriangle.com//assets/new_ui_css/agents/chat-online-966fecf640abc3f71a8482223e6ef253.css" media="screen" rel="stylesheet" type="text/css" />

<style type="text/css">
  .multiple-file-ui{
    background:rgba(0,0,0, 0.2);
    position:fixed;
    height:100%;
    width:100%;
    top: 0;
    left: 0;
    z-index: 2000;
  }
  .maultifile-popup{
    background: #fff none repeat scroll 0 0;
    border-radius: 5px;
    height: 100%;
    margin: 0 auto;
    max-height: 320px;
    max-width: 750px;
    overflow-y: auto;
    padding: 2px 30px 10px;
    position: relative;
    transform: translate(0px, 150px);
    width: 100%;
  }
  .multi-close-btn{
    padding: 5px 0;
    position: absolute;
    right: 10px;
    text-align: center;
    top: 10px;
    width: 30px;
  }
  .maultifile-popup h1{
    font-size:18px;
    font-weight:600;
    color:#000;
    margin-bottom:25px;
  }
  .maultifile-popup .file1{
    padding:10px 10px;
    background:#f6f6f6;
    margin:3px 0;
  }
  .maultifile-popup .file1 p{
    background: rgba(0, 0, 0, 0) url('https://img.traveltriangle.com//assets/download-icon-8cff423c5ccc3606d98eb26be3e939e5.png') no-repeat scroll 0 0;
    color: #3b3e4a;
    float: left;
    font-size: 14px;
    margin: 10px 0 0;
    padding-left: 26px;
    width: 210px;
  }
  .maultifile-popup .file1 input{
    border: 1px solid #b3b3b3;
    border-radius: 5px;
    max-width: 380px;
    overflow: hidden;
    padding: 8px 5px;
    width: 100%;
  }
  .maultifile-popup .file1 a{
    float: right;
    margin: 13px 10px 0 0;
  }
  .addmore-btn{
    background: rgba(0, 0, 0, 0) url('https://img.traveltriangle.com//assets/add-more-plus-7e49b2530febb2f4a5df4cbf902dd06a.png') no-repeat scroll 13px 14px;
    border: 1px solid #1781d5;
    border-radius: 5px;
    color: #1781d5;
    float: left;
    font-size: 14px;
    margin: 10px 0 0;
    padding: 13px 27px 13px 40px;
    text-decoration: none;
  }
  .mutilfile-send-btn{
    background:#24a39f;
    border-radius: 5px;
    color: #fff;
    float: right;
    font-size: 14px;
    margin: 10px 0 0;
    padding: 15px 40px;
    text-transform:uppercase;
    text-decoration: none;
  }
.message-send > p:after{
    position: absolute;
    background: url("https://img.traveltriangle.com//assets/chat_images/right-arrow-1bd09cf957f7ba7b28302fd8aee8f194.png") no-repeat;
    width:7px;
    height:7px;
    top:0;
    right:-5px;
    content: '';
    display: block;
  }
  .message-receive > p:after{
    position: absolute;
    background: url("https://img.traveltriangle.com//assets/chat_images/left-arrow-11ac9e30c337abf24ac5fa066da67b84.png") no-repeat;
    width:7px;
    height:7px;
    top:0;
    left:-5px;
    content: '';
    display: block;
  }
.chat-quote-nav.multiple-quote.active:after{
    position: absolute;
    background: url("https://img.traveltriangle.com//assets/chat_images/arrow-with-shadow-cd4263b43dc7b3484e1eecc07f48ae53.png") no-repeat;
    width: 13px;
    height: 7px;
    bottom: -7px;
    left: 50%;
    content: '';
    display: block;

}

.name-alphabet {
    width: 40px;
    height: 40px;
    background: #56C4C1;
    border-radius: 50%;
    color: #fff;
    font-size: 19px;
    font-weight: bold;
    text-align: center;
    line-height: 39px;
}
.message-send .name-alphabet{
  float: right;
  margin-left: 14px;
}
.message-receive .name-alphabet{
  float: left;
  margin-right: 11px;
}

i.chat-online-offline{
    height: 13px;
    position: absolute;
    top: 12px;
    left: 2px;
    width: 13px;
    background-image: url("https://img.traveltriangle.com//assets/chat_images/chat-icon-sprite-3dd69c289d527355b607a2c762149c03.png");
}

.chat-quote-nav.multiple-quote i.new-message {
    background: url("https://img.traveltriangle.com//assets/new_ui_images/agents/icons/chat-blue-d8d8864ba5e5a2cb2a563c0f7a7b114c.png") no-repeat;
    width: 14px;
    height: 14px;
    position: absolute;
    top: 7px;
    right: 3px;
}
.chat-quote-nav.multiple-quote i.new-message{
  display: none;
}
.chat-quote-nav.multiple-quote.new-message-recieved i.new-message{
  display: block;
}
.prev-quote-agent-chatbox {

   background-repeat: no-repeat;
  position: absolute;
  left: 0;
  width: 14px;
  height: 37px;
  top: 8px;
  z-index: 10;
  cursor: pointer;
  background-image: url('https://img.traveltriangle.com//assets/new_ui_images/agents/left-arrow-chat-admin-4f30da71cff61ca2a0bb68c418ee822c.png');
}
.next-quote-agent-chatbox {

   background-repeat: no-repeat;
  position: absolute;
  right: 0;
  width: 14px;
  height: 37px;
  top: 8px;
  z-index: 10;
  cursor: pointer;
    background-image: url('https://img.traveltriangle.com//assets/new_ui_images/agents/right-arrow-chat-admin-23f8919a34f5cc690cfd76b2cbf238fc.png');
}
.whatsapp-msg {
  background: #e3f0bb !important;
}
</style>



<div class="chat-wrapper">
  <div class="chat-stack-tab">
  <span class="sprite-agent sprite-chat-pink"></span>

    <span class="more-chat-window-text">3</span>
  </div>
    <div class="chat-stack-container">
    </div>

</div>
<div id="js_multifile" class="chat-attachment" style="display: none;">
  <div class="multiple-file-ui">
  <div class="maultifile-popup">
    <a class="multi-close-btn" href="#">X</a>
    <h1 class="attachment-header">File Upload</h1>
<form accept-charset="UTF-8" action="/comments" class="new_comment" data-remote="true" enctype="multipart/form-data" id="multifile_form_id" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="iDFjdQQhR2kReB8A5QUpAZtGOyH9c/iBXbFEbBdSOHE=" /></div>

    <input id="comment_title_id" name="comment[title]" type="hidden" value="" />
    <input id="comment_commentable_type" name="comment[commentable_type]" type="hidden" value="Quote" />
    <input id="comment_commentable_id" name="comment[commentable_id]" type="hidden" />
    <input id="comment_email" name="comment[email]" type="hidden" />
    <input id="comment_user_id" name="comment[user_id]" type="hidden" />
    <input id="quote_detail_cb" name="quote_detail_cb" type="hidden" value="true" />
    <input id="agent_chat_attachment" name="agent_chat_attachment" type="hidden" value="true" />

    <input id="js_popup_comment" name="comment[comment]" type="hidden" />

    <div class="fields">
        <div class="file1 fields">
          <input class="chat-file" id="chat-file-1" name="comment[attachments_attributes][0][file]" style="display: none;" type="file" />
          <p class="file-name"></p>
          <input id="comment_attachments_attributes_0_desc" name="comment[attachments_attributes][0][desc]" placeholder="File Description..." size="30" type="text" />
        </div>
</div>    <div class="js_add_fields_elem" id="js_add_fields_hidden" style="display: none;">
      <a href="javascript:void(0)" class="popup_attachment_fields add_nested_fields" data-association="attachments" data-blueprint-id="attachments_fields_blueprint">Add Attachment</a>
    </div>

    <!-- <a class="btn js_send_chat_popup">SEND</a> -->
    <div class="add-more-send-btn">
      <a class="addmore-btn" href="#">Change file</a>
      <a class="mutilfile-send-btn js_send_chat_popup agent-side" href="#">Send</a>
    </div>
    <input id="send-comment" name="commit" style="display: none;" type="submit" value="Submit" />
<div data-blueprint="&lt;div class=&quot;fields&quot;&gt;
        &lt;div class=&quot;file1 fields&quot;&gt;
          &lt;input class=&quot;chat-file&quot; id=&quot;chat-file-1&quot; name=&quot;comment[attachments_attributes][new_attachments][file]&quot; style=&quot;display: none;&quot; type=&quot;file&quot; /&gt;
          &lt;p class=&quot;file-name&quot;&gt;&lt;/p&gt;
          &lt;input id=&quot;comment_attachments_attributes_new_attachments_desc&quot; name=&quot;comment[attachments_attributes][new_attachments][desc]&quot; placeholder=&quot;File Description...&quot; size=&quot;30&quot; type=&quot;text&quot; /&gt;
        &lt;/div&gt;
&lt;/div&gt;" id="attachments_fields_blueprint" style="display: none"></div></form>  </div>
</div>

</div>
<script type="text/javascript">
  //open at max 3 chat windows
  var openWindowCount = 0;
  const MaxOpenWindowLimit = 8;

  function get_channel(traveller_id) {
    var message = "notification_" + traveller_id;
    return message;
  }

  function get_agent_channel() {
    return $.pubnub_channels["chat"];
  }

  const postComment = ({comment, title, quoteId, 
          commentType = 'Quote', userId, email, fromChatBox}) => {
          avoidLoadingOnPage(false);
          $.ajax({
            'type': "POST",
            'url': '/comments.js',
            'data': {
              'comment[comment]': comment,
              'comment[title]': title,
              'comment[commentable_id]': quoteId,
              'comment[commentable_type]': commentType,
              'comment[user_id]': parseInt(userId),
              'comment[email]': email,
              'from_chat_box': fromChatBox
            }
          });
          avoidLoadingOnPage(true);
  };

  async function publishOnRtmsChannel(channel, channelId, msgarray, message, quote_id, c_id, c_email, post_comment)
  {

    //todo: find channelId
    // const channel  = channelId;
    const online_class = `.online_${channel}-pnpres`;
     
    const subscription = await RtmsHelper.subscribeRTMS({channelId});
      // subscription.sendMessage({content: msgarray});

    // status is called multiple times
    // subscription.on('status', status => {
      // if (RtmsHelper.isRtmsUserOnline( {status} )) {
        if (post_comment) {
          const title = $(online_class).hasClass("online") ? '#chat' : "none";
          postComment({title, comment: message.message, quoteId: quote_id, userId: c_id,
            email: c_email, fromChatBox: true});
        }
        subscription.sendMessage({content: msgarray});

        // subscription.sendMessage({content: });

        //todo: logic for websocket 
        /*avoidLoadingOnPage(false);
          $.ajax({
            'type': "POST",
            'url': '/comments.js',
            'data': {
              'comment[comment]': message.message,
              'comment[title]': 'preferences_input_comment',
              'comment[commentable_id]': quote_id,
              'comment[commentable_type]': 'Quote',
              'comment[user_id]': parseInt(c_id),
              'comment[email]': c_email,
              'from_chat_box': true
            }
          });
          avoidLoadingOnPage(true);*/
      // }
    // });
  }

  function publishOnChannel(channel, msgarray, message, quote_id, c_id, c_email, post_comment)
  {
    var online_class = ".online_"+channel+"-pnpres";
  }

  function construct_attachments_attributes(attachment){
    attachments=[];
      attachments={

    }
  }

  function saveAndPublishAttachment(quote_id, trip_id, message, traveller_id, is_agent,attachment) {
    var c_email = getCookie("u_email");
    var c_id = getCookie("u_id");
    var userName = 'Fly Paradise Tours And Travels';
    var finalAttachment = [];
    attachment.forEach(function(attach){
      var obj = {};
      obj["file"] = attach[0];
      obj["file_name"] = attach[1];
      obj["type"] = attach[2];
      obj["file_size"] = attach[3];
      obj["desc"] = attach[4];
      finalAttachment.push(obj);
    });
    var msgarray = {
      _id: 0,
      attachments_attributes: finalAttachment,
      comment: message,
      commentBy: 'AGENT',
      commentable_type: 'Quote',
      commentable_id: parseInt(quote_id),
      created_at: new Date().toISOString().split('.')[0] + "+00:00",
      email: c_email,
      isPending: 0,
      notification_sub_category: "comment_added",
      user_image_path: "/pics/original/missing.png",
      role: 'agent',
      title: '#chat',
      user_id: parseInt(c_id),
      userId: parseInt(c_id),
      trip_id: trip_id,
      userName: userName
    };
     const t_channel = get_channel(traveller_id);

     if (RtmsHelper.useRtms) {
      publishOnRtmsChannel(t_channel, traveller_id, msgarray, message, quote_id, c_id, c_email,true);

    } else {
     
      var a_channel = get_agent_channel();
      publishOnChannelAttachment(t_channel, msgarray, message, quote_id, c_id, c_email,true);
    }
  }

  function publishOnChannelAttachment(channel, msgarray, message, quote_id, c_id, c_email, post_comment)
  {
    var online_class = ".online_"+channel+"-pnpres";
  }

  async function saveAndPublish(quote_id, trip_id, message, traveller_id, is_agent) {
    var c_email = getCookie("u_email");
    var c_id = getCookie("u_id");
    var userName = 'Fly Paradise Tours And Travels';

    var msgarray = {
      _id: 0,
      comment: message.message,
      commentBy: 'AGENT',
      commentable_type: 'Quote',
      commentable_id: parseInt(quote_id),
      created_at: new Date().toISOString().split('.')[0] + "+00:00",
      email: c_email,
      isPending: 0,
      notification_sub_category: "comment_added",
      user_image_path: "/pics/original/missing.png",
      role: 'agent',
      title: '#chat',
      user_id: parseInt(c_id),
      userId: parseInt(c_id),
      trip_id: trip_id,
      userName: userName
    };
    const t_channel = get_channel(traveller_id);

    if (RtmsHelper.useRtms) {
      // const subscription = await RtmsHelper.subscribeRTMS({channelId: traveller_id});
      // subscription.sendMessage({content: msgarray});
      publishOnRtmsChannel(t_channel, traveller_id, msgarray, message, quote_id, c_id, c_email,true);

      if(typeof is_agent !== 'undefined' && is_agent)
      {
        // todo: find use case may be not needed
        // publishOnRtmsChannel(a_channel, msgarray, message, quote_id, c_id, c_email, false);
      }

    } else {
      var a_channel = get_agent_channel();
      publishOnChannel(t_channel, msgarray, message, quote_id, c_id, c_email,true);
      if(typeof is_agent !== 'undefined' && is_agent)
      {
        publishOnChannel(a_channel, msgarray, message, quote_id, c_id, c_email, false);
      }
    }
  }

  function handleMinimizeFor(chatWindow, doNotHide) {
    var contentWrapper = chatWindow.getElementsByClassName("content-wrapper")[0];
    var blueStrip = chatWindow.getElementsByClassName('blue-strip')[0];
    var dest = blueStrip.getElementsByClassName('trip-destination')[0].innerHTML;
    if (!doNotHide && $(contentWrapper).is(':visible')) {
      var tm = $(contentWrapper).outerHeight();
      $(contentWrapper).hide();
      $(chatWindow).css("margin-top", "0px");
      if(typeof doNotHide === 'undefined') {
        _gaq.push(["_trackEvent", "Chat", "Chat_Minimize", blueStrip.getAttribute('data-trip_id') + '|' + dest]);
      }
      //$(chatWindow).css("height", 53);
    }
    else {
      var blueStrip = chatWindow.getElementsByClassName('blue-strip')[0];
      $(chatWindow).css("margin-top", "-294px");
      //$(chatWindow).css("height", 347);
      $(contentWrapper).show();
      if(typeof doNotHide === 'undefined'){
        _gaq.push(["_trackEvent","Chat","Chat_Maximize", blueStrip.getAttribute('data-trip_id') + '|' + dest]);
      }
    }
  }

  $(document).ready(function () {
    setUpListeners();
    openWindowCount = parseInt($(".chat-window").length);
  });

  function setUpListeners() {
    /*Unbind any previous event listners to prevent duplication*/
    $(".chat-window").unbind();
    $(".chat-typing-field textarea").unbind();
    $(".message-send-button").unbind();
    $(".chat-window").click(function (event) {
      switch (event.target.className) {
        case "close":
          $(this).toggle();
          /*remove the element from DOM*/
          removeChatWindowById(this.getAttribute('data-trip_id'),$(this).parent().find(".trip-destination").text());
          //openWindowCount--;
          break;
        case "minimize":
          handleMinimizeFor(this);
          break;
        case "traveller-name":
          handleMinimizeFor(this);
          break;
        case "trip-destination":
          handleMinimizeFor(this);
          break;
        case "clear":
          handleMinimizeFor(this);
          break;
        case String(event.target.className.match(/^blue-strip.*/)):
          handleMinimizeFor(this);
          break;
        default:
      }
    });
    var shiftHold = false;
    $(".chat-typing-field textarea").keydown(function(event){
      if(event.which == 16){
        shiftHold = true;
      }
    });
    $(".chat-typing-field textarea").keyup(function (event) {
      if (event.which == 13) {
        /* unbinding loading functionality for chat message to send*/
        if(!shiftHold){
          var currentChatWindow = $(this).parents(".chat-window")[0];
          QuoteTab = getCurrentQuoteChatTab(currentChatWindow);
          sendMessage(QuoteTab, {message: this.value.trim(), time: getTime(), commentBy: "AGENT"});
          this.value = '';
        }

      }
      if(event.which == 16){
        shiftHold = false;
      }

    });

    $(".message-send-button").click(function (event) {
      /* unbinding loading functionality for chat message to send*/
      var textarea = $(this).parent().children("textarea")[0];
      var currentChatWindow = $(this).parents(".chat-window")[0];
      QuoteTab = getCurrentQuoteChatTab(currentChatWindow);
      sendMessage(QuoteTab, {message: textarea.value.trim(), time: getTime(), commentBy: "AGENT"});
      textarea.value = '';
    });
  }

  function getCurrentQuoteChatTab(chatWindow){
    var chatContents = chatWindow.getElementsByClassName("chat-content");
      var alreadyOpenedQuote = false;
      var quoteTab;
      for (var i = 0; i < chatContents.length; i++) {
        if (chatContents[i].className.search('active')>=0) {
          quoteTab = chatContents[i];
          break;
        }
      }
      return quoteTab;
  }

  function textAreaAdjust() {
  }

  function sendMessage(chatWindow, message) {
    if (message.message.length >= 1)
     /* appendMessageInChatWindow(chatWindow, message.message, true, null,message.commentBy);*/
    saveAndPublish(chatWindow.getAttribute("data-commentable_id"), chatWindow.getAttribute("data-trip_id"), message, chatWindow.getAttribute("data-traveller_id"), true);

    if (message.attachment){
     saveAttachmentandPublish(chatWindow.getAttribute("data-commentable_id"), chatWindow.getAttribute("data-trip_id"), message, chatWindow.getAttribute("data-traveller_id"), true);
      appendMessageInChatWindow(chatWindow,'test files',true,null,message.commentBy);
    }
  }

  function appendAttachmentMessageinChatWindow(chatWindow, msg,msgAttachment, isSending, user_image, agentCheck,senderUserName,messageTime){
    if(msg == "")
    {
      return;
    }

    msg = replaceURLWithHTMLLinks(msg);
    if(!$(chatWindow).hasClass("active")){
      // chat tab is not active
      var quoteId = chatWindow.getAttribute("data-commentable_id");
      $(".chat-quote-nav[id ="+quoteId+"]").addClass("new-message-recieved");
    }

    var chatContent  = chatWindow;
    var currentTime =  new Date();
    if(messageTime){
      currentTime = new Date(messageTime)
    }
    if(previousmsg == msg && agentCheck == "AGENT" && (currentTime.getTime() <= prevTime.getTime()+3000) ){
      return;
    }
    prevTime = currentTime;
    var newMessage;
    if (isSending){
      msgAttachment.forEach(function(key,index){
       newMessage = SendingAttachment(msg, msgAttachment[index],currentTime);
        addFinalMessagetoChatWindow(newMessage,agentCheck,chatContent);
      });

    }
    else {
      msgAttachment.forEach(function (key, index) {
        newMessage = ReceivedAttachment(msg, msgAttachment[index], currentTime, user_image,senderUserName);
        addFinalMessagetoChatWindow(newMessage, agentCheck, chatContent);
      });
    }

    previousmsg = msg;
    //var contentWrapper = chatWindow.getElementsByClassName("content-wrapper")[0];
    newMessage.scrollIntoView();
  }

  function addFinalMessagetoChatWindow(newMessage,agentCheck,chatContent){
    if(agentCheck == "AGENT"){
      newMessage.classList.remove("message-receive");
      newMessage.classList.add("message-send");
    }
    chatContent.appendChild(newMessage);
  }

  function open_rchatwindow(msgData, data) {
    $.c_image_url = data['image_url'];
    /*var chatWindowContainer = document.getElementsByClassName("chat-wrapper")[0];
    var activeChatWindow = chatWindowContainer.getElementsByClassName("chat-window");
    var isWindowOpen = false;
    var chatWindow;
    for (var i = 0; i < activeChatWindow.length; i++) {

      if (activeChatWindow[i].id == msgData.trip_id) {
        isWindowOpen = true;
        chatWindow = activeChatWindow[i];
        break;
      }
    }*/
    var chatWindow = checkIfChatWindowAlreadyExixt(msgData.trip_id);
    if (chatWindow) {
      //append the mesage
      var chatContents = chatWindow.getElementsByClassName("chat-content");
      var quoteTab;
      for (var i = 0; i < chatContents.length; i++) {
        if (chatContents[i]['id'] == msgData.commentable_id) {
          quoteTab = chatContents[i];
        }
      }
      var isSending = false
      if(msgData.commentBy == "AGENT")
      { isSending = true ;}
      if (msgData.attachments_attributes != undefined && msgData.attachments_attributes.length >0){
        appendAttachmentMessageinChatWindow(quoteTab,msgData.comment,msgData.attachments_attributes,isSending,msgData.user_image_path,msgData.commentBy,msgData.userName,msgData.created_at);
      }
      else {
        appendMessageInChatWindow(quoteTab, msgData.comment, isSending, msgData.user_image_path, msgData.commentBy, msgData.userName,msgData.created_at, msgData.title.indexOf('#whatsapp') !== -1);
      }//un-minimize it
      handleMinimizeFor(chatWindow, doNotHide = true);
    }
    /*else {
      //if more chat windows can be accomodated
      if (openWindowCount < MaxOpenWindowLimit) {
        openWindowCount++;
        //open a new chat window and append the message
        var chatWindow = new ChatWindow(msgData);
        chatWindowContainer.appendChild(chatWindow);
        setUpListeners();
        var chatContents = chatWindow.getElementsByClassName("chat-content");
        var quoteTab;
        for (var i = 0; i < chatContents.length; i++) {
          if (chatContents[i]['id'] == msgData.commentable_id) {
            quoteTab = chatContents[i];
          }
        }
        appendMessageInChatWindow(quoteTab, msgData.comment, false, msgData.user_image_path);
        var otherQuotes = ["1234","2345","34667"];
        var quoteChatContainer = chatWindow.getElementsByClassName("quote-chat-container");
        var greyStrip = chatWindow.getElementsByClassName("grey-strip");

        otherQuotes.forEach(function(key,index){
          var quoteTab = createElements("div", "chat-content");
          quoteTab.setAttribute("id",key);
          quoteTab.setAttribute("data-commentable_id", key);
          quoteTab.setAttribute("data-trip_id", msgData.trip_id);
          quoteTab.setAttribute("data-traveller_id", msgData.user_id);
          quoteTab.classList.add("chat-quote-tab-hide");
          quoteChatContainer[0].appendChild(quoteTab);

          var quoteTabNav = createElements("span");
          quoteTabNav.setAttribute("id", key);
          quoteTabNav.classList.add("chat-quote-nav");
          quoteTabNav.textContent = "Quote "+(index+1);
          greyStrip[0].appendChild(quoteTabNav);

        });
      }
      else {
      }
    }*/
  }
  var previousmsg , prevTime;
  function appendMessageInChatWindow(chatWindow, msg, isSending, user_image, agentCheck, senderUserName, messageTime, is_whatsapp_msg) {
    //var chatContent = chatWindow.getElementsByClassName("chat-content")[0];

    if(msg == "")
    {
      return;
    }

    msg = replaceURLWithHTMLLinks(msg);
    if(!$(chatWindow).hasClass("active")){
      // chat tab is not active
      var quoteId = chatWindow.getAttribute("data-commentable_id");
      $(".chat-quote-nav[id ="+quoteId+"]").addClass("new-message-recieved");
    }
    var tripId = chatWindow.getAttribute("data-trip_id");
    if($(".blue-strip.active").attr("data-trip_id") != tripId){
      $(".blue-strip[data-trip_id = "+tripId+"]").addClass("first-time-opened");
    }
    var chatContent  = chatWindow;
    var currentTime =  new Date();
    if(messageTime){
      currentTime = new Date(messageTime);
    }
    if(previousmsg == msg && agentCheck == "AGENT" && (currentTime - prevTime < 1000) ){
      return;
    }
    prevTime = currentTime;
    if (isSending)
      var newMessage = SendingMessage(msg, currentTime, is_whatsapp_msg);
    else
      var newMessage = ReceivedMessage(msg, currentTime, user_image, senderUserName, is_whatsapp_msg);
    if(agentCheck == "AGENT"){
       newMessage.classList.remove("message-receive");
       newMessage.classList.add("message-send");
    }
    chatContent.appendChild(newMessage);
    previousmsg = msg;
    //var contentWrapper = chatWindow.getElementsByClassName("content-wrapper")[0];
    newMessage.scrollIntoView();
  }

  var MonthsHash = {
    "1" : "Jan","2" : "Feb","3" : "Mar","4" : "Apr","5" : "May","6" : "Jun","7" : "Jul","8" : "Aug","9" : "Sep","10" : "Oct","11" : "Nov","12" : "Dec",
  };

  function getTimeString(timeStamp){
    if(timeStamp.toLocaleDateString() != new Date().toLocaleDateString()){
//      var arr = timeStamp.toLocaleDateString().split('/');
      var timeString = MonthsHash[timeStamp.getMonth()+1] +" "+ timeStamp.getDate()+ ", " + timeStamp.toLocaleTimeString();
    }else{
      var timeString = timeStamp.toLocaleTimeString();
    }
    return timeString;
  }

function ReceivedAttachment(msgreceived,messageAttachment,receivingtime, user_image,userName) {

  var messageReceive = createElements("div", "message-receive");
  var picIcon = createElements("a");
  //picIcon.setAttribute("href", "#");

  if(!user_image){
    var picImg = createElements("img");
    $(picImg).error(function () {
      picImg.setAttribute("src", "https://img.traveltriangle.com//assets/new_ui_images/user_pic-68x68-f96571ade1f0a68ce9a0f8f155730b75.png");
    });
    picImg.setAttribute("src", user_image);
  }else{
    var firstLatter = userName.substr(0,1);
    var picImg = createElements("div","name-alphabet");
    picImg.innerHTML = firstLatter;
  }

  picIcon.appendChild(picImg);
  messageReceive.appendChild(picIcon);
  var msg = createElements("p");
  var timeString = getTimeString(receivingtime);
    if(messageAttachment != undefined) {
      if (messageAttachment.type == 'application/pdf') {
        var imageIcon = "<img src='https://img.traveltriangle.com//assets/new_ui_images/my_request_pages/pdf-attached-3da918ed0e115755af15ca8b6c5c7db5.png'>"
      }
      else if (messageAttachment.type.search(/^image\/(?:jpeg|jpg|gif|png)$/) == 0) {
        var imageIcon = "<img src='" + messageAttachment.file + "'>"
      }
      else {
        var imageIcon = "<img src='https://img.traveltriangle.com//assets/new_ui_images/my_request_pages/doc-attached-218fac3b4cb552ddb6ee51575961b254.png'>"
      }
      var AttachHTML = "<div class='attached-image-agent-side'><a target='_blank' href=' " + messageAttachment.file + "'>" + imageIcon + "</a></div><div class='attached-image-name-agent-side'><span class='downoad-attchement' style='max-width: 100px;'><a target='_blank' href='" + messageAttachment.file + "'>" + messageAttachment.file_name + "</a></span><p>"+ messageAttachment.desc +"</p><span class='chat-msg-time'>" + timeString + "</span></div>";
      msg.innerHTML = AttachHTML;
    }
  else {
      msg.innerHTML = msgreceived + "<span class='chat-msg-time'>" + timeString + "</span>";
    }
      messageReceive.appendChild(msg);
  return messageReceive;
}

  function ReceivedMessage(msgreceived, receivingtime, user_image, userName, is_whatsapp_msg) {
    var messageReceive = createElements("div", "message-receive");
    var picIcon = createElements("a");
    //picIcon.setAttribute("href", "#");
    if(!user_image){
      var picImg = createElements("img");
      $(picImg).error(function () {
        picImg.setAttribute("src", "https://img.traveltriangle.com//assets/new_ui_images/user_pic-68x68-f96571ade1f0a68ce9a0f8f155730b75.png");
      });
      picImg.setAttribute("src", user_image);
    }else{
      var firstLatter = userName.substr(0,1);
      var picImg = createElements("div","name-alphabet");
      picImg.innerHTML = firstLatter;
    }
    picIcon.appendChild(picImg);
    messageReceive.appendChild(picIcon);
    var msg = is_whatsapp_msg ? createElements("p", "whatsapp-msg") : createElements("p");
    //msgreceived.replace(/(?:\r\n|\r|\n)/g, '<br />');
    var time = getTimeString(receivingtime);
    msg.innerHTML = msgreceived + "<span class='chat-msg-time'>"+ time+"</span>";;
    messageReceive.appendChild(msg);
    /*var time = createElements("span");
    time.innerHTML = receivingtime;
    messageReceive.appendChild(time);*/
    return messageReceive;
  }

  function SendingMessage(message, sendingtime, is_whatsapp_msg) {
    var messageSend = createElements("div", "message-send");
    var picIcon = createElements("a");
    //picIcon.setAttribute("href", "#");
    var picImg = createElements("img");

    $(picImg).error(function () {
      picImg.setAttribute("src", "https://img.traveltriangle.com//assets/new_ui_images/user_pic-68x68-f96571ade1f0a68ce9a0f8f155730b75.png");
    });
    picImg.setAttribute("src", $.c_image_url);

    picIcon.appendChild(picImg);
    messageSend.appendChild(picIcon);
    var msg = is_whatsapp_msg ? createElements("p", "whatsapp-msg") : createElements("p");
    var timeString = getTimeString(sendingtime);
    msg.innerHTML = message + "<span class='chat-msg-time'>"+ timeString+"</span>";
    messageSend.appendChild(msg);
    // var time = createElements("span");
    // time.innerHTML = sendingtime;
    //messageSend.appendChild(time);
    return messageSend;
  }

  function SendingAttachment(message,messageAttachment,sendingtime) {
    var messageSend = createElements("div", "message-send");
    var picIcon = createElements("a");
    //picIcon.setAttribute("href", "#");
    var picImg = createElements("img");
    $(picImg).error(function () {
      picImg.setAttribute("src", "https://img.traveltriangle.com//assets/new_ui_images/user_pic-68x68-f96571ade1f0a68ce9a0f8f155730b75.png");
    });
    picImg.setAttribute("src", $.c_image_url);

    picIcon.appendChild(picImg);
    messageSend.appendChild(picIcon);
    var msg = createElements("p");
    var timeString = getTimeString(sendingtime);
    //msg.innerHTML = message
    if (messageAttachment != undefined) {
      if (messageAttachment.type == 'application/pdf') {
        var imageIcon = "<img src='https://img.traveltriangle.com//assets/new_ui_images/my_request_pages/pdf-attached-3da918ed0e115755af15ca8b6c5c7db5.png'>"
      }
      else if (messageAttachment.type.search(/^image\/(?:jpeg|jpg|gif|png)$/) == 0) {
        var imageIcon = "<img src='" + messageAttachment.file + "'>"
      }
      else {
        var imageIcon = "<img src='https://img.traveltriangle.com//assets/new_ui_images/my_request_pages/doc-attached-218fac3b4cb552ddb6ee51575961b254.png'>"
      }

      var AttachHTML = "<div class='attached-image-agent-side'><a target='_blank' href=' " + messageAttachment.file + "'>" + imageIcon + "</a></div><div class='attached-image-name-agent-side'><span class='downoad-attchement' style='max-width: 100px;'><a target='_blank' href='" + messageAttachment.file + "'>" + messageAttachment.file_name + "</a></span><div class='clearfix'></div><p>"+ messageAttachment.desc +"</p><span class='chat-msg-time'>" + timeString + "</span></div>";

      msg.innerHTML = AttachHTML;
    }
    else {
      msg.innerHTML = message + "<span class='chat-msg-time'>" + timeString + "</span>";
    }
    messageSend.appendChild(msg);

    //messageSend.appendChild(attach);
    // var time = createElements("span");
    // time.innerHTML = sendingtime;
    //messageSend.appendChild(time);
    return messageSend;
  }

 function checkIfChatWindowAlreadyExixt(tripId){
    var chatWindowContainer = document.getElementsByClassName("chat-wrapper")[0];
    var activeChatWindow = chatWindowContainer.getElementsByClassName("chat-window");
    var chatWindow;
    for (var i = 0; i < activeChatWindow.length; i++) {
      if (activeChatWindow[i].id == tripId) {
        chatWindow = activeChatWindow[i];
        return chatWindow;
      }
    }
    return null;
 }

  function decideIfAppendInChatWindow(quoteTab, msgData){
    //if(msgData.commentBy != "AGENT"){
    var isSending = false
    if(msgData.commentBy == "AGENT")
    { isSending = true ;}
    if (msgData.attachments_attributes != undefined && msgData.attachments_attributes.length > 0){
      appendAttachmentMessageinChatWindow(quoteTab,msgData.comment,msgData.attachments_attributes,isSending,msgData.user_image_path,msgData.commentBy,msgData.userName,msgData.created_at);
    }
    else {
      appendMessageInChatWindow(quoteTab, msgData.comment, isSending, msgData.user_image_path, msgData.commentBy, msgData.userName, msgData.created_at);
    }//}
  }

  function open_new_chatWindow(msgData,quote_ids, quote_prices, quote_perperson, trip_status, trip_rating_color, trip_loc, isTraveller, quote_currencies) {
    _gaq.push(["_trackEvent","Chat","Chat_First", msgData.trip_id.toString() + '|' + trip_loc]);
        var param_for_chat_in_new_window = {};
        param_for_chat_in_new_window.msgData = msgData;
        param_for_chat_in_new_window.quote_ids = quote_ids;
        param_for_chat_in_new_window.quote_prices = quote_prices;
        param_for_chat_in_new_window.quote_perperson = quote_perperson;
        param_for_chat_in_new_window.trip_status = trip_status;
        param_for_chat_in_new_window.trip_rating_color = trip_rating_color;
        param_for_chat_in_new_window.trip_loc = trip_loc;
        param_for_chat_in_new_window.isTraveller = isTraveller;
        param_for_chat_in_new_window.quote_currencies = quote_currencies;
        var showQuote,
        count,
        $obj,
        quoteLength;

    var chatWindowContainer = document.getElementsByClassName("chat-wrapper")[0];
    var Chat_Stack_Container = document.getElementsByClassName("chat-stack-container")[0];
    var chatWindow = checkIfChatWindowAlreadyExixt(msgData.trip_id);
    if (chatWindow) {
      //append the mesage
      var chatContents = chatWindow.getElementsByClassName("chat-content");
      var quoteTab;
      for (var i = 0; i < chatContents.length; i++) {
        if (chatContents[i]['id'] == msgData.commentable_id) {
          quoteTab = chatContents[i];
        }
      }
      decideIfAppendInChatWindow(quoteTab, msgData);
      //appendMessageInChatWindow(quoteTab, msgData.comment, false, msgData.user_image_path);
      //un-minimize it
      handleMinimizeFor(chatWindow, doNotHide = true);
    }
    else {
      //if more chat windows can be accomodated
      if (openWindowCount < MaxOpenWindowLimit) {
        openWindowCount++;
        var chat_stack_element = new Chat_Stack_Container_Element(msgData,trip_loc);
        Chat_Stack_Container.appendChild(chat_stack_element);

        if(openWindowCount > 3){
          $(".chat-stack-tab").addClass("active");
          $(".chat-stack-tab span.more-chat-window-text").text(" "+openWindowCount-3);
          // need to dock the first chat window.
          var firstDisplayWindow = $(".chat-window.active")[0];
          firstDisplayWindow.classList.remove("active");
          $(".chat-stack-element[data-trip_id = "+firstDisplayWindow.id+"]").addClass("active");
       }

        //open a new chat window and append the message

        var chatWindow = new ChatWindow(msgData, trip_status, trip_rating_color, trip_loc,isTraveller,param_for_chat_in_new_window);
        chatWindowContainer.appendChild(chatWindow);
        setUpListeners();

        var quoteChatContainer = chatWindow.getElementsByClassName("quote-chat-container");
        var greyStrip = chatWindow.getElementsByClassName("grey-strip");
        if(quote_ids.length){
          if(quote_ids.length == 4){
            $("div.chat-window").width(360);
          }
          for(var i=0; i<quote_ids.length;i++){

              var quoteTab = createElements("div", "chat-content");
              quoteTab.setAttribute("id",quote_ids[i]);
              quoteTab.setAttribute("data-commentable_id", quote_ids[i]);
              quoteTab.setAttribute("data-trip_id", msgData.trip_id);
              quoteTab.setAttribute("data-traveller_id", msgData.user_id);
              quoteTab.classList.add("chat-quote-tab");
              if(quote_ids[i] == msgData.commentable_id){
                quoteTab.classList.add("active");
                decideIfAppendInChatWindow(quoteTab, msgData);
              }
              quoteChatContainer[0].appendChild(quoteTab);

              var quoteTabNav = createElements("span");
              quoteTabNav.setAttribute("id", quote_ids[i]);
              quoteTabNav.setAttribute("data-trip_id", msgData.trip_id);
              quoteTabNav.classList.add("chat-quote-nav");
              if(quote_ids[i] == msgData.commentable_id){
                quoteTabNav.classList.add("active");

              }
              if(quote_ids.length == 1){
                quoteTabNav.classList.add("single-quote");
                quoteTabNav.innerHTML = "<span class='quote-text'>Quote"+(i+1) + "</span><span class='right'> <span class='price'>" + get_currency_font_awesome_js(quote_currencies[i]) + quote_prices[i] + " </span><span class='quote-per-person'> " + quote_perperson[i]+"</span></span>";
              }else{
                quoteTabNav.classList.add("multiple-quote");
                quoteTabNav.innerHTML = "<span class='quote-text'>Quote"+(i+1) + " </span><span class='price'> " + get_currency_font_awesome_js(quote_currencies[i]) + quote_prices[i] + " </span><br> <span class='quote-per-person'> " + quote_perperson[i] + "</span><i class='new-message'></i>";
              }
              greyStrip[0].appendChild(quoteTabNav);

          }
          var greyStripHeight = $(".chat-window[data-trip_id="+msgData.trip_id+"] .grey-strip").outerHeight();
          var textFieldHeight = $(".chat-window[data-trip_id="+msgData.trip_id+"] .chat-typing-field").outerHeight();
          var textAreaHeight = $(".chat-window[data-trip_id="+msgData.trip_id+"] .content-wrapper").height()- (greyStripHeight + textFieldHeight);
          $(".chat-window[data-trip_id="+msgData.trip_id+"] .chat-content").outerHeight(textAreaHeight-5);

        }

        //var chatContents = chatWindow.getElementsByClassName("chat-content");
        /*var quoteTab;
        for (var i = 0; i < chatContents.length; i++) {
          if (chatContents[i]['id'] == msgData.commentable_id) {
            quoteTab = chatContents[i];
          }
        }*/

       // decideIfAppendInChatWindow(quoteTab, msgData);
        //appendMessageInChatWindow(quoteTab, msgData.comment, false, msgData.user_image_path);


      }
      else {
      }
    }

    showQuote=3,
    count = 0,
    quoteLength= $(".chat-quote-nav").length;
     if (quoteLength==4){
           $(".chat-quote-nav").slice(showQuote).hide();
         $(".chat-quote-nav:last").prev().append("<span  class ='next-quote-agent-chatbox' id= 'next'></span>");
     }

    function toggle(){
      $obj=$(".chat-quote-nav");
      $obj.hide().slice(count,(count+showQuote)).show();
    }
    $(document).on("click",'#prev, #next',function(){
          if($(this).attr('id')=='next' ) {
              count==0?count=1:count=1;
              $(".chat-quote-nav:first").next().append("<span  class ='prev-quote-agent-chatbox' id='prev'></span>");
              $(".chat-quote-nav:last").prev().find('.next-quote-agent-chatbox').remove();
          } else {
              count==1?count=0:count=0;
               $(".chat-quote-nav:last").prev().append("<span  class ='next-quote-agent-chatbox' id= 'next'></span>");
              $(".chat-quote-nav:first").next().find('.prev-quote-agent-chatbox').remove();

          }
  toggle();
});




  }

  $(".chat-quote-nav").live('click',function(){
    var id = this.id;
    $(this).removeClass("new-message-recieved");
    var tripId = this.getAttribute("data-trip_id");
    $(".chat-quote-nav[data-trip_id ="+tripId+"]").removeClass("active");
    $(this).addClass("active");
    $(".chat-quote-tab[data-trip_id ="+tripId+"]").removeClass("active");
    $(".chat-quote-tab[id ="+ id +"]").addClass("active");

    if ($(".chat-quote-tab[id ="+ id +"]").children().length == 0 ) {
      $.getJSON('/requested_trips/get_all_comments_detail_current_quote.json', {
        requested_trip_id: tripId,
        quote_id: id
      }, function (data) {
        data.forEach(function (key, index) {
          var data = {};
          data['image_url'] = 'https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100';
          open_rchatwindow(key, data);
        });
      })
    }
  });

  $(".chat-wrapper").on("click",".chat-stack-tab",function(event){
    event.stopPropagation();
    //var Chat_Stack_Container = document.getElementsByClassName("chat-stack-container")[0];
    if($(".chat-stack-container").hasClass("active")){
      $(".chat-stack-container").removeClass("active")
    }else{
      $(".chat-stack-container").addClass("active");
    }
  });

  $(".chat-stack-container").on("click",".chat-stack-element.active",function(){
    var tripId = this.getAttribute("data-trip_id");
    $(".chat-stack-element[data-trip_id ="+tripId+"]").removeClass("active");
    var firstDisplayWindow = $(".chat-window.active")[0];
    firstDisplayWindow.classList.remove("active");
    $(".chat-stack-element[data-trip_id = "+firstDisplayWindow.id+"]").addClass("active");
    var chatWindow = $(".chat-window[data-trip_id = "+tripId+"]").clone();
    $(".chat-window[data-trip_id = "+tripId+"]").remove();
    $(".chat-wrapper").append(chatWindow);
    $(".chat-window[data-trip_id = "+tripId+"]").addClass("active");
    setUpListeners();

  });

  $(".chat-typing-field textarea").live("click",function(event){
    var tripId = $(this).parent().parent().parent().attr("data-trip_id");
    $(".blue-strip[data-trip_id = "+tripId+"]").removeClass("first-time-opened");
  });

   $(".chat-window.active").live("click",function(event){
    $(".blue-strip").removeClass("active");
    var tripId = $(this).attr("data-trip_id");
    $(".blue-strip[data-trip_id = "+tripId+"]").addClass("active");
    $(".blue-strip[data-trip_id = "+tripId+"]").removeClass("first-time-opened");
  });

  function removeChatWindowById(id,dest){;
    _gaq.push(["_trackEvent","Chat","Chat_Closed", id+'|'+dest]);
    openWindowCount--;
    $(".chat-window[data-trip_id = "+id+"]").remove();
    $(".chat-stack-element[data-trip_id = "+id+"]").remove();
    $(".js_ga_event_chat_TripId_"+id).remove();
    $(".chat-stack-tab span.more-chat-window-text").text("  "+openWindowCount-3);
    if(openWindowCount<=3){
      //not display the side stack
      $(".chat-stack-tab").removeClass("active");
    }
    if($(".chat-window.active").length<3){
        if($(".chat-stack-element.active").length){
          var id = $(".chat-stack-element.active")[0].getAttribute('data-trip_id');
          $(".chat-stack-element[data-trip_id = "+id+"]").removeClass("active");
          $(".chat-window[data-trip_id = "+id+"]").addClass("active");
        }
    }
  }

  $(".chat-stack-container").on("click",".chat-stack-element .close-chat-window",function(event){
      event.stopPropagation();
      removeChatWindowById($(this).parent().attr('data-trip_id'),$(this).parent().find(".trip-destination").text());
  });

  function Chat_Stack_Container_Element(msgData,dest){
    var chat_stack_element = document.createElement("div");
    chat_stack_element.className = "chat-stack-element";
    chat_stack_element.setAttribute("data-trip_id", msgData.trip_id);
    chat_stack_element.setAttribute("data-traveller_id", msgData.user_id);
    chat_stack_element.setAttribute("data-user_name", msgData.userName);
    chat_stack_element.setAttribute("data-dest_name", dest);
    chat_stack_element.setAttribute("id", msgData.trip_id)

    chat_stack_element.innerHTML = "<span class='stack-el-name'>"+msgData.userName+"</span><a class='close-chat-window' href='#'>x</a><br><span class='stack-el-dest'>"+dest+"</span>";
    /*var closeBtn = document.createElement("a");
    closeBtn.setAttribute("href", "#");
    closeBtn.className = "close";
    closeBtn.innerHTML = "x";
    chat_stack_element.appendChild(closeBtn); */

    return chat_stack_element;
  }

  function ChatWindow(msgData, trip_status, trip_rating_color, trip_loc, isTraveller, param_for_chat_in_new_window) {
      //create a new chat window
      var chatWindow = document.createElement("div");
      //Two hidden fields for quote_id and trip id
      //chatWindow.setAttribute("data-commentable_id", msgData.commentable_id);
      chatWindow.setAttribute("data-trip_id", msgData.trip_id);
      chatWindow.setAttribute("data-traveller_id", msgData.user_id);
      chatWindow.setAttribute("data-user_name", msgData.userName);
      chatWindow.setAttribute("id", msgData.trip_id)
      chatWindow.className = "chat-window";
      chatWindow.classList.add("active");

      var tripStage = createElements("div","trip-stage");
      tripStage.classList.add(trip_rating_color);
      tripStage.innerHTML = trip_status;
      chatWindow.appendChild(tripStage);

      //var notification_channel = '';

      var blueStrip = document.createElement("div");
      blueStrip.setAttribute("data-trip_id", msgData.trip_id);
      blueStrip.className = "blue-strip";
      if(isTraveller){
        blueStrip.classList.add("first-time-opened");
      }
      /*var chatIcon = document.createElement("div");
      chatIcon.className = "chaticon";
      var chatPic = document.createElement("img");
      chatPic.setAttribute("src", " https://img.traveltriangle.com//assets/chat_images/chaticon-7818d24b1973384a03c0dfa903bba1db.png");
      chatIcon.appendChild(chatPic);
      blueStrip.appendChild(chatIcon);*/
    const channelId = msgData.user_id;
    const chat_window_channel = `online_notification_${channelId}-pnpres`;
    const onlineIcon = createElements("i",`chat-online-offline ${chat_window_channel}`);
    blueStrip.appendChild(onlineIcon);
    

    const onStatus =  isOnline => {
        const selector = `.${chat_window_channel}`;

        RtmsHelper.toggleUserAvailability({isOnline, selector});
    };
    
    if (RtmsHelper.useRtms) {
      RtmsHelper.subscribeRTMS({channelId, onStatus});
    }

      var user = document.createElement("a");
       user.className = "traveller-name";
      //user.setAttribute("href", "/requested_trips/" + msgData.trip_id);
      user.innerHTML = msgData.userName;
      blueStrip.appendChild(user);

      var cross = document.createElement("div")
      cross.className = "cross";

      var minimize = document.createElement("a");
      //minimize.setAttribute("href", "#");
      minimize.className = "minimize";
      minimize.innerHTML = "-";

      var close = document.createElement("a");
      //close.setAttribute("href", "#");
      close.className = "close";
      close.innerHTML = "x";

      cross.appendChild(minimize);
      cross.appendChild(close);

      blueStrip.appendChild(cross);

      var clear = document.createElement("div");
      clear.className = "clear";

      var tripDestination = createElements("span","trip-destination");
      tripDestination.innerHTML = trip_loc;
      var tripDetails = createElements("span","trip-details js_ga_event_chat_TripId_"+msgData.trip_id);
     tripDetails.setAttribute("onclick",function(){_gaq.push(["_trackEvent","Chat","Chat_Tripid",  msgData.trip_id.toString() + '|'+trip_loc ]);});
      var hyperlink = createElements("a");
      hyperlink.innerHTML = "(Trip Id  "+msgData.trip_id+")";
      /*hyperlink.setAttribute("href","/requested_trips/" + msgData.trip_id + "?fromPrevChat=true");*/
      hyperlink.setAttribute("onclick", "setMsgParam(event, " + msgData.trip_id + "," + JSON.stringify(param_for_chat_in_new_window) + ")");
      /*hyperlink.setAttribute("target","_blank");*/
      tripDetails.appendChild(hyperlink);

      clear.appendChild(tripDestination);
      clear.appendChild(tripDetails);

      blueStrip.appendChild(clear);
      chatWindow.appendChild(blueStrip);

      var contentWrapper = document.createElement("div");
      contentWrapper.className = "content-wrapper";
      var greyStrip = document.createElement("div");
      greyStrip.className = "grey-strip";

      contentWrapper.appendChild(greyStrip);

      var quoteChatContainer = createElements("div", "quote-chat-container");
      contentWrapper.appendChild(quoteChatContainer);
      var chatTypingField = createElements("div", "chat-typing-field");
      var textArea = createElements("textArea");
      textArea.setAttribute("onkeyup", "textAreaAdjust(this)");
      textArea.setAttribute("style", "overflow:hidden");
      textArea.setAttribute("placeholder", "Type Your Comment");
      var filefield=createElements("input","chat_file_field");
      filefield.setAttribute("type","file");
      filefield.setAttribute("style","display:none");
      filefield.setAttribute("multiple","true");
      filefield.setAttribute("id","chat_file_attachments");
      filefield.setAttribute("onchange",'send_attachment_messages(event)');
      var attachIcon = createElements("a");
      attachIcon.setAttribute("href", "#");
      attachIcon.className = "message-attachment-button";
      var attachImage = createElements("img","chat_upload_icon");
      attachImage.setAttribute("src", "https://img.traveltriangle.com//assets/chat_images/attachment-42b2fd28bf2cf5302697d1d99c0d8e39.png");
      attachIcon.appendChild(attachImage);
      attachIcon.appendChild(filefield);

      chatTypingField.appendChild(textArea);
      chatTypingField.appendChild(attachIcon);
      contentWrapper.appendChild(chatTypingField);
      chatWindow.appendChild(contentWrapper);
      return chatWindow;
  }
  function setMsgParam(e, tripId, param_for_chat_in_new_window){
        var quote_id, lastCommentDiv,commentBy, comment, commentTime,  lastComment, paramObj;
        quote_id = $(".chat-quote-nav.active[data-trip_id="+tripId+"]").attr("id");
        lastCommentDiv = $(".chat-quote-tab.active[data-commentable_id ="+quote_id+"]").children().last();
        if(lastCommentDiv.length > 0) {
          if(lastCommentDiv.hasClass("message-send")) {
            commentBy = "AGENT";
          }else {
            commentBy = "TRAVELER";
          }
          lastComment = lastCommentDiv.find('p');
          comment = lastComment.html().substr(0,lastComment.html().indexOf("<span"));
          commentTime = lastComment.find('span').text();
          paramObj = param_for_chat_in_new_window.msgData;
          paramObj.comment = comment;
          paramObj.commentBy = commentBy;
          paramObj.created_at = commentTime;
          paramObj.commentable_id = quote_id;
        }
        window.sessionStorage.setItem("paramForChat"+tripId, JSON.stringify(param_for_chat_in_new_window));
        window.open("/requested_trips/" + tripId + "?fromPrevChat=true");
  }
  function createElements(tag, classname) {
    var obj = document.createElement(tag);
    if (classname)
      obj.className = classname;
    return obj;
  }
  function getTime() {
    return Date.now();
  }
  $("div.grey-strip span.chat-quote-nav").live('click',function(){
    var id = this.getAttribute("id");
    //console.log(id);
  });

  $(document).on("click",function(event){
    if($(".chat-stack-container").hasClass("active")){
      //container Opened;
      $(".chat-stack-container").removeClass("active");
    }
  })

  $('.chat_upload_icon').live('click',function (event) {
  /*$('#chat_file_attachments').trigger("click");*/
    var c_email = getCookie("u_email");
    var c_id = getCookie("u_id");
    var textarea = $(event.target).parent().parent().children("textarea")[0];
    var currentChatWindow = $(event.target).parents(".chat-window")[0];
    var blueStrip = currentChatWindow.getElementsByClassName('blue-strip')[0];
    var dest = blueStrip.getElementsByClassName('trip-destination')[0].innerHTML;
    var cuurr=$(event.target).parents(".chat-window").find(".chat-quote-nav.active").attr('id');
//      console.log(currentChatWindow.getElementsByClassName("chat-content"));
    QuoteTab = getCurrentQuoteChatTab(currentChatWindow);
    var traveler_id=QuoteTab.getAttribute("data-traveller_id");
    var t_channel = get_channel(traveler_id);
    var online_class = ".online_"+t_channel+"-pnpres";
    var comment_title = $(online_class).hasClass("online") ? '#chat' : "none";
    document.getElementById('comment_title_id').value = comment_title;
    document.getElementById('comment_commentable_id').value = QuoteTab.getAttribute("data-commentable_id");
    document.getElementById('comment_email').value = c_email;
    document.getElementById('comment_user_id').value = c_id;
    document.getElementById('js_popup_comment').value = 'Attachment';
    _gaq.push(["_trackEvent", "Chat", "Chat_Attachment", blueStrip.getAttribute('data-trip_id') + '|' + dest]);
    $('#chat-file-1').trigger("click");

  });

  $(document).on("change", "#chat-file-1", function(e) {
    $("#js_multifile").show();
    $(this).next().text($(this).val().replace(/C:\\fakepath\\/i, ''));
  });

  $(document).on("change", ".chat-file", function(e) {
    $(this).next().text($(this).val().replace(/C:\\fakepath\\/i, ''));
  });

  $('.addmore-btn').click(function () {
    $("#js_add_fields_hidden").children().click();
    $(".chat-file")[$(".chat-file").size()-1].click();
  });

  $('.js_send_chat_popup').click(function () {
    if ($('#js_popup_comment').val() == '') $('#js_popup_comment').val('Files Uploaded');
    if (typeof _gaq_quote_chat != "undefined") {_gaq_quote_chat("send");}
    var trip_id = $(".blue-strip.active").attr("data-trip_id");
    var dest = $(".blue-strip.active .trip-destination").text()
    _gaq.push(["_trackEvent", "Chat", "Chat_Upload",trip_id +'|'+ dest]);
    $("#js_multifile").hide();
    $('#ajax_loading_id').show();
    $('#multifile_form_id').submit();
  });

  function remove_fields(link) {
      $(link).prev("input[type=hidden]").val("1");
      $(link).closest(".fields").hide();
  }

  function add_fields(link, association, content) {
    var new_id = new Date().getTime();
    var regexp = new RegExp("new_" + association, "g");
    $(link).parents('.js_add_fields_elem').before($("<div />").html(content.replace(regexp, new_id)).text());
  }
  $(document).on('click', function(e) {
    if (!$(e.target).closest('#js_multifile').length) {
      $("#chat-file-1").val(null);
      $('#js_multifile').hide();
    }
  });

  $('.maultifile-popup').click(function(e) {
    e.stopPropagation();
  });

  $('.multi-close-btn').click(function(e) {
    $('#js_multifile').hide();
    $(".chat-file").val(null);
  });
</script>


<style>
body{
  background:#eaf1f1!important;
}
.panelbt{
  border-top: 1px dashed #9f9f9f!important;
}
.sidebar-box.content-box{
  margin-bottom: 8px;
}
.alignCenter{
  align-items: center;
}
.colorLink{
  color: #0677f1;
}
/* Puneet Css Start */
.invoiceEditAction{
  background: #fe7774;
  height: 32px;
  min-width: 151px;
  align-items: center;
  border-radius: 2px;
  margin-left: 24px;
  color: #fff !IMPORTANT;
}

.content-box{
  margin-bottom:10px;
}
/* Puneet Css End*/
</style>
<link href="https://assets.traveltriangle.com//assets/agent_ttsn_dashboard_elements/style-b153db6b4c6667e5777f07fd981f9fb1.css" media="screen" rel="stylesheet" type="text/css" />




<!-- flash message on submission of request to TTSN for quote -->

<!-- flash message ends -->

<div class="container">
  <div class="clearfix action-summary action-summary-large" style="display: none" id="post_summary_full" >
   </div>
  <div id="trip-update">
    <link href="https://assets.traveltriangle.com//assets/theme/checkboxCustom-cb45f0b8eeb2b41a592e325221f113bb.css" media="screen" rel="stylesheet" type="text/css" />
<style>
  .trip-footer-name{
    float: left;
    margin: 9px 10px;
  }
  .trip-footer-name h4{
    font-size: 13px;
    font-weight: 600;
    color: #434343;
  }
  .dp-ul{
    right: -115px;
    top: -10px;
    position: relative;
  }
  .alignBaseline{align-items: baseline;}
  .newShortListTag{background: #e64c3b; color: #fff!important;border-radius: 8px;min-width: 24px;height: 15px;line-height: 15px;text-align: center; display: inline-block;}
</style>
<div class="row">
  <div class="col-8 trip-id-wrap wrapspaceforquotation">
    <div class="trip-id" style="width: 340px;">
      <h2 class = 'header-strip-height'> <span class="trip-rate green-text">Converted</span> <div class='flex alignBaseline'> <span class='f14 mr4'>TRIP ID  5058547 </span><a class="wishlist" href="#"><i class="fa fa-heart"></i></a> <span class="pfc4 fw4 f10 fitalic">Updated over 2 years ago</span></div>
      </h2>
    </div>
    <div class="trip-info infofortripnew" id = "quote_seen_followup_5058547">
      <!--<h3 class="trip-name"><#%= trip.user.get_calling_name_by_id.gsub(' ', '_') + "_" + trip.start_date.strftime("%d_%m_%Y") %></h3>-->
        <div class="main-follow-quote">
  <div class="quote-follow-div-outer header-strip-height">
    <div class="quote-seen quote-follow-div tooltip showHover" id = "quote-seen-5058547">
      <div class="quote-follow-div-img">
        <span class="quote-follow-div-icon sprite-agent sprite-green-traveler-eye-show"></span>
      </div>
      <div class="quote-follow-div-content">
        <!--<p class="quote-follow-div-text quote-follow-div-text-msg">Quote seen</p>-->
        <p class="quote-follow-div-text quote-follow-div-sub-text"> Quote Worth Rs. 17,500 seen over 2 years ago</p>
      </div>
      <div class="tooltiptext">
        <label class="last-note">
          Quote seen at: 20 June 2019 03:12 PM
        </label>
      </div>
    </div>
  </div>
  <div class="quote-follow-div-outer header-strip-height">
    <div class="follow-up-required quote-follow-div tooltip showHover" id = "follow-up-required-5058547">
      <div class="quote-follow-div-img">
        <span class="quote-follow-div-icon sprite-agent sprite-not-clock-grey-icon"></span>
      </div>
      <div class="quote-follow-div-content">
        <p class="quote-follow-div-text quote-follow-div-text-msg">Follow Up Required</p>
        <p class="quote-follow-div-text quote-follow-div-sub-text"> over 2 years ago </p>
      </div>
      <div class="tooltiptext">
            <label class="last-note">Last note</label>
            <p class="trav-det">  </p>
            <label class="note-date"> 17 June 2019 at 06:58 PM </label>
        <p class="note-msg"><span class="note-tooltip-icon sprite-agent new_note_tooltip_icon"></span>Add note after follow up</p>
      </div>
    </div>
  </div>
</div>
<script>
  $("#quote-seen-5058547").on('mouseenter', function(){
    _gaq.push(["_trackEvent","Follow_up_booster ","Quote_Seen ",'Srinagar|Kashmir|5058547|278401']);
  });
  $("#follow-up-required-5058547").on('mouseenter', function(){
    _gaq.push(["_trackEvent","Follow_up_booster ","Follow_up_required ",'Srinagar|Kashmir|5058547|278401']);
  });
  $("#last-followed-up-5058547").on('mouseenter', function(){
    _gaq.push(["_trackEvent","Follow_up_booster ","Last_followed_up ",'Srinagar|Kashmir|5058547|278401']);
  });
  $("#quote-not-seen-5058547").on('mouseenter', function(){
    _gaq.push(["_trackEvent","Follow_up_booster ","Quote_Unseen ",'Srinagar|Kashmir|5058547|278401']);
  });
</script>


<style>
  .quote-seen.quote-follow-div.tooltip {
    position: relative;
    opacity: inherit;
    z-index: inherit;
    font: inherit;
    text-align: inherit;
  }
</style>

    </div>
  </div>
  <div class="col-1 pl0 pr0">
    <ul class="dp-ul dp-ul-position">
      <script type="text/javascript">
  var spocList = JSON.parse(null);

  var spcoSearchId = "#trip-detail-spoc-search-5058547";
  $(spcoSearchId).on("input", function(){
    var key = $(this).val();
    var tripId = $(this).attr('data-tripId');
    var list = $(".employee-list");
    list.html("");

    if(key == "" || key == undefined) {
      for(var i = 0; i < spocList.length; i++) {
        generateSpocHtml(spocList[i], list, tripId);
      }
    } else {
      for(var i = 0; i < spocList.length; i++) {
        if(spocList[i]["name"].toLowerCase().includes(key)) {
          generateSpocHtml(spocList[i], list, tripId);
        }
      }
    }
  });

  function generateSpocHtml(spoc, list, tripId) {
    var trip_id = tripId;
    var name = "";
    var id = "";

    if(spoc["id"] == "" || spoc["id"] == undefined) {
      id = 278401;
    } else {
      id = spoc["id"];
    }

    if(spoc["name"] != "" || spoc["name"] != undefined) {
      name = spoc["name"].replace(/\s+/g, '&nbsp;');
    }

    var html =
      '<li class="clear-fix" style="cursor:pointer" onclick=select_sub_account(' + trip_id +','+id+',"'+ name + '")>' +
      '<div class="emp-dp"><span class="sprite-agent sprite-back-ground-person"></span></div>' +
      '<div class="emp-meta"><h4 class="emp-name">'+ name + '<span class="emp-location"></span></h4></div></li>';
    list.append(html);
  }

  function select_sub_account(trip_id, sub_account_id, spoc_name)
  {
    var spoc_class = '.spoc_name_'+ trip_id;
    $(spoc_class + ' h4').text(spoc_name);
    $.ajax({
      url: "/agents/278401-Fly-paradise-tours-and-travels/assign_account",
      data: {requested_trip_id: trip_id, sub_account_id: sub_account_id},
      method: 'POST',
      dataType: 'script',
      success: function(){
      }
    });

  }
</script>

<style>
  .spocSearchInput {
    background: #efefef;
    padding: 8px;
  }
  .spocSearchInput .spoc-search {
    margin: 0;
    padding: 6px 8px;
    font-size: 10px;
    line-height: 12px;
    height: auto;
    border-radius: 2px;
    -webkit-border-radius: 2px;
    -moz-border-radius: 2px;
  }
</style>

    </ul>
  </div>
  <div class="col-3 trip-advisor">
    <div class="fr">
      <div class="trip-advisor-dp">



            <img alt="Pic_pro" class="full-round" src="https://img.traveltriangle.com/attachments/users/174235/original/PIC_pro.JPG?tr=,w-100,h-100" />





      </div>
      <h4 title="Shubham Singh">TT Advisior : Shubham S... <span class="last-spoken">Last Spoken : 03-08-2019</span></h4>
    </div>
    <div class="clr"></div>
  </div>
</div>

<script>

    var is_shortlisted = 'false' ;

      is_shortlisted = '' ;

    // Populate trip shortlisted
    if(is_shortlisted == 'true') {
        $("#tripDetailShortList").prop('checked', true);
    }

    // Mark Trip as shortlisted/un-shortlisted
    $("#tripDetailShortList").click(function(){
        var params = {};
        params["trip_ids"] = [5058547];
        params["is_shortlisted"] = $("#tripDetailShortList").prop('checked');
        $.post("/agents/v2/mark_shortlisted/", params, function(response, status){
          if(response.data.success) {
              if (params["is_shortlisted"] == true) {
                  alert("Trip has been shortlisted successfully.");
              } else {
                  alert("Trip has been un-shortlisted successfully.");
              }
          } else {
              alert("Failed to update the Trip. Please try again later.");
          }
        });
    });

</script>

  </div>

  <div class="row">
    <div id = "traveller_view" class="col-9" style="display: none; padding-bottom:15px;">
      <div class = "Traveller-view-content">
 <div style="padding: 10px;">
        <p class="heading-traveler-text-h"  id = "toggle-traveler-minus"><span><img src="https://img.traveltriangle.com//assets/new_ui_images/agents/minus-1145edc9d370a5cdc1259d47af607840.png"></span>Traveler views</p>
           <a href="#" class="button1 button2 red fr" id="back_to_trip">Back to Trip</a>
   <div class="clear"></div>
 </div>
 <!--tabscontent-starts-from-here---->
  <div id = "toggle-tabs-div">
 <div class="tabsContainer">
  <ul class="tab listing-tabs">
  <li><a class="tablinks tablinks-new active" onclick="openCity(event, 'quote')" style="cursor: pointer;">Quote</a></li>
  <li><a class="tablinks tablinks-new" onclick="openCity(event, 'email')" style="cursor: pointer;">Email</a></li>
</ul>
        <div id="email" class="tabcontent container-show-tab" style="display: none;">
          <p class="inner-headingText" ><span>Email Subject: </span>Request ID XXXXXX : Check your XXXXXX quote of ammount for location by agent XXXXXX </p>
         <div class="tab-inner-content">
           <div class="js-device-view-container device-view-container">
            <span style="padding-left: 33px;">
           <img src="">
             <!-- <img class="lazy" data-original=""> -->
            </span>
           </div>
        </div><!--tab-inner-content-->
        </div><!--tabcontent container-show-tab-->


        <div id="quote" class="tabcontent container-show-tab" style="display:block;">
           <div class="tab-inner-content">
        <div class="traveler-device-container" align="center">
        <div class="radio_field_device">
          <input type="radio" name="my-radio-views-device" class="my-radio-views-device" id="radio-option-4" checked/>
          <label for="radio-option-4">
          <span class="round-check-span sprite-agent"></span>
          <span class="device-image-span-1 sprite-agent sprite-for-desktop-small"></span> <p class="desktop-view-text">Desktop</p> </label>
        </div>
        <div class="radio_field_device">
          <input type="radio" name="my-radio-views-device" class="my-radio-views-device" id="radio-option-5"/>
          <label  for="radio-option-5">
          <span class="round-check-span sprite-agent"></span>
          <span class="device-image-span-2 sprite-agent sprite-for-mobile-site"></span> <p class="mobile-view-text"> Mobile App </p> </label>
        </div>
        <div class="radio_field_device">
          <input type="radio" name="my-radio-views-device" class="my-radio-views-device" id="radio-option-6"/>
          <label for="radio-option-6">
          <span class="round-check-span sprite-agent"></span>
          <span class="device-image-span-2 sprite-agent sprite-for-mobile-site"></span> <p class="mobile-view-text">Mobile Site</p> </label>
        </div>
        <div class="clear"></div>
        </div><!-- traveler-device-container -->
        <div class="device-view-container">
          <div id = "device-1">
         <!--  <img class="lazy" data-original=""> -->
<img src="">
            
          </div>
          <div id = "device-3" style="display: none;">
          <div class="frame-div">
          <!--  <img class="lazy" data-original=""> -->
         <img src="">
          </div>
          </div>
          <div id = "device-2" style="display: none;">
          <div class="frame-div">
         <!--   <img class="lazy" data-original=""> -->
         <img src="">
          </div>
          </div>
        </div>
        </div><!--tab-inner-content-->
        </div><!--tabcontent container-show-tab-->
</div><!--tabsContainer-->

                <!-- radio-code- button starts here -->
                <div class="radioCode">
                <p class="radioCodetext">Do you like traveler view feature ?</p>
                <div class="clear">
                <div class="radio_field">
                  <input type="radio" class="traveler-view-feature-radio" name="my-radio-like" id="radio-option-1"/>
                  <label for="radio-option-1"> <span></span> Yes </label>
                </div>
                <div class="radio_field">
                  <input type="radio" class="traveler-view-feature-radio" name="my-radio-like" id="radio-option-2"/>
                  <label for="radio-option-2"> <span></span> No </label>
                </div>
                <div class="radio_field">
                  <input type="radio" class="traveler-view-feature-radio" name="my-radio-like" id="radio-option-3"/>
                  <label for="radio-option-3"> <span></span> I don't know </label>
                </div>
                </div>
                <div class="clear"></div>
                </div>
      <div>


      </div>
  </div>
</div>

<script>
function openCity(evt, evntName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(evntName).style.display = "block";
    evt.currentTarget.className += " active";
  if(evntName == "quote"){
    _gaq.push(["_trackEvent","Traveler_view ","Quote_view",'5058547|4|278401']);
  }
  else{
    _gaq.push(["_trackEvent","Traveler_view ","Email_view",'5058547|4|278401']);
  }
}
    $("#radio-option-4").on('click', function(){
      $("#device-1").css('display', 'block');
      $("#device-2").css("display", "none");
      $("#device-3").css("display", 'none');
      _gaq.push(["_trackEvent","Traveler_view ","Desktop",'4|278401']);
    });
    $("#radio-option-5").on('click', function(){
      $("#device-1").css('display', 'none');
      $("#device-2").css("display", "block");
      $("#device-3").css("display", 'none');
      _gaq.push(["_trackEvent","Traveler_view ","Mobile App",'4|278401']);
    });
    $("#radio-option-6").on('click', function(){
      $("#device-1").css('display', 'none');
      $("#device-2").css("display", "none");
      $("#device-3").css("display", 'block');
      _gaq.push(["_trackEvent","Traveler_view ","Mobile Site",'4|278401']);
    });
    $("#radio-option-1").on('click', function(){
        $(".radioCode").fadeOut();
      var funnel_stage = getFunnelStage("Yes");
      _gaq.push(["_trackEvent","Traveler_view ","Feedback",funnel_stage]);
    });
    $("#radio-option-2").on('click', function(){
        $(".radioCode").fadeOut();
      var funnel_stage = getFunnelStage("No");
      _gaq.push(["_trackEvent","Traveler_view ","Feedback",funnel_stage]);
    });
    $("#radio-option-3").on('click', function(){
        $(".radioCode").fadeOut();
      var funnel_stage = getFunnelStage("Maybe");
      _gaq.push(["_trackEvent","Traveler_view ","Feedback",funnel_stage]);
    });
    function getFunnelStage(feed){
      if(document.getElementById("quote").style.display == "block"){
       var quote_email = "quote";
      }
      else{
        var quote_email = "email";
      }
      if(quote_email=="quote"){
        if($("#radio-option-6").prop("checked") == true){
          var fs = "Mobile Site|"+feed+"|"+quote_email;

        }
        else if($("#radio-option-5").prop("checked") == true){
          var fs = "Mobile App|"+feed+"|"+quote_email;
        }
        else{
          var fs = "Desktop|"+feed+"|"+quote_email;

        }
      }
      else{
        var fs = feed+"|"+quote_email;
      }
      return fs;
    }
$("#toggle-traveler-minus").on('click', function(){
  var img = $(this).children().children();
  if( img.attr("src") != 'https://img.traveltriangle.com//assets/new_ui_images/agents/plus-f5501c435e675faf076bd60f1439acbd.png'){
    img.attr("src", 'https://img.traveltriangle.com//assets/new_ui_images/agents/plus-f5501c435e675faf076bd60f1439acbd.png');

  }
  else{
    img.attr("src", 'https://img.traveltriangle.com//assets/new_ui_images/agents/minus-1145edc9d370a5cdc1259d47af607840.png');
  }
  $("#toggle-tabs-div").slideToggle();
});
</script>

    </div>
    <div class="col-3" id="right-sidebar" style="padding-left: 15px; padding-right:8px;">
      <div id="request-quote-from-ttsn"></div>
        <link href="https://assets.traveltriangle.com//assets/new_ui_css/agents/upload_pan_passport_documents-1599760e3955ee7e141d716da1d9ceb7.css" media="screen" rel="stylesheet" type="text/css" />

<div class="traveler-detail-overlay" style="display: none"></div>


<div class="sidebar-box content-box  clear-fix new-trav-detail" id="traveler-detail">
  <div class="trav-detail-tooltip" style="display: none">
    <span class="tiparrow"><span></span></span>

    <div class="trav-det-step1" style="display: none">
      <h3>Get more information about the traveler here</h3>

      <p>Use this information for better sales experience</p>
      <a class="got-it" href="javascript:void(0)">Got it</a>
    </div>
    <div class="trav-det-step2">
      <h3>Do you like traveler detail feature?</h3>
      <input type="radio" id="trav-feature-radio1" name="trav-feature" class="trav-feature"/>
      <label for="trav-feature-radio1"><span></span> Yes</label>
      <input type="radio" id="trav-feature-radio2" name="trav-feature" class="trav-feature"/>
      <label for="trav-feature-radio2"><span></span> No</label>
      <input type="radio" id="trav-feature-radio3" name="trav-feature" class="trav-feature"/>
      <label for="trav-feature-radio3"><span></span> Maybe</label>
    </div>
  </div>
  <div class="box-title clear-fix">
    <div class="panelLeftH">&nbsp;</div>
    <h2 class="fl">Traveler Detail</h2>
    <!-- <div class="fr"><div class="edit"><a class="" href="#"><i class="fa fa-edit"></i></a></div></div> -->
  </div>

  <div class="panelLeftC panelbt">
    <div id="traveler-info-new-ui">
      <div class="traveler-image" >

            <span class="sprite-agent sprite-dummyperson"></span>
        <!-- <img src="" alt="traveler-image" id="new-ui-image"> -->
      </div>

      <!--<h3 id="new-ui-name"></h3> -->
      <div class="contact-main-div">
        <div class="trav-username">
          <p class="contact-name">
          <!--<span class="contact-online sprite-icons"></span>-->
          Ashwani Kumar</p>
        </div>
        <div class="contact-det">
          <p class="contact-gen"><span class="gender-icon sprite-agent sprite-dummy-icon-for-user"></span>Male
          </p>
          <!--<p class="contact-age">52 years</p> -->
        </div>
          <div class="contact-chat-opt" style="display: none">
            <div class="contact-chat-opt-innr" onclick="showChatInAgentDashboard(null, 5058547,278401,3218074, 'Ashwani Kumar', 9048137, [9048137], [17500] ,[&quot;total&quot;], 'Converted', 'green-text','Srinagar', [&quot;Rupee&quot;]); fire_ga_event(); return false;">
              <a href="" class="gatracking contact-chat-link" data-event="click" data-galocal-cta="Send Again" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus= "false" data-verb="Agent Clicked" ><span class="chat-icon sprite-agent sprite-blue-show-message-main" ></span>Chat</a>
            </div>
          </div>
      </div>

     <!-- new design hence redundant
       <ul class="trav-gen-age">
        <li><i class="new-sprite gender-male"></i><span id="new-ui-gender"></span>
        </li>
        <li>52 year</li>
      </ul>
      -->
      <div class="trav-basic-details">
        <ul>
          <li>
            <i class="sprite-agent sprite-telephone-ring pull-left"></i>
            <span>
                  +919871554457
            </span>
          </li>
          <li><i class="sprite-agent sprite-message-box-black pull-left"></i><span><a href="mailto:User_9048137-Quote@reply.traveltriangle.com">User_9048137-Quote@reply.traveltriangle.com</a></span></li>
          <li>
          <i class="sprite-agent sprite-briefcase-detail pull-left"></i><span id="new-ui-designation">NA</span>
          </li>
          <li>
            <i class="sprite-agent sprite-location-desktop pull-left"></i><span id="new-ui-loc">NA</span>
          </li>
          <!--<li>-->
            <!--<i class="new-sprite flight-icon pull-left"></i>-->
            <!--<span>-->
              <!---->
              <!---->
            <!--</span>-->
          <!--</li>-->


        </ul>
      </div>

    </div>

    <div class="content-box-inner p_l_r30" id="traveler-info-old-ui">
      <div class="traveler-detail-holder">
        <ul>
          <li class="user-name">
                <div class="user-avatar">
                <span class="sprite-agent sprite-back-ground-person-1"></span>
                <i class="fa fa-circle online-indicator"></i>
                </div>   <!-- user-avatar -->
            <div class="user-name-meta">
              <h3>
                    Ashwani Kumar
                <!-- <span class="user&#45;score">(Score : /5)</span> -->
              </h3>
            </div>
          </li>
          <li class="icon phone-num">
          <span class="sprite-agent sprite-agent-small-phone margin-r-10"></span>
            <div class="contact_5058547">
      <!--<ul class="botompanel-list post-list">-->
                <!--<li><img src=""></li>-->
                       <!--<li class="dropdown-wrapper">-->
                         <!---->
                       <!--</li>-->
                <!--<li><img src=""></li>-->
                 <!--<li></li>-->
                 <!-- -->
                        <!--</ul>-->
<div class="old-traveler-details">
        +919871554457
</div>

<style>
  .old-traveler-details {
    width: 260px;
  }
</style>
<script type="text/javascript">
  function call_history(req_trip_id)
  {
    $.ajax({
      url: '/agent_call_history/' + req_trip_id,
      success: function (data) {
        showPopup('#agent_call_recording_popup');
        $("#agent_call_data").html(data);
      }
    });
  }

  function fire_ga_event() {
    var funnel_stage = "";
    if (view_mode == 'dashboard') {
      var funnel = {};
      ;
      funnel['in_funnel'] = true;
      funnel['funnel_stage'] = 'Post Stay';

      if (funnel['in_funnel']){
        funnel_stage = "Lead Stage: " + funnel['funnel_stage'];
      }
      else{
        funnel_stage = "Status: " + 'Converted';
      }
    }
    _gaq.push(["_trackEvent","Chat","Chat_Smallview", "5058547" + "|" + funnel_stage +"|" + "Srinagar" ]);
}
  $('.js-hover-show-box').mouseover(function(){
    $(this).parent(".msg_box_container_big").find(".js-msg_box_hover_conternt").show();
  });
  $('.js-hover-show-box').mouseout(function() {
    $(this).parent(".msg_box_container_big").find(".js-msg_box_hover_conternt").hide();
  });
  $(document).ready(function(){
    $(".js-copied-box-show").click(function(){
      $(this).closest(".msg_copy_mail_container").find(".copied_checked_field_mark").show().delay(5000).fadeOut('fast');

    });
  });

  function copyToClipboard(text_to_copy) {
    var $temp = $("<input>");
    $("body").append($temp);
    $temp.val(text_to_copy).select();
    document.execCommand("copy");
    $temp.remove();
  }
  function hideChatMask() {
    $.ajax({
      url: '/agents/cache_data_for_agents',
      method: 'GET',
      data: { action_from: 'one_time_chat' },
      dataType: 'script',
      success: function () {

      }
    });
    $(".agent-hover-mask").addClass('hide');
    $('.agent-chat-mask').addClass('hide');
    $('.show-tooltip-li').css('background','none');
    $('.show-tooltip-li').removeClass("disabled_pointer");
    window.scrollTo(0, 0);
  }

  function call_traveller(phone_no){
    $.ajax({
      url:'/requested_trips/5058547/call_traveller.js',
      data: { phone: phone_no, logged_in_user_id: '' },
      method: 'POST',
      success: function () {
        
      }
    });
  }



</script>
</div><!--list-bottom-panel-->
<script>
  $('#get_phonenum_5058547').on('click', function(){
    var funnel_stage = $(this).text();
    _gaq.push(["_trackEvent","Trip_full_view","Show_Phone_Number",funnel_stage]);
  })
</script>
          </li>
            <li style="padding-left:0;">
              <div class="msg_copy_mail_container">
                <input class="text_field_user-palceholder" type="text" placeholder="User_9048137-Quote@reply.traveltriangle.com" readonly="true"/>
                <div class="msg_box_container_big">
                  <div class="js-msg_box_hover_conternt msg_box_hover_conternt">
                    <p class="hidden-divContent-send">Send email</p>
                    <div class="arrow-down-triangle"></div>
                  </div><!-- msg_box_hover_conternt -->
                  <a class="js-hover-show-box msg_box-show-tag" href="mailto:User_9048137-Quote@reply.traveltriangle.com" onclick="send_email_ga('User_9048137-Quote@reply.traveltriangle.com', '5058547','278401');">
                  <span class="sprite-agent sprite-msg-box-1"></span></a>
                </div><!-- msg_box_container_big -->
                <div class="msg_box_container_big">
                  <div class="js-msg_box_hover_conternt msg_box_hover_conternt">
                    <p class="hidden-divContent-send">Copy email</p>
                    <div class="arrow-down-triangle"></div>
                  </div><!-- msg_box_hover_conternt -->
                  <a class="gatracking js-hover-show-box js-copied-box-show copied_item-show-tag" data-event="click" data-galocal-cta="Copy Email" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-verb="Agent Clicked" href="#" onclick="copyToClipboard('User_9048137-Quote@reply.traveltriangle.com', '5058547','278401');return false;">
                  <span class="sprite-agent sprite-copied-item-1"></span>
                  </a>
                </div>  <!--  msg_box_container_big -->
                <span class="copied_checked_field_mark">
                 <p class="copied-checked-div"><span class="sprite-agent sprite-for-white-check-small"></span>Copied!</p>
                </span><!-- copied_checked_field_mark -->
              </div><!-- msg_copy_mail_container -->
            </li>

            <div class="travelerDocDetails">
              <ul class="travelerDocList">
                  <li id="traveler-uploaded-documents-sidebar_adult_1">
                    <div class="travelerInfo">
  <h3 class="">
      Adult 1
  </h3>
  <p>
    <span class="docMsg passportDocMsg ">
      Passport uploaded
    </span>
    <span class="docMsg panDocMsg ">
      PAN uploaded
    </span>
<!--    <span class="docMsg otherDocMsg">Other documents uploaded</span>-->
  </p>
  <span class="travelerDocAction modalTriggerOpen" id="travelerDocAction_adult_1_edit"
        class="addAction">
    Add Details
  </span>
</div>

  <script type="text/javascript">
    var traveler_id = 'adult_1';
</script>
<link href="https://assets.traveltriangle.com//assets/upload_passport-aa83c34ec7253824720348af750e1ab0.css" media="screen" rel="stylesheet" type="text/css" />
<script src="https://assets.traveltriangle.com//assets/upload_passport-e4669106788c9726705f5092eae121b0.js" type="text/javascript"></script>
<div class="contentModal modalThemePrimary travelerDocDetailModal travelerDocDetailModal_adult_1  " id="edit-modal-adult_1">
  <div class="contentModalOverlay travelerDocAction"></div>
  <div class="contentModalInner">
    <form accept-charset="UTF-8" action="https://traveltriangle.com/invoices/231971/agent_travel_detail_save" class="new_travel_detail" data-remote="true" enctype="multipart/form-data" id="agent-side-travel-detail-edit-form_adult_1" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="_method" type="hidden" value="put" /><input name="authenticity_token" type="hidden" value="iDFjdQQhR2kReB8A5QUpAZtGOyH9c/iBXbFEbBdSOHE=" /></div>
      <div class="contentModalHeader">
        <h3 class="modalHeaderTitle">Add Details</h3>
      </div>
      <div class="contentModalMain">
        <div class="row">
          <div class="col-12 hide attachment-remove-error">
            <p>Document not removed due to error</p>
          </div>
          <div class="col-12">
            <h4 class="font-12 margin-b-8">Traveler Details</h4>
          </div>
          <input name="passport_deleted_attachment" type="hidden" value="" id="passport-deleted-attachment-adult_1">
          <input id="travel_detail_detail_type" name="travel_detail[detail_type]" type="hidden" value="adult" />
          <input name="travel_detail_index" type="hidden" value="adult_1">
          <div class="col-5 margin-b-15">
            <label class="font-12 required sign input__label">Full Name</label>
            <input class="form-control form-field mandatory " name="travel_detail[name]" placeholder="" size="30" type="text" />
            <span class="fieldErr hide">This field cannot be blank</span></label>
          </div>
          <div class="col-3 margin-b-15 margin-b-15">
            <label class="font-12 required sign input__label">Age</label>
            <input class="form-control form-field mandatory " name="travel_detail[age]" placeholder="" size="30" type="text" />
            <span class="fieldErr hide">This field cannot be blank</span></label>
          </div>
        </div>

        <div class="fields">
          <div class="row">
            <input id="travel_detail_tt_documents_attributes_0_id" name="travel_detail[tt_documents_attributes][0][id]" type="hidden" />
            <input id="travel_detail_tt_documents_attributes_0_document_meta_info_id" name="travel_detail[tt_documents_attributes][0][document_meta_info_id]" type="hidden" value="1" />
            <div class="col-3 margin-b-15">
              <label for="doc_no" class="font-12">Passport Number
                  <span class="validation-color-for-label">*</span>
              </label>
              <div class="col-sm-7">
                  <input class="form-control form-field  " id="travel_detail_tt_documents_attributes_0_doc_no" name="travel_detail[tt_documents_attributes][0][doc_no]" placeholder="Passport Number" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span>
              </div>
            </div>
            
                <div class="col-3 margin-b-15">
                  <label for="issued_date" class="font-12">Issued Date<span class="">DD/MM/YY</span></label>
                  <input class="form-control form-field   issued-datepicker" max="2021-11-22" name="travel_detail[tt_documents_attributes][0][meta_info][issued_date]" placeholder="" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
                <div class="col-3 margin-b-15">
                  <label for="expiry_date" class="font-12">Expiry Date<span class="">DD/MM/YY</span></label>
                  <input class="form-control form-field   expiry-datepicker" name="travel_detail[tt_documents_attributes][0][meta_info][expiry_date]" placeholder="" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
                <div class="col-3 margin-b-15">
                  <label for="issued_place" class="font-12">Issued place</label>
                  <input class="form-control form-field  " name="travel_detail[tt_documents_attributes][0][meta_info][issued_place]" placeholder="" size="30" type="text" value="" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
            <div class="row">
              <div class="col-6 margin-b-15">
            <div class="fields">
              <input id="travel_detail_tt_documents_attributes_0_private_attachments_attributes_0_id" name="travel_detail[tt_documents_attributes][0][private_attachments_attributes][0][id]" type="hidden" />
                <div class="col-6 margin-b-15">
                  <label for="attachment">Passport
                    Front Page
                  </label>

                      <div id="passport-files-adult_1"></div>
                      <input class="upload-passport hide" id="upload-passport_adult_1" name="travel_detail[tt_documents_attributes][0][private_attachments_attributes][0][attachment]" type="file" />
                    <label for="upload-passport_adult_1"
                           class="front-page-passport col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                           id="front-page-passport-adult_1">
                      <p class="text-center margin-0 font-14">
                        Upload
                      </p>
                    </label>
                </div>
</div>              </div>
          </div>
</div><div class="fields">
          <div class="row">
            <input id="travel_detail_tt_documents_attributes_1_id" name="travel_detail[tt_documents_attributes][1][id]" type="hidden" />
            <input id="travel_detail_tt_documents_attributes_1_document_meta_info_id" name="travel_detail[tt_documents_attributes][1][document_meta_info_id]" type="hidden" value="2" />
            <div class="col-3 margin-b-15">
              <label for="doc_no" class="font-12">Pancard Number
              </label>
              <div class="col-sm-7">
                  <input class="form-control form-field" id="travel_detail_tt_documents_attributes_1_doc_no" name="travel_detail[tt_documents_attributes][1][doc_no]" placeholder="Pancard Number" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span>
              </div>
            </div>
                        <div class="row">
              <div class="col-6 margin-b-15">
            <div class="fields">
              <input id="travel_detail_tt_documents_attributes_1_private_attachments_attributes_0_id" name="travel_detail[tt_documents_attributes][1][private_attachments_attributes][0][id]" type="hidden" />
                <div class="col-6 margin-b-15">
                  <label for="attachment">Pancard
                    Front Page
                  </label>

                      <div id="pan-files-adult_1"></div>
                      <input class="upload-pan hide" id="upload-pan_adult_1" name="travel_detail[tt_documents_attributes][1][private_attachments_attributes][0][attachment]" type="file" />
                    <label for="upload-pan_adult_1"
                           class="front-page-pan col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                           id="front-page-pan-adult_1">
                      <p class="text-center margin-0 font-14">
                        Upload
                      </p>
                    </label>
                </div>
</div>              </div>
          </div>
</div>
        <div class="row">
        <div class="col-6 margin-b-15">
        <div class="fields">
            <label for="attachment">
              Other Documents
            </label>
                  <div id="other-documents-files-adult_1" hide></div>
                <input class="upload-other_adult_1 hide" id="upload-otherDoc_adult_1" name="travel_detail[attachments_attributes][0][file]" type="file" />
                <label for="upload-otherDoc_adult_1" class="front-page-pan col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                       id="front-page-pan-adult_1">
                  <p class="text-center margin-0 font-14">
                    Upload
                  </p>
                </label>
                </label>
</div>        </div>
        </div>
        </div>
        <div class="contentModalFooter">
          <div class="modalFooterContent rightAlign">
            <div class="row">
              <div class="col-12">
              <span style="font-size: 10px;color: black;margin-top: 10px;display: inline-block;">
                Note: Please select multiple files to upload in one go.
              </span>
                <input class="modalMainSubmit" name="commit" type="submit" value="Submit" />
                <span class="contentModalDismiss travelerDocDetailModalDismiss" id="adult_1">Cancel</span>
              </div>
            </div>
          </div>

        </div>

</form>    </div>
  </div>
</div>
<script src="https://assets.traveltriangle.com//assets/agent/travel_detail/upload_pan_passport-91e73527be38a9f358799263ef97659f.js" type="text/javascript"></script>

<style>

</style>

<script>
  $('.issued-datepicker').Zebra_DatePicker({
    show_icon: false, default_position: "below", format: 'd/m/Y', direction: -1,
    onSelect: function() {
      $(this).removeClass('input-error-message');
      $(this).siblings('span').addClass('hide');
    }
  });

  $('.expiry-datepicker').Zebra_DatePicker({
    show_icon: false, default_position: "below", format: 'd/m/Y', direction: 1,
    onSelect: function() {
      $(this).removeClass('input-error-message');
      $(this).siblings('span').addClass('hide');
    }
  });

  $('.contentModal').hide();

  $(document).on('click', "#travelerDocAction_adult_1_edit", function (e) {
    e.preventDefault();
    $(".travelerDocDetailModal_adult_1").show();

    $('body').css('overflow', 'hidden');
  });

  $(document).on('click', '.travelerDocDetailModalDismiss', function () {
    var id = $(this).attr('id');
    var formattedId = ".travelerDocDetailModal_" + id;
    $(formattedId).hide();
    var viewId = "#view-modal-" + id;
    var editId = "#edit-modal-" + id;
    if ($(viewId).length) {
      $(viewId).removeClass('hide');
      $(editId).addClass('hide');
    }
    $('body').css('overflow', '');
  });
</script>

                  </li>
                  <li id="traveler-uploaded-documents-sidebar_adult_2">
                    <div class="travelerInfo">
  <h3 class="">
      Adult 2
  </h3>
  <p>
    <span class="docMsg passportDocMsg ">
      Passport uploaded
    </span>
    <span class="docMsg panDocMsg ">
      PAN uploaded
    </span>
<!--    <span class="docMsg otherDocMsg">Other documents uploaded</span>-->
  </p>
  <span class="travelerDocAction modalTriggerOpen" id="travelerDocAction_adult_2_edit"
        class="addAction">
    Add Details
  </span>
</div>

  <script type="text/javascript">
    var traveler_id = 'adult_2';
</script>
<link href="https://assets.traveltriangle.com//assets/upload_passport-aa83c34ec7253824720348af750e1ab0.css" media="screen" rel="stylesheet" type="text/css" />
<script src="https://assets.traveltriangle.com//assets/upload_passport-e4669106788c9726705f5092eae121b0.js" type="text/javascript"></script>
<div class="contentModal modalThemePrimary travelerDocDetailModal travelerDocDetailModal_adult_2  " id="edit-modal-adult_2">
  <div class="contentModalOverlay travelerDocAction"></div>
  <div class="contentModalInner">
    <form accept-charset="UTF-8" action="https://traveltriangle.com/invoices/231971/agent_travel_detail_save" class="new_travel_detail" data-remote="true" enctype="multipart/form-data" id="agent-side-travel-detail-edit-form_adult_2" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="_method" type="hidden" value="put" /><input name="authenticity_token" type="hidden" value="iDFjdQQhR2kReB8A5QUpAZtGOyH9c/iBXbFEbBdSOHE=" /></div>
      <div class="contentModalHeader">
        <h3 class="modalHeaderTitle">Add Details</h3>
      </div>
      <div class="contentModalMain">
        <div class="row">
          <div class="col-12 hide attachment-remove-error">
            <p>Document not removed due to error</p>
          </div>
          <div class="col-12">
            <h4 class="font-12 margin-b-8">Traveler Details</h4>
          </div>
          <input name="passport_deleted_attachment" type="hidden" value="" id="passport-deleted-attachment-adult_2">
          <input id="travel_detail_detail_type" name="travel_detail[detail_type]" type="hidden" value="adult" />
          <input name="travel_detail_index" type="hidden" value="adult_2">
          <div class="col-5 margin-b-15">
            <label class="font-12 required sign input__label">Full Name</label>
            <input class="form-control form-field mandatory " name="travel_detail[name]" placeholder="" size="30" type="text" />
            <span class="fieldErr hide">This field cannot be blank</span></label>
          </div>
          <div class="col-3 margin-b-15 margin-b-15">
            <label class="font-12 required sign input__label">Age</label>
            <input class="form-control form-field mandatory " name="travel_detail[age]" placeholder="" size="30" type="text" />
            <span class="fieldErr hide">This field cannot be blank</span></label>
          </div>
        </div>

        <div class="fields">
          <div class="row">
            <input id="travel_detail_tt_documents_attributes_0_id" name="travel_detail[tt_documents_attributes][0][id]" type="hidden" />
            <input id="travel_detail_tt_documents_attributes_0_document_meta_info_id" name="travel_detail[tt_documents_attributes][0][document_meta_info_id]" type="hidden" value="1" />
            <div class="col-3 margin-b-15">
              <label for="doc_no" class="font-12">Passport Number
                  <span class="validation-color-for-label">*</span>
              </label>
              <div class="col-sm-7">
                  <input class="form-control form-field  " id="travel_detail_tt_documents_attributes_0_doc_no" name="travel_detail[tt_documents_attributes][0][doc_no]" placeholder="Passport Number" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span>
              </div>
            </div>
            
                <div class="col-3 margin-b-15">
                  <label for="issued_date" class="font-12">Issued Date<span class="">DD/MM/YY</span></label>
                  <input class="form-control form-field   issued-datepicker" max="2021-11-22" name="travel_detail[tt_documents_attributes][0][meta_info][issued_date]" placeholder="" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
                <div class="col-3 margin-b-15">
                  <label for="expiry_date" class="font-12">Expiry Date<span class="">DD/MM/YY</span></label>
                  <input class="form-control form-field   expiry-datepicker" name="travel_detail[tt_documents_attributes][0][meta_info][expiry_date]" placeholder="" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
                <div class="col-3 margin-b-15">
                  <label for="issued_place" class="font-12">Issued place</label>
                  <input class="form-control form-field  " name="travel_detail[tt_documents_attributes][0][meta_info][issued_place]" placeholder="" size="30" type="text" value="" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
            <div class="row">
              <div class="col-6 margin-b-15">
            <div class="fields">
              <input id="travel_detail_tt_documents_attributes_0_private_attachments_attributes_0_id" name="travel_detail[tt_documents_attributes][0][private_attachments_attributes][0][id]" type="hidden" />
                <div class="col-6 margin-b-15">
                  <label for="attachment">Passport
                    Front Page
                  </label>

                      <div id="passport-files-adult_2"></div>
                      <input class="upload-passport hide" id="upload-passport_adult_2" name="travel_detail[tt_documents_attributes][0][private_attachments_attributes][0][attachment]" type="file" />
                    <label for="upload-passport_adult_2"
                           class="front-page-passport col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                           id="front-page-passport-adult_2">
                      <p class="text-center margin-0 font-14">
                        Upload
                      </p>
                    </label>
                </div>
</div>              </div>
          </div>
</div><div class="fields">
          <div class="row">
            <input id="travel_detail_tt_documents_attributes_1_id" name="travel_detail[tt_documents_attributes][1][id]" type="hidden" />
            <input id="travel_detail_tt_documents_attributes_1_document_meta_info_id" name="travel_detail[tt_documents_attributes][1][document_meta_info_id]" type="hidden" value="2" />
            <div class="col-3 margin-b-15">
              <label for="doc_no" class="font-12">Pancard Number
              </label>
              <div class="col-sm-7">
                  <input class="form-control form-field" id="travel_detail_tt_documents_attributes_1_doc_no" name="travel_detail[tt_documents_attributes][1][doc_no]" placeholder="Pancard Number" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span>
              </div>
            </div>
                        <div class="row">
              <div class="col-6 margin-b-15">
            <div class="fields">
              <input id="travel_detail_tt_documents_attributes_1_private_attachments_attributes_0_id" name="travel_detail[tt_documents_attributes][1][private_attachments_attributes][0][id]" type="hidden" />
                <div class="col-6 margin-b-15">
                  <label for="attachment">Pancard
                    Front Page
                  </label>

                      <div id="pan-files-adult_2"></div>
                      <input class="upload-pan hide" id="upload-pan_adult_2" name="travel_detail[tt_documents_attributes][1][private_attachments_attributes][0][attachment]" type="file" />
                    <label for="upload-pan_adult_2"
                           class="front-page-pan col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                           id="front-page-pan-adult_2">
                      <p class="text-center margin-0 font-14">
                        Upload
                      </p>
                    </label>
                </div>
</div>              </div>
          </div>
</div>
        <div class="row">
        <div class="col-6 margin-b-15">
        <div class="fields">
            <label for="attachment">
              Other Documents
            </label>
                  <div id="other-documents-files-adult_2" hide></div>
                <input class="upload-other_adult_2 hide" id="upload-otherDoc_adult_2" name="travel_detail[attachments_attributes][0][file]" type="file" />
                <label for="upload-otherDoc_adult_2" class="front-page-pan col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                       id="front-page-pan-adult_2">
                  <p class="text-center margin-0 font-14">
                    Upload
                  </p>
                </label>
                </label>
</div>        </div>
        </div>
        </div>
        <div class="contentModalFooter">
          <div class="modalFooterContent rightAlign">
            <div class="row">
              <div class="col-12">
              <span style="font-size: 10px;color: black;margin-top: 10px;display: inline-block;">
                Note: Please select multiple files to upload in one go.
              </span>
                <input class="modalMainSubmit" name="commit" type="submit" value="Submit" />
                <span class="contentModalDismiss travelerDocDetailModalDismiss" id="adult_2">Cancel</span>
              </div>
            </div>
          </div>

        </div>

</form>    </div>
  </div>
</div>
<script src="https://assets.traveltriangle.com//assets/agent/travel_detail/upload_pan_passport-91e73527be38a9f358799263ef97659f.js" type="text/javascript"></script>

<style>

</style>

<script>
  $('.issued-datepicker').Zebra_DatePicker({
    show_icon: false, default_position: "below", format: 'd/m/Y', direction: -1,
    onSelect: function() {
      $(this).removeClass('input-error-message');
      $(this).siblings('span').addClass('hide');
    }
  });

  $('.expiry-datepicker').Zebra_DatePicker({
    show_icon: false, default_position: "below", format: 'd/m/Y', direction: 1,
    onSelect: function() {
      $(this).removeClass('input-error-message');
      $(this).siblings('span').addClass('hide');
    }
  });

  $('.contentModal').hide();

  $(document).on('click', "#travelerDocAction_adult_2_edit", function (e) {
    e.preventDefault();
    $(".travelerDocDetailModal_adult_2").show();

    $('body').css('overflow', 'hidden');
  });

  $(document).on('click', '.travelerDocDetailModalDismiss', function () {
    var id = $(this).attr('id');
    var formattedId = ".travelerDocDetailModal_" + id;
    $(formattedId).hide();
    var viewId = "#view-modal-" + id;
    var editId = "#edit-modal-" + id;
    if ($(viewId).length) {
      $(viewId).removeClass('hide');
      $(editId).addClass('hide');
    }
    $('body').css('overflow', '');
  });
</script>

                  </li>
                  <li id="traveler-uploaded-documents-sidebar_adult_3">
                    <div class="travelerInfo">
  <h3 class="">
      Adult 3
  </h3>
  <p>
    <span class="docMsg passportDocMsg ">
      Passport uploaded
    </span>
    <span class="docMsg panDocMsg ">
      PAN uploaded
    </span>
<!--    <span class="docMsg otherDocMsg">Other documents uploaded</span>-->
  </p>
  <span class="travelerDocAction modalTriggerOpen" id="travelerDocAction_adult_3_edit"
        class="addAction">
    Add Details
  </span>
</div>

  <script type="text/javascript">
    var traveler_id = 'adult_3';
</script>
<link href="https://assets.traveltriangle.com//assets/upload_passport-aa83c34ec7253824720348af750e1ab0.css" media="screen" rel="stylesheet" type="text/css" />
<script src="https://assets.traveltriangle.com//assets/upload_passport-e4669106788c9726705f5092eae121b0.js" type="text/javascript"></script>
<div class="contentModal modalThemePrimary travelerDocDetailModal travelerDocDetailModal_adult_3  " id="edit-modal-adult_3">
  <div class="contentModalOverlay travelerDocAction"></div>
  <div class="contentModalInner">
    <form accept-charset="UTF-8" action="https://traveltriangle.com/invoices/231971/agent_travel_detail_save" class="new_travel_detail" data-remote="true" enctype="multipart/form-data" id="agent-side-travel-detail-edit-form_adult_3" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="_method" type="hidden" value="put" /><input name="authenticity_token" type="hidden" value="iDFjdQQhR2kReB8A5QUpAZtGOyH9c/iBXbFEbBdSOHE=" /></div>
      <div class="contentModalHeader">
        <h3 class="modalHeaderTitle">Add Details</h3>
      </div>
      <div class="contentModalMain">
        <div class="row">
          <div class="col-12 hide attachment-remove-error">
            <p>Document not removed due to error</p>
          </div>
          <div class="col-12">
            <h4 class="font-12 margin-b-8">Traveler Details</h4>
          </div>
          <input name="passport_deleted_attachment" type="hidden" value="" id="passport-deleted-attachment-adult_3">
          <input id="travel_detail_detail_type" name="travel_detail[detail_type]" type="hidden" value="adult" />
          <input name="travel_detail_index" type="hidden" value="adult_3">
          <div class="col-5 margin-b-15">
            <label class="font-12 required sign input__label">Full Name</label>
            <input class="form-control form-field mandatory " name="travel_detail[name]" placeholder="" size="30" type="text" />
            <span class="fieldErr hide">This field cannot be blank</span></label>
          </div>
          <div class="col-3 margin-b-15 margin-b-15">
            <label class="font-12 required sign input__label">Age</label>
            <input class="form-control form-field mandatory " name="travel_detail[age]" placeholder="" size="30" type="text" />
            <span class="fieldErr hide">This field cannot be blank</span></label>
          </div>
        </div>

        <div class="fields">
          <div class="row">
            <input id="travel_detail_tt_documents_attributes_0_id" name="travel_detail[tt_documents_attributes][0][id]" type="hidden" />
            <input id="travel_detail_tt_documents_attributes_0_document_meta_info_id" name="travel_detail[tt_documents_attributes][0][document_meta_info_id]" type="hidden" value="1" />
            <div class="col-3 margin-b-15">
              <label for="doc_no" class="font-12">Passport Number
                  <span class="validation-color-for-label">*</span>
              </label>
              <div class="col-sm-7">
                  <input class="form-control form-field  " id="travel_detail_tt_documents_attributes_0_doc_no" name="travel_detail[tt_documents_attributes][0][doc_no]" placeholder="Passport Number" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span>
              </div>
            </div>
            
                <div class="col-3 margin-b-15">
                  <label for="issued_date" class="font-12">Issued Date<span class="">DD/MM/YY</span></label>
                  <input class="form-control form-field   issued-datepicker" max="2021-11-22" name="travel_detail[tt_documents_attributes][0][meta_info][issued_date]" placeholder="" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
                <div class="col-3 margin-b-15">
                  <label for="expiry_date" class="font-12">Expiry Date<span class="">DD/MM/YY</span></label>
                  <input class="form-control form-field   expiry-datepicker" name="travel_detail[tt_documents_attributes][0][meta_info][expiry_date]" placeholder="" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
                <div class="col-3 margin-b-15">
                  <label for="issued_place" class="font-12">Issued place</label>
                  <input class="form-control form-field  " name="travel_detail[tt_documents_attributes][0][meta_info][issued_place]" placeholder="" size="30" type="text" value="" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
            <div class="row">
              <div class="col-6 margin-b-15">
            <div class="fields">
              <input id="travel_detail_tt_documents_attributes_0_private_attachments_attributes_0_id" name="travel_detail[tt_documents_attributes][0][private_attachments_attributes][0][id]" type="hidden" />
                <div class="col-6 margin-b-15">
                  <label for="attachment">Passport
                    Front Page
                  </label>

                      <div id="passport-files-adult_3"></div>
                      <input class="upload-passport hide" id="upload-passport_adult_3" name="travel_detail[tt_documents_attributes][0][private_attachments_attributes][0][attachment]" type="file" />
                    <label for="upload-passport_adult_3"
                           class="front-page-passport col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                           id="front-page-passport-adult_3">
                      <p class="text-center margin-0 font-14">
                        Upload
                      </p>
                    </label>
                </div>
</div>              </div>
          </div>
</div><div class="fields">
          <div class="row">
            <input id="travel_detail_tt_documents_attributes_1_id" name="travel_detail[tt_documents_attributes][1][id]" type="hidden" />
            <input id="travel_detail_tt_documents_attributes_1_document_meta_info_id" name="travel_detail[tt_documents_attributes][1][document_meta_info_id]" type="hidden" value="2" />
            <div class="col-3 margin-b-15">
              <label for="doc_no" class="font-12">Pancard Number
              </label>
              <div class="col-sm-7">
                  <input class="form-control form-field" id="travel_detail_tt_documents_attributes_1_doc_no" name="travel_detail[tt_documents_attributes][1][doc_no]" placeholder="Pancard Number" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span>
              </div>
            </div>
                        <div class="row">
              <div class="col-6 margin-b-15">
            <div class="fields">
              <input id="travel_detail_tt_documents_attributes_1_private_attachments_attributes_0_id" name="travel_detail[tt_documents_attributes][1][private_attachments_attributes][0][id]" type="hidden" />
                <div class="col-6 margin-b-15">
                  <label for="attachment">Pancard
                    Front Page
                  </label>

                      <div id="pan-files-adult_3"></div>
                      <input class="upload-pan hide" id="upload-pan_adult_3" name="travel_detail[tt_documents_attributes][1][private_attachments_attributes][0][attachment]" type="file" />
                    <label for="upload-pan_adult_3"
                           class="front-page-pan col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                           id="front-page-pan-adult_3">
                      <p class="text-center margin-0 font-14">
                        Upload
                      </p>
                    </label>
                </div>
</div>              </div>
          </div>
</div>
        <div class="row">
        <div class="col-6 margin-b-15">
        <div class="fields">
            <label for="attachment">
              Other Documents
            </label>
                  <div id="other-documents-files-adult_3" hide></div>
                <input class="upload-other_adult_3 hide" id="upload-otherDoc_adult_3" name="travel_detail[attachments_attributes][0][file]" type="file" />
                <label for="upload-otherDoc_adult_3" class="front-page-pan col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                       id="front-page-pan-adult_3">
                  <p class="text-center margin-0 font-14">
                    Upload
                  </p>
                </label>
                </label>
</div>        </div>
        </div>
        </div>
        <div class="contentModalFooter">
          <div class="modalFooterContent rightAlign">
            <div class="row">
              <div class="col-12">
              <span style="font-size: 10px;color: black;margin-top: 10px;display: inline-block;">
                Note: Please select multiple files to upload in one go.
              </span>
                <input class="modalMainSubmit" name="commit" type="submit" value="Submit" />
                <span class="contentModalDismiss travelerDocDetailModalDismiss" id="adult_3">Cancel</span>
              </div>
            </div>
          </div>

        </div>

</form>    </div>
  </div>
</div>
<script src="https://assets.traveltriangle.com//assets/agent/travel_detail/upload_pan_passport-91e73527be38a9f358799263ef97659f.js" type="text/javascript"></script>

<style>

</style>

<script>
  $('.issued-datepicker').Zebra_DatePicker({
    show_icon: false, default_position: "below", format: 'd/m/Y', direction: -1,
    onSelect: function() {
      $(this).removeClass('input-error-message');
      $(this).siblings('span').addClass('hide');
    }
  });

  $('.expiry-datepicker').Zebra_DatePicker({
    show_icon: false, default_position: "below", format: 'd/m/Y', direction: 1,
    onSelect: function() {
      $(this).removeClass('input-error-message');
      $(this).siblings('span').addClass('hide');
    }
  });

  $('.contentModal').hide();

  $(document).on('click', "#travelerDocAction_adult_3_edit", function (e) {
    e.preventDefault();
    $(".travelerDocDetailModal_adult_3").show();

    $('body').css('overflow', 'hidden');
  });

  $(document).on('click', '.travelerDocDetailModalDismiss', function () {
    var id = $(this).attr('id');
    var formattedId = ".travelerDocDetailModal_" + id;
    $(formattedId).hide();
    var viewId = "#view-modal-" + id;
    var editId = "#edit-modal-" + id;
    if ($(viewId).length) {
      $(viewId).removeClass('hide');
      $(editId).addClass('hide');
    }
    $('body').css('overflow', '');
  });
</script>

                  </li>
                  <li id="traveler-uploaded-documents-sidebar_adult_4">
                    <div class="travelerInfo">
  <h3 class="">
      Adult 4
  </h3>
  <p>
    <span class="docMsg passportDocMsg ">
      Passport uploaded
    </span>
    <span class="docMsg panDocMsg ">
      PAN uploaded
    </span>
<!--    <span class="docMsg otherDocMsg">Other documents uploaded</span>-->
  </p>
  <span class="travelerDocAction modalTriggerOpen" id="travelerDocAction_adult_4_edit"
        class="addAction">
    Add Details
  </span>
</div>

  <script type="text/javascript">
    var traveler_id = 'adult_4';
</script>
<link href="https://assets.traveltriangle.com//assets/upload_passport-aa83c34ec7253824720348af750e1ab0.css" media="screen" rel="stylesheet" type="text/css" />
<script src="https://assets.traveltriangle.com//assets/upload_passport-e4669106788c9726705f5092eae121b0.js" type="text/javascript"></script>
<div class="contentModal modalThemePrimary travelerDocDetailModal travelerDocDetailModal_adult_4  " id="edit-modal-adult_4">
  <div class="contentModalOverlay travelerDocAction"></div>
  <div class="contentModalInner">
    <form accept-charset="UTF-8" action="https://traveltriangle.com/invoices/231971/agent_travel_detail_save" class="new_travel_detail" data-remote="true" enctype="multipart/form-data" id="agent-side-travel-detail-edit-form_adult_4" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="_method" type="hidden" value="put" /><input name="authenticity_token" type="hidden" value="iDFjdQQhR2kReB8A5QUpAZtGOyH9c/iBXbFEbBdSOHE=" /></div>
      <div class="contentModalHeader">
        <h3 class="modalHeaderTitle">Add Details</h3>
      </div>
      <div class="contentModalMain">
        <div class="row">
          <div class="col-12 hide attachment-remove-error">
            <p>Document not removed due to error</p>
          </div>
          <div class="col-12">
            <h4 class="font-12 margin-b-8">Traveler Details</h4>
          </div>
          <input name="passport_deleted_attachment" type="hidden" value="" id="passport-deleted-attachment-adult_4">
          <input id="travel_detail_detail_type" name="travel_detail[detail_type]" type="hidden" value="adult" />
          <input name="travel_detail_index" type="hidden" value="adult_4">
          <div class="col-5 margin-b-15">
            <label class="font-12 required sign input__label">Full Name</label>
            <input class="form-control form-field mandatory " name="travel_detail[name]" placeholder="" size="30" type="text" />
            <span class="fieldErr hide">This field cannot be blank</span></label>
          </div>
          <div class="col-3 margin-b-15 margin-b-15">
            <label class="font-12 required sign input__label">Age</label>
            <input class="form-control form-field mandatory " name="travel_detail[age]" placeholder="" size="30" type="text" />
            <span class="fieldErr hide">This field cannot be blank</span></label>
          </div>
        </div>

        <div class="fields">
          <div class="row">
            <input id="travel_detail_tt_documents_attributes_0_id" name="travel_detail[tt_documents_attributes][0][id]" type="hidden" />
            <input id="travel_detail_tt_documents_attributes_0_document_meta_info_id" name="travel_detail[tt_documents_attributes][0][document_meta_info_id]" type="hidden" value="1" />
            <div class="col-3 margin-b-15">
              <label for="doc_no" class="font-12">Passport Number
                  <span class="validation-color-for-label">*</span>
              </label>
              <div class="col-sm-7">
                  <input class="form-control form-field  " id="travel_detail_tt_documents_attributes_0_doc_no" name="travel_detail[tt_documents_attributes][0][doc_no]" placeholder="Passport Number" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span>
              </div>
            </div>
            
                <div class="col-3 margin-b-15">
                  <label for="issued_date" class="font-12">Issued Date<span class="">DD/MM/YY</span></label>
                  <input class="form-control form-field   issued-datepicker" max="2021-11-22" name="travel_detail[tt_documents_attributes][0][meta_info][issued_date]" placeholder="" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
                <div class="col-3 margin-b-15">
                  <label for="expiry_date" class="font-12">Expiry Date<span class="">DD/MM/YY</span></label>
                  <input class="form-control form-field   expiry-datepicker" name="travel_detail[tt_documents_attributes][0][meta_info][expiry_date]" placeholder="" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
                <div class="col-3 margin-b-15">
                  <label for="issued_place" class="font-12">Issued place</label>
                  <input class="form-control form-field  " name="travel_detail[tt_documents_attributes][0][meta_info][issued_place]" placeholder="" size="30" type="text" value="" />
                  <span class="fieldErr hide">This field cannot be blank</span></label>
                </div>
            <div class="row">
              <div class="col-6 margin-b-15">
            <div class="fields">
              <input id="travel_detail_tt_documents_attributes_0_private_attachments_attributes_0_id" name="travel_detail[tt_documents_attributes][0][private_attachments_attributes][0][id]" type="hidden" />
                <div class="col-6 margin-b-15">
                  <label for="attachment">Passport
                    Front Page
                  </label>

                      <div id="passport-files-adult_4"></div>
                      <input class="upload-passport hide" id="upload-passport_adult_4" name="travel_detail[tt_documents_attributes][0][private_attachments_attributes][0][attachment]" type="file" />
                    <label for="upload-passport_adult_4"
                           class="front-page-passport col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                           id="front-page-passport-adult_4">
                      <p class="text-center margin-0 font-14">
                        Upload
                      </p>
                    </label>
                </div>
</div>              </div>
          </div>
</div><div class="fields">
          <div class="row">
            <input id="travel_detail_tt_documents_attributes_1_id" name="travel_detail[tt_documents_attributes][1][id]" type="hidden" />
            <input id="travel_detail_tt_documents_attributes_1_document_meta_info_id" name="travel_detail[tt_documents_attributes][1][document_meta_info_id]" type="hidden" value="2" />
            <div class="col-3 margin-b-15">
              <label for="doc_no" class="font-12">Pancard Number
              </label>
              <div class="col-sm-7">
                  <input class="form-control form-field" id="travel_detail_tt_documents_attributes_1_doc_no" name="travel_detail[tt_documents_attributes][1][doc_no]" placeholder="Pancard Number" size="30" type="text" />
                  <span class="fieldErr hide">This field cannot be blank</span>
              </div>
            </div>
                        <div class="row">
              <div class="col-6 margin-b-15">
            <div class="fields">
              <input id="travel_detail_tt_documents_attributes_1_private_attachments_attributes_0_id" name="travel_detail[tt_documents_attributes][1][private_attachments_attributes][0][id]" type="hidden" />
                <div class="col-6 margin-b-15">
                  <label for="attachment">Pancard
                    Front Page
                  </label>

                      <div id="pan-files-adult_4"></div>
                      <input class="upload-pan hide" id="upload-pan_adult_4" name="travel_detail[tt_documents_attributes][1][private_attachments_attributes][0][attachment]" type="file" />
                    <label for="upload-pan_adult_4"
                           class="front-page-pan col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                           id="front-page-pan-adult_4">
                      <p class="text-center margin-0 font-14">
                        Upload
                      </p>
                    </label>
                </div>
</div>              </div>
          </div>
</div>
        <div class="row">
        <div class="col-6 margin-b-15">
        <div class="fields">
            <label for="attachment">
              Other Documents
            </label>
                  <div id="other-documents-files-adult_4" hide></div>
                <input class="upload-other_adult_4 hide" id="upload-otherDoc_adult_4" name="travel_detail[attachments_attributes][0][file]" type="file" />
                <label for="upload-otherDoc_adult_4" class="front-page-pan col-sm-6 document-img document-upload clearfix padding-10 blue-border"
                       id="front-page-pan-adult_4">
                  <p class="text-center margin-0 font-14">
                    Upload
                  </p>
                </label>
                </label>
</div>        </div>
        </div>
        </div>
        <div class="contentModalFooter">
          <div class="modalFooterContent rightAlign">
            <div class="row">
              <div class="col-12">
              <span style="font-size: 10px;color: black;margin-top: 10px;display: inline-block;">
                Note: Please select multiple files to upload in one go.
              </span>
                <input class="modalMainSubmit" name="commit" type="submit" value="Submit" />
                <span class="contentModalDismiss travelerDocDetailModalDismiss" id="adult_4">Cancel</span>
              </div>
            </div>
          </div>

        </div>

</form>    </div>
  </div>
</div>
<script src="https://assets.traveltriangle.com//assets/agent/travel_detail/upload_pan_passport-91e73527be38a9f358799263ef97659f.js" type="text/javascript"></script>

<style>

</style>

<script>
  $('.issued-datepicker').Zebra_DatePicker({
    show_icon: false, default_position: "below", format: 'd/m/Y', direction: -1,
    onSelect: function() {
      $(this).removeClass('input-error-message');
      $(this).siblings('span').addClass('hide');
    }
  });

  $('.expiry-datepicker').Zebra_DatePicker({
    show_icon: false, default_position: "below", format: 'd/m/Y', direction: 1,
    onSelect: function() {
      $(this).removeClass('input-error-message');
      $(this).siblings('span').addClass('hide');
    }
  });

  $('.contentModal').hide();

  $(document).on('click', "#travelerDocAction_adult_4_edit", function (e) {
    e.preventDefault();
    $(".travelerDocDetailModal_adult_4").show();

    $('body').css('overflow', 'hidden');
  });

  $(document).on('click', '.travelerDocDetailModalDismiss', function () {
    var id = $(this).attr('id');
    var formattedId = ".travelerDocDetailModal_" + id;
    $(formattedId).hide();
    var viewId = "#view-modal-" + id;
    var editId = "#edit-modal-" + id;
    if ($(viewId).length) {
      $(viewId).removeClass('hide');
      $(editId).addClass('hide');
    }
    $('body').css('overflow', '');
  });
</script>

                  </li>
              </ul>
            </div>
          <!--<li class="user-name">-->
            <!--<div class="user-avatar">-->
              <!---->
            <!--</div>-->
            <!--<div class="user-name-meta">-->
              <!---->
              <!--<h3></h3>-->
            <!--</div>-->
          <!--</li>-->
        </ul>
      </div>
    </div>
    <!--<div class="content-box-title"><h3 class="txt-center"><i class="fa fa-angle-down"></i> View Past Travel Details</h3></div>-->
    <!--<div class="content-box-inner p_l_r30">-->
    <!--<ul class="txt-list style1">-->
    <!--<li><span class="left-txt">Last Trip Date </span> <span class="right-txt">April 19, 2014</span></li>-->
    <!--<li><span class="left-txt">Last Trip Destination</span> <span class="right-txt">Singapore</span></li>-->
    <!--<li><span class="left-txt">TT Advisor for Trip</span> <span class="right-txt">Saifi</span></li>-->
    <!--<li><span class="left-txt">Budget </span> <span class="right-txt">13000 Per Person</span></li>-->
    <!--<li><span class="left-txt">TT Rating for Traveler</span> <span class="right-txt">Good</span></li>-->
    <!--<li><span class="left-txt">Mode of Payment</span> <span class="right-txt">Credit Card</span></li>-->
    <!--<li><span class="left-txt">Past Cancellation / Postponement</span> <span class="right-txt">None</span></li>-->
    <!--<li><span class="left-txt">Specific Information about Traveler</span> <span class="right-txt">NA</span></li>-->
    <!--</ul>-->
    <!--<ul class="social-connect clear-fix">-->
    <!--<li><a href="#"><i class="fa fa-facebook"></i></a></li>-->
    <!--<li><a href="#"><i class="fa fa-linkedin"></i></a></li>-->
    <!--</ul>-->
    <!--</div>-->
  </div>
</div>



<div class="popup" id="cancelled_trip_reason_form">
  <div class="popup-header">
    <h3>Reason</h3>
  </div>
  <div class="popup-content">
    <div class="form">
      <form accept-charset="UTF-8" action="/requested_trips/5058547-Ashwani-Kumar/notify_ops_for_cancelled_trip" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="iDFjdQQhR2kReB8A5QUpAZtGOyH9c/iBXbFEbBdSOHE=" /></div>
          <p style="color: #494949;font-weight: 600;">Reason for checking this trip</p>
          <div class="form-row">
            <textarea class="input txtarea validate-text" id="reason" name="reason" placeholder="Add your own comments">
</textarea>
          </div>

          <div class="form-row" align="right">
            <a href="#" class="cancle-popup-btn" value="Cancel">Cancel</a>
            <input class="send-btn validate-form" id="submit2" name="commit" type="submit" value="SEND" />
          </div>
</form>    </div>
  </div>
</div>

<div class="popup test" id="agent_call_recording_popup">
  <div class="popup-header">
    <h3>Call History</h3>
  </div>
  <div class="popup-content" id="agent_call_data">
  </div>
</div>

<script>
    function get_phone_number_for_cancelled() {
        showPopup('#cancelled_trip_reason_form');
    }

    function call_history(req_trip_id)
    {
      $.ajax({
        url: '/agent_call_history/' + req_trip_id,
        success: function (data) {
          showPopup('#agent_call_recording_popup');
          $("#agent_call_data").html(data);
        }
      });
    }

    function fire_ga_event() {
        var funnel_stage = "";
        var funnel = {};
        ;
        funnel['in_funnel'] = true;
        funnel['funnel_stage'] = 'Post Stay';
        if (funnel['in_funnel']) {
            funnel_stage = "Lead Stage: " + funnel['funnel_stage'];
        }
        else {
            funnel_stage = "Status: " + 'Converted';
        }
        _gaq.push(["_trackEvent", "Chat", "Chat_Full_view", "5058547" + "|" + funnel_stage + "|" + "Srinagar"]);
    }
    $(".email").click(function () {
        var funnel_stage = $(this).text();
        _gaq.push(['_trackEvent', 'Trip_full_view', "Email_id", funnel_stage]);
    });

    $(".got-it").on('click', function () {
        var login_id=getCookie("u_sid")!=null ? getCookie("u_sid") : getCookie("u_id");
        _gaq.push(["_trackEvent","Full_Contact","Got it","Ashwani Kumar"+'|'+$('#new-ui-gender').text()+'|'+$('#new-ui-loc').text()+'|'+$('#new-ui-designation').text()+'|'+ "5058547"+'|'+login_id.toString()]);
        avoidLoadingOnPage(false);
        $(".trav-det-step1").hide();
        $(".trav-det-step2").show();
        $.ajax({
            url:'/agents/cache_data_for_agents',
            data: { action_from: 'full_contact_new' },
            method: 'GET',
            success: function () {
                avoidLoadingOnPage(true);
            }

        });

    });
    $(".trav-det-step2 label").on('click', function () {
        var login_id=getCookie("u_sid")!=null ? getCookie("u_sid") : getCookie("u_id");
        $(".trav-detail-tooltip").hide();
        $(".traveler-detail-overlay").hide();
        $(".usefull-info").show();
        var id=$(this).attr('for');
        _gaq.push(["_trackEvent","Full_Contact",$('label[for='+id+']').text(),"Ashwani Kumar"+'|'+$('#new-ui-gender').text()+'|'+$('#new-ui-loc').text()+'|'+$('#new-ui-designation').text()+'|'+ "5058547"+'|'+login_id.toString()]);
    });

    $('.usefull-info input[type=radio]').on('click',function(){
        var login_id=getCookie("u_sid")!=null ? getCookie("u_sid") : getCookie("u_id");
        var id=$(this).attr('id');
        if ($('label[for='+id+']').text().trim()=='Yes')
            var val='Info_useful';
        else
            var val='Info_usless';
        _gaq.push(["_trackEvent","Full_Contact",val,"Ashwani Kumar"+'|'+$('#new-ui-gender').text()+'|'+$('#new-ui-loc').text()+'|'+$('#new-ui-designation').text()+'|'+ "5058547"+'|'+login_id.toString()]);
    });
    $(document).ready(function () {
            $('#traveler-info-new-ui').hide();
            $('#traveler-info-old-ui').show();
    });
    $('.js-hover-show-box').mouseover(function(){
      $(this).parent(".msg_box_container_big").find(".js-msg_box_hover_conternt").show();
    });
    $('.js-hover-show-box').mouseout(function() {
      $(this).parent(".msg_box_container_big").find(".js-msg_box_hover_conternt").hide();
    });
    $(document).ready(function(){
      $(".js-copied-box-show").click(function(){
        $(this).closest(".msg_copy_mail_container").find(".copied_checked_field_mark").show().delay(5000).fadeOut('fast');

      });
    });
    function copyToClipboard(text_to_copy, trip_id, user_id) {
      var $temp = $("<input>");
      $("body").append($temp);
      $temp.val(text_to_copy).select();
      document.execCommand("copy");
      $temp.remove();
      _gaq.push(["_trackEvent","Masked_Email","copy_Mail",text_to_copy+"|"+trip_id+"|"+user_id]);
    }
    function send_email_ga(email, trip_id, user_id){
      _gaq.push(["_trackEvent","Masked_Email","Send_Mail",email+"|"+trip_id+"|"+user_id]);
    }
    $(".add-note-icon.info-icon").mouseover(function(){
      _gaq.push(["_trackEvent","Traveler_view","location_hover", '  ']);
    });

    function call_traveller(phone_no){
      $.ajax({
        url:'/requested_trips/5058547/call_traveller.js',
        data: { phone: phone_no, logged_in_user_id: '' },
        method: 'POST',
        success: function () {
          
        }
      });
    }

</script>


        <div id="lead-journey-container">
          <div class="sidebar-box content-box" id="leadJourney">
            <div class="box-title clear-fix">
              <div class="panelLeftH">&nbsp;</div>
              <h2 class="fl">Lead Progress</h2>
              <div id="lead-journey-reject-lead-container" class='flexFull text-right'>
                    <div class="dropdown-wrapper">
                   <button class="pfc2 fw7 cursorP removeLead gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Header" data-galocal-cta="Remove Lead" data-galocal-action="Remove Lead" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" style="float: right; background: none !important;" type="submit" name="submit" id="submit" value="Remove Lead">Remove Lead</button>
                    <div class="dropdown-box" style="min-width: 180px; padding: 0; border-radius: 2px; right:0; top: 20px;">
                      <div class="dropdown-box-content" style="padding:0;">
                        <ul class="reject-reason" style="margin:0;">
                          <li><label style="padding: 4px 10px;" class="add-notepp cursorP gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Header" data-galocal-cta="Remove Lead" data-galocal-action="Remove Lead" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" style="float: right" id="remove-lead-not-reachable" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">Tried Enough, Not Responding</li>
                          <li><label style="padding: 4px 10px;" class="add-notepp cursorP gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Header" data-galocal-cta="Remove Lead" data-galocal-action="Remove Lead" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" style="float: right" id="remove-lead" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">Booked with Someone Else</li>
                          <li><label style="padding: 4px 10px;" class="add-notepp cursorP gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Header" data-galocal-cta="Remove Lead" data-galocal-action="Remove Lead" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" style="float: right" id="remove-lead-cancelled-plan" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">Trip Cancelled</li>
                       </ul>
                      </div>
                    </div>
                  </div>
              </div>
            </div>
            <div class="panelLeftC panelbt" style="display: block" id="leadJourneyContainer">
              <link href="https://assets.traveltriangle.com//assets/gamification/style-b50faafacf68f406dbbf3b1aa191f137.css" media="screen" rel="stylesheet" type="text/css" />
    <div class="pl15 pr15">
      <div class="p15 leadStatgeHead">
        <p class="f12 m0 mb15">Simpler way to keep a track by adding relevant notes. </p>
        <div class="flex alignCenter">
          <p class="f10 m0 fw7">Ph. No.: +919871554457</p>
        </div>
      </div>
      <!--Timeline starts here -->
      <div class="leadTimelineContainer relative pt15">
        <!--Quote Creation starts-->
        <div class="leadTimelineCard leadTimelineCardActive">
          <div class="mb15 flex alignCenter leadTimelineCardHead">
            <h5 class="m0 flexFull leadTimelineCardHeading">Quoting</h5>
            <span class="flex icon16 block ml5 cardTrigger"></span>
          </div>
          <div class="leadTimelineCardContent">
              <div id="create-quote-stage">
                <div class="flex spaceBetween mb8">
                  <span class="flex icon10 block iconBG tickGreenIcon"></span>
                  <p class="m0 f10 pfc1 flexFull ml8">Lead Received</p>
                    <p class="m0 f10 pfc4 flexFull text-right noWrap">over 2 years ago</p>
                </div>
                <div>
                  <div class="relative">
                      <div class="flex alignCenter mb15">
                        <span class="flex icon10 block iconBG tickGreenIcon"></span>
                        <p class="m0 f10 pfc1 ml8">Phone Number Unlocked</p>
                          <p class="m0 f10 pfc4 flexFull text-right noWrap">over 2 years ago</p>
                      </div>
                      <button class="btnSecondaryMain mt8">+919871554457</button>
                  </div>
                </div>

                <div class="leadStageTip flex alignCenter mt15">
                    <span class="flex icon16 iconBG tipIcon block"></span>
                    <p class="f10 m0 ml4 pfc4">Tip: Use best matching quote to send quickly</p>
                  </div>
              </div>
          </div>
        </div>
        <!--Quote Creation ends-->
        <!--Contacting Traveler starts-->
          <div class="leadTimelineCard leadTimelineCardActive">
            <div class="mb15 flex alignCenter leadTimelineCardHead">
              <h5 class="m0 flexFull leadTimelineCardHeading">Contacting</h5>
              <span class="flex icon16 block cardTrigger"></span>
            </div>
            <div class="leadTimelineCardContent">
              <div id="contact-traveller-stage">
                  <div class="flex alignCenter mb15">
                    <span class="flex icon10 block iconBG tickGreenIcon"></span>
                    <p class="m0 f10 pfc1 ml8">+919871554457</p>
                    <a href="" class="defaultLink m0 ml8 pfc2 f12 fw7 cursorP fitalic text-right add-notepp gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Contacting" data-galocal-cta="Report if incorrect" data-galocal-action="Report if incorrect" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" id="number-not-working" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
                      Report if incorrect
                    </a>
                  </div>

                <div>
                  <div class="flex flexDColumn">
                    <a id="call-not-picked" class="leadStagesAction p8 mb8 iblock f12 cursorP fitalic add-notepp gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Contacting" data-galocal-cta="Send Whatsapp/SMS to customer" data-galocal-action="Send Whatsapp/SMS to customer" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
                      <span class="flex">
                        <span class="flex icon20 block iconBG cnpIcon"></span>
                        <span class="flexFull ml8">
                          <span class="block f12 m0 pfc3">Call not picked?</span>
                          <span class="block pfc2 f12 fw7 leadStagesAction__link">Mark unable to reach customer</span>
                        </span>
                      </span>
                    </a>


                  </div>
                  <a onclick="sendQuoteWhatsappRedirect()" class="leadStagesAction p8 mb8 flex f12 cursorP fitalic gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Finalizing" data-galocal-cta="Send Whatsapp confirmation" data-galocal-action="Send Whatsapp confirmation" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000">
                    <span class="flex icon20 block iconBG whatsAppIcon"></span>
                    <span class="flexFull ml8">
                      <span class="block f12 m0 pfc3">Share quote on Whatsapp?</span>
                      <span class="block pfc2 f12 fw7 leadStagesAction__link">Click here to send</span>
                    </span>
                  </a>

                  <a class="leadStagesAction p8 mb8 flex f12 cursorP fitalic add-notepp gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Contacting" data-galocal-cta="Resend quote and set reminder" data-galocal-action="Resend quote and set reminder" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" id="quote-not-seen" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
                    <span class="flex icon20 block iconBG quoteNotSeenIcon"></span>
                    <span class="flexFull ml8">
                      <span class="block f12 m0 pfc3">Quote not seen?</span>
                      <span class="block pfc2 fw7 leadStagesAction__link">Resend quote & set a reminder</span>
                    </span>
                  </a>
                  <a href="" class="leadStagesAction p8 mb8 flex f12 cursorP fitalic add-notepp gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Contacting" data-galocal-cta="Set reminder for when to call next" data-galocal-action="Set reminder for when to call next" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" id="book-later" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
                    <span class="flex icon20 block iconBG bookWaitingIcon"></span>
                    <span class="flexFull ml8">
                      <span class="block f12 m0 pfc3">Talk in progress?</span>
                      <span class="block pfc2 fw7 leadStagesAction__link">Set reminder for when to call next</span>
                    </span>
                  </a>

                </div>
                <div class="leadStageTip flex alignCenter mt15">
                  <span class="flex icon16 iconBG tipIcon block"></span>
                  <p class="f10 m0 ml4 pfc4">Tip: Ask for best time to contact on Whatsapp</p>
                </div>
              </div>
            </div>
          </div>
        <!--Contacting Traveler ends-->
        <!--Mark unable to reach customer starts-->
          <div class="leadTimelineCard leadTimelineCardActive">
            <div class="mb15 flex alignCenter leadTimelineCardHead">
              <h5 class="m0 flexFull leadTimelineCardHeading">Customizing</h5>
              <span class="flex icon16 block cardTrigger"></span>
            </div>
            <div class="leadTimelineCardContent">
              <div id="customize-quote-stage">
                <div>
                  <div class="flex mb15">
                    <div class="flexFull ml15">
                    </div>
                  </div>
                  <a onclick="sendQuoteWhatsappRedirect()" class="leadStagesAction p8 mb8 flex f12 cursorP fitalic gatracking seg-tracked" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Customizing" data-galocal-cta="Send Whatsapp confirmation" data-galocal-action="Send Whatsapp confirmation" data-galocal-tripid="5058547">
                    <span class="flex icon20 block iconBG whatsAppIcon"></span>
                    <span class="flexFull ml8">
                      <span class="block f12 m0 pfc3">Already customised?</span>
                      <span class="block pfc2 f12 fw7 leadStagesAction__link">Send WhatsApp confirmation</span>
                    </span>
                  </a>
                  <a href="" class="leadStagesAction p8 mb8 flex f12 cursorP fitalic gatracking add-notepp seg-tracked" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Customizing" data-galocal-cta="Set reminder for when to call next" data-galocal-action="Set reminder for when to call next" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" id="book-later" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
                    <span class="flex icon20 block iconBG bookWaitingIcon"></span>
                    <span class="flexFull ml8">
                      <span class="block f12 m0 pfc3">Talk in progress?</span>
                      <span class="block pfc2 f12 fw7 leadStagesAction__link">Set reminder for when to call next</span>
                    </span>
                  </a>
                  <a id="call-not-picked" class="leadStagesAction p8 mb8 flex f12 cursorP fitalic gatracking add-notepp seg-tracked" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Customizing" data-galocal-cta="Send Whatsapp/SMS to customer" data-galocal-action="Send Whatsapp/SMS to customer" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
                    <span class="flex icon20 block iconBG cnpIcon"></span>
                    <span class="flexFull ml8">
                      <span class="block f12 m0 pfc3">Call not picked?</span>
                      <span class="block pfc2 f12 fw7 leadStagesAction__link">Mark unable to reach customer</span>
                    </span>
                  </a>
                  <a class="leadStagesAction p8 mb8 flex f12 cursorP fitalic gatracking add-notepp seg-tracked" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Customizing" data-galocal-cta="Mark as My Priority" data-galocal-action="Mark as My Priority" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" id="mark-priority" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
                    <span class="flex icon20 block iconBG thumbUpIcon"></span>
                    <span class="flexFull ml8">
                      <span class="block f12 m0 pfc3">Booking Soon?</span>
                      <span class="block pfc2 f12 fw7 leadStagesAction__link">Mark as my priority</span>
                    </span>
                  </a>

                </div>
                <div class="leadStageTip flex alignCenter mt15">
                  <span class="flex icon16 iconBG tipIcon block"></span>
                  <p class="f10 m0 ml4 pfc4">Tip: Check with TT for better prices from TTSN</p>
                </div>
              </div>
            </div>
          </div>
        <!--Customizing ends-->
        <!--Finalizing starts-->
          <div class="leadTimelineCard leadTimelineCardActive">
            <div class="mb15 flex alignCenter leadTimelineCardHead">
              <h5 class="m0 flexFull leadTimelineCardHeading">Finalizing</h5>
              <span class="flex icon16 block cardTrigger"></span>
            </div>
            <div class="leadTimelineCardContent">
              <div id="finalize-stage">
                <div>
                  <a onclick="sendQuoteWhatsappRedirect()" class="leadStagesAction p8 mb8 flex f12 cursorP fitalic gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Finalizing" data-galocal-cta="Send Whatsapp confirmation" data-galocal-action="Send Whatsapp confirmation" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000">
                    <span class="flex icon20 block iconBG whatsAppIcon"></span>
                    <span class="flexFull ml8">
                      <span class="block f12 m0 pfc3">Already customised?</span>
                      <span class="block pfc2 f12 fw7 leadStagesAction__link">Send WhatsApp confirmation</span>
                    </span>
                  </a>
                  <a id="call-not-picked" class="leadStagesAction p8 mb8 flex f12 cursorP fitalic add-notepp gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Finalizing" data-galocal-cta="Report if incorrect" data-galocal-action="Report if incorrect" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
                    <span class="flex icon20 block iconBG cnpIcon"></span>
                    <span class="flexFull ml8">
                      <span class="block f12 m0 pfc3">Call not picked?</span>
                      <span class="block pfc2 f12 fw7 leadStagesAction__link">Mark unable to reach customer</span>
                    </span>
                  </a>
                  <a href="" class="leadStagesAction p8 mb8 flex f12 cursorP fitalic add-notepp gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Finalizing" data-galocal-cta="Traveler going to pay soon" data-galocal-action="Traveler going to pay soon" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" id="traveler-pay-you" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
                    <span class="flex icon20 block iconBG moneyIcon"></span>
                    <span class="flexFull ml8">
                      <span class="block f12 m0 pfc3">Traveler going to pay soon?</span>
                      <span class="block pfc2 f12 fw7 leadStagesAction__link">Set reminder for when to follow up next</span>
                    </span>
                  </a>
                  <a href="" class="leadStagesAction p8 mb8 flex f12 cursorP fitalic add-notepp gatracking" data-event="click" data-verb="Agent Clicked" data-galocal-section="Lead Stage" data-galocal-value="1"  data-galocal-object="Finalizing" data-galocal-cta="Booked with someone else" data-galocal-action="Booked with someone else" data-galocal-tripid="5058547" data-galocal-impersonatersuserid="" data-galocal-impersonatestatus="false" data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000" id="remove-lead" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
                    <span class="flex icon20 block iconBG thumbDownIcon"></span>
                    <span class="flexFull ml8">
                      <span class="block f12 m0 pfc3">Booked with someone else?</span>
                      <span class="block pfc2 f12 fw7 leadStagesAction__link">Remove Lead</span>
                    </span>
                  </a>
                </div>
                <div class="leadStageTip flex alignCenter mt15">
                  <span class="flex icon16 iconBG tipIcon block"></span>
                  <p class="f10 m0 ml4 pfc4">Tip: Call TT to check discounts</p>
                </div>
              </div>
            </div>
          </div>
        <!--Finalizing ends-->
        <!--Converted starts-->
        <div class="leadTimelineCard leadTimelineCardActive">
          <div class="mb15 flex alignCenter leadTimelineCardHead">
            <h5 class="m0 flexFull leadTimelineCardHeading">Converted</h5>
            <span class="flex icon16 block cardTrigger"></span>
          </div>
          <div class="leadTimelineCardContent">
            <div id="converted-stage">
              <div class="flex alignCenter mb8">
                <span class="flex icon10 block iconBG tickGreenIcon"></span>
                <div class="ml8">
                  <p class="m0 f10 pfc1">Payment Confirmed</p>
                </div>
              </div>
              <div class="flex alignCenter mb8">
                <span class="flex icon10 block"></span>
                <div class="ml8">
                  <p class="f10 m0" style="line-height: 16px;">Congratulations! We have received the payment from the traveler. We trust you with providing the best service.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!--Converted ends-->
        <!--Trip Completed starts-->
          <div class="leadTimelineCard leadTimelineCardActive">
            <div class="mb15 flex alignCenter leadTimelineCardHead">
              <h5 class="m0 flexFull leadTimelineCardHeading">Trip Completed</h5>
              <span class="flex icon16 block cardTrigger"></span>
            </div>
            <div class="leadTimelineCardContent">
              <div id="trip-completed">
                  <div class="flex alignCenter mb8">
                    <p class="f10 m0" style="line-height: 16px;">This allows you to request change in the existing review.</p>
                  </div>
                  <button class="btnPrimaryMain ripple gatracking"
                            id="tripRequestChange"
                            data-event="click"
                            data-verb="Agent Clicked"
                            data-galocal-section="Lead stage"
                            data-galocal-value="1"
                            data-galocal-object="Trip completed"
                            data-galocal-cta="Request Change"
                            data-galocal-action="Request Change"
                            data-galocal-tripid="5058547"
                            data-galocal-impersonatersuserid=""
                            data-galocal-impersonatestatus="false"
                            data-galocal-eventtimestamp="2021-11-22 09:14:31 +0000"
                            data-trip-id="5058547"
                            data-quote-id="9048137"
                            data-galocal-spocuserid=""
                           >
                      Request Change
                    </button>
              </div>
            </div>
          </div>
        <!--Trip Completed ends-->
      </div>
        <!--Timeline ends here -->
    </div>

<script>
  function sendQuoteWhatsappRedirect() {
      var download_urls = {"9048137":"https://trvt.in/0jsWHoBkP"};
      var quote_id = $(".active-quote").attr('data-quote');
      if (typeof quote_id == 'undefined')
        quote_id = 9048137;
      var quote_link = download_urls[quote_id];
      var url = "https://web.whatsapp.com/send?phone=+919871554457&text=Dear Ashwani Kumar, Please check the quote and let us know if any changes required. Link - " +quote_link+ " . Thanks"
      window.open(url, '_blank');
  }

  function copyToClipboard(element) {
      var $temp = $("<input>");
      $("body").append($temp);
      $temp.val($(element).text()).select();
      document.execCommand("copy");
      $temp.remove();
  }

  function ask_for_review(edit){
      var params = {};
      params["trip_id"] = 5058547;
      if (edit == true) {
          params["edit"] = true;
      }
      $.get("/agents/v2/ask_for_review/", params, function(response, status){
          if(response.data.success) {
              alert(response.data.message);
          } else {
              alert("Failed to perform the operation. Please try again later.");
          }
      });
  }


  // Ask for review
  $("#tripAskForReview").click(function(){
      ask_for_review(false);
  });

  // Request Change
  $("#tripRequestChange").click(function(){
      ask_for_review(true);
  });


  $(document).ready(function(){
    // Accordian.
    $('.leadTimelineCardActive').last().addClass('cardOpen currentStage');
    $('.cardTrigger').each(function(){
        if($(this).parents('.leadTimelineCard').hasClass('leadTimelineCardActive')){
            $(this).click(function(){
                if($(this).parents('.leadTimelineCard').hasClass('cardOpen')){
                    $(this).parents('.leadTimelineCard').removeClass('cardOpen');
                } else {
                    $('.leadTimelineCard').removeClass('cardOpen'); // Accordian Part
                    $(this).parents('.leadTimelineCard').addClass('cardOpen');
                }
            });
        }
    });
/*
    setTimeout(function(){
        $('.leadTimelineCardActive').last().removeClass('currentStage');
     }, 8000);
*/

});

var maxLength = 80;
var y = document.querySelectorAll('.noteMessage');
for (var i=0; i<y.length; i++){
    var x = y[i].innerText;
    if(x.length > maxLength){
        var newStr = x.substring(0, maxLength);
        var removedStr = x.substring(maxLength, x.length);
        var addStr = "<span>"+newStr+" <span class='js-readMore' onclick='readMore(this)'>read more</span></span><span class='js-readMoreH'>"+removedStr+" <span class='js-readLess' onclick='readLess(this)'>read less</span></span>"
        var htmlObject = document.createElement('P');
        htmlObject.innerHTML = addStr;
        y[i].innerHTML='';
        y[i].append(htmlObject);
    }
}
function readMore(e){
    e.parentNode.parentNode.querySelector('.js-readMoreH').style.display='inline';
    e.parentNode.parentNode.querySelector('.js-readMore').style.display='none';
}
function readLess(e){
    e.parentNode.parentNode.querySelector('.js-readMoreH').style.display='none';
    e.parentNode.parentNode.querySelector('.js-readMore').style.display='inline';
}

</script>

            </div>
          </div>
        </div>
        <link href="https://assets.traveltriangle.com//assets/checkboxCustom-bf88b9fd76da97d317ac0f20eebb6e1d.css" media="screen" rel="stylesheet" type="text/css" />
<style>
.noteFilterLabel{
  font-size:12px!important;
  padding-left:24px!important;
  margin-right:8px!important;
  color:#3e3e3e!important;
}
.noteContainerScroll .mCSB_container{
  padding : 0 12px 0 8px;
  margin-right: 0;
}
.noteContainerScroll .mCSB_scrollTools{
  width: 8px;

}
.noteContainerScroll .mCSB_scrollTools .mCSB_dragger .mCSB_dragger_bar{
width:8px!important; 
background:#c6c6c6!important;
}
</style>
<div class="sidebar-box content-box" id="notes">
  <div class="box-title clear-fix">
    <div class="panelLeftH">&nbsp;</div>
    <h2 class="fl">Notes</h2>
    <span class='ml8'><img src="https://img.traveltriangle.com//assets/new_ui_images/agents/notesIcon-d7da991f1a8ec71565f6f02658f7a8ad.png"/></span>
  </div>

  <div class="clearfix add-note-set-reminder hide">
    <h3>Select icons to <strong>Add Note</strong> & <strong>Set Reminder</strong></h3>
        <a class="add-notepp add_note_full_view_5058547" href="#"  id="not-reachable" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
          <div class="col-3 ph-0">
            <span class="add-note-icon sprite-agent not-reachable"></span>
            <p>Not reachable</p>
            <div class="not-intrs-tooltip ">
              <span class="tttriangle "></span>
              <p>Traveler not reachable</p>
            </div>
          </div>
        </a>
        <a class="add-notepp add_note_full_view_5058547" href="#"  id="not-book" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
          <div class="col-3 ph-0">
            <span class="add-note-icon sprite-agent not-book"></span>
            <p>Won’t book with me</p>
            <div class="not-intrs-tooltip ">
              <span class="tttriangle "></span>
              <p>Won&#x27;t book with me</p>
            </div>
          </div>
        </a>
        <a class="add-notepp add_note_full_view_5058547" href="#"  id="talk-progress" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
          <div class="col-3 ph-0">
            <span class="add-note-icon sprite-agent talk-progress"></span>
            <p>Talk in progress</p>
            <div class="not-intrs-tooltip ">
              <span class="tttriangle "></span>
              <p>Talk in progress with traveler</p>
            </div>
          </div>
        </a>
        <a class="add-notepp add_note_full_view_5058547" href="#"  id="finalize-soon" data-trip-id="5058547" data-quote-id="9048137" data-agent-status="4.1" data-latest-quote="9048137">
          <div class="col-3 ph-0">
            <span class="add-note-icon sprite-agent finalize-soon"></span>
            <p>Finalizing soon</p>
            <div class="not-intrs-tooltip last-tip">
              <span class="tttriangle last-tip-arrow"></span>
              <p>Traveler will finalize and is &#x27;My Hot&#x27;</p>
            </div>
          </div>
        </a>
  </div>
  <!--add-note-set-reminder-->

  <div class="panelLeftC">
    <div class='noteFilter pl8 pr8'>
      <input type="checkbox" id="myNotes" value='note_added_by_agent' checked='true' class="checkbox-common">
      <label for="myNotes" class='noteFilterLabel'>My Notes</label>
      <input type="checkbox" id="ttAdmin"  value='note_added_by_admin' checked='true' class="checkbox-common">
      <label for="ttAdmin" class='noteFilterLabel'>TT Admin</label>
      <input type="checkbox" id="system"  value='note_added_by_system' checked='true' class="checkbox-common">
      <label for="system" class='noteFilterLabel'>System</label>
    </div>                                                
    <div class="panelbt noteContainerScroll">
      <div class="blog-post mt15">
        <div id="notes_content_5058547">
          <style>
.notebox{
  margin:15px 0 15px 0;
  padding: 8px;
  position: relative;
}
.notebox:last-child{
  margin-bottom:0;
}
.notesImageCorner{
  display:none;
}
.notebox.note_added_by_agent{
  background: #fff4b3;
  position: relative;
  border-radius: 2px;
  box-shadow: -1px 3px 7px 2px #d4d2cf;
}
.note_added_by_agent .post-heading{
  font-weight: bold;
}
.notebox.note_added_by_agent .notesImageCorner{
  display:block;
}
.notebox.note_added_by_agent .noteMessage{
  margin-bottom: 18px;
}
.notesImageCorner{
  position: absolute;
  bottom: -11px;
  right: -8px;
}
.ellipsisUser{
  overflow: hidden;
  text-overflow: ellipsis;
  width: 145px;
  white-space: nowrap;
  color: #3e3e3e;
}
.note_added_by_agent .ellipsisUser{
  color:#55c4c1;
}
</style>
      <div class="notebox note_added_by_admin">
      <div class='flex alignCenter mb8'>
        <span class='fw9 f14 ellipsisUser'>TT Admin</span>
        <span class='f10 text-right flexfull' style='color:#9f9f9f'>18:58 hrs, 17 Jun 2019</span>
      </div>
          <!-- <div class="blog-dp">
            <span class="dp"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></span>
          </div> -->
          <div class="post-list-text pb8">
            <div class='noteMessage'><p class="post-heading  f12">#saurabh will close tomorrow, take a strong follow up from your side as well#Manual_Payment Pending</p></div>
            <div class='noteMessage'><p class=" post-text-new pfc3 f12 m0"></p></div>
                <!-- <a id = "subject__"><p class = "cursor-pointer-subject"><span>View sample mail sent to traveler</span></p></a>
                <div class="js_image_popup_count image_popup_count" id = "image_popup__" style="display: none;">
                <div class="image_popup_count_main"><img src='' /></div> </div> -->
          </div>
         <!-- <div class="col-3 blog-dp">
            <span class="dp">&nbsp;</span>
          </div> --> <!--col-->
          <div class="post-list-text" style="padding-left: 0;padding-right: 0;padding-bottom: 0;">
            <div class='post-text-new noteMessage'><p></p></div>
            <h5 class='flex alignCenter'>
              </span>
            </h5>
        </div>
        <span class='notesImageCorner'><img src="https://img.traveltriangle.com//assets/new_ui_images/agents/NotesImageCorner-4ef6dceec009b306825e851d0bad54c1.png"></span>
        </div>

<script>
$("document").ready(function(e) {
    $("#subject_5058547_1").on('click', function(){
      $("body, html").addClass("overflow-hidden");
      $("#image_popup_5058547_1").fadeIn();
      _gaq.push(['_trackEvent','Add note V2','Subject_Mail_Click ',$(this).text()]);
    });
    $("#image_popup_5058547_1").on('click', function(){
      $("body, html").removeClass("overflow-hidden");
      $(this).fadeOut();
    });
});

</script>
      <div class="notebox note_added_by_agent">
      <div class='flex alignCenter mb8'>
        
        <span class='f10 text-right flexfull' style='color:#9f9f9f'>16:47 hrs, 17 Jun 2019</span>
      </div>
          <!-- <div class="blog-dp">
            <span class="dp"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></span>
          </div> -->
          <div class="post-list-text pb8">
            <div class='noteMessage'><p class="post-heading  f12">Talk in progress with traveler</p></div>
            <div class='noteMessage'><p class=" post-text-new pfc3 f12 m0">Initial stage only - Quote not seen</p></div>
                <!-- <a id = "subject__"><p class = "cursor-pointer-subject"><span>View sample mail sent to traveler</span></p></a>
                <div class="js_image_popup_count image_popup_count" id = "image_popup__" style="display: none;">
                <div class="image_popup_count_main"><img src='' /></div> </div> -->
          </div>
         <!-- <div class="col-3 blog-dp">
            <span class="dp">&nbsp;</span>
          </div> --> <!--col-->
          <div class="post-list-text" style="padding-left: 0;padding-right: 0;padding-bottom: 0;">
            <div class='post-text-new noteMessage'><p>traveler need 3n 4 days  packege sent on whats app</p></div>
            <h5 class='flex alignCenter'>
              </span>
            </h5>
        </div>
        <span class='notesImageCorner'><img src="https://img.traveltriangle.com//assets/new_ui_images/agents/NotesImageCorner-4ef6dceec009b306825e851d0bad54c1.png"></span>
        </div>

<script>
$("document").ready(function(e) {
    $("#subject_5058547_2").on('click', function(){
      $("body, html").addClass("overflow-hidden");
      $("#image_popup_5058547_2").fadeIn();
      _gaq.push(['_trackEvent','Add note V2','Subject_Mail_Click ',$(this).text()]);
    });
    $("#image_popup_5058547_2").on('click', function(){
      $("body, html").removeClass("overflow-hidden");
      $(this).fadeOut();
    });
});

</script>
      <div class="notebox note_added_by_agent">
      <div class='flex alignCenter mb8'>
        
        <span class='f10 text-right flexfull' style='color:#9f9f9f'>13:13 hrs, 17 Jun 2019</span>
      </div>
          <!-- <div class="blog-dp">
            <span class="dp"><img alt="25398730_1970901499792686_5269957657050947601_n" class="full-round" src="https://img.traveltriangle.com/attachments/users/278401/original/25398730_1970901499792686_5269957657050947601_n.png?tr=,w-100,h-100" /></span>
          </div> -->
          <div class="post-list-text pb8">
            <div class='noteMessage'><p class="post-heading  f12">Talk in progress with traveler</p></div>
            <div class='noteMessage'><p class=" post-text-new pfc3 f12 m0">Initial stage only - Quote not seen</p></div>
                <!-- <a id = "subject__"><p class = "cursor-pointer-subject"><span>View sample mail sent to traveler</span></p></a>
                <div class="js_image_popup_count image_popup_count" id = "image_popup__" style="display: none;">
                <div class="image_popup_count_main"><img src='' /></div> </div> -->
          </div>
         <!-- <div class="col-3 blog-dp">
            <span class="dp">&nbsp;</span>
          </div> --> <!--col-->
          <div class="post-list-text" style="padding-left: 0;padding-right: 0;padding-bottom: 0;">
            <div class='post-text-new noteMessage'><p>traveler said they will update after checking the quote</p></div>
            <h5 class='flex alignCenter'>
              </span>
            </h5>
        </div>
        <span class='notesImageCorner'><img src="https://img.traveltriangle.com//assets/new_ui_images/agents/NotesImageCorner-4ef6dceec009b306825e851d0bad54c1.png"></span>
        </div>

<script>
$("document").ready(function(e) {
    $("#subject_5058547_3").on('click', function(){
      $("body, html").addClass("overflow-hidden");
      $("#image_popup_5058547_3").fadeIn();
      _gaq.push(['_trackEvent','Add note V2','Subject_Mail_Click ',$(this).text()]);
    });
    $("#image_popup_5058547_3").on('click', function(){
      $("body, html").removeClass("overflow-hidden");
      $(this).fadeOut();
    });
});

</script>
<script>
var maxLength = 120;
var y = document.querySelectorAll('.noteMessage p');
for (var i=0; i<y.length; i++){
    var x = y[i].innerText;
    if(x.length > maxLength){
        var newStr = x.substring(0, maxLength);
        var removedStr = x.substring(maxLength, x.length);
        var addStr = "<span>"+newStr+"<span class='dotesEx'>...</span><span class='js-readMore' onclick='readMore(this)'> read more</span></span><span class='js-readMoreH'>"+removedStr+" <span class='js-readLess' onclick='readLess(this)'>read less</span></span>"
        var htmlObject = document.createElement('p');
        htmlObject.innerHTML = addStr;
        y[i].innerHTML='';
        y[i].append(htmlObject);
    }
}

function readMore(e){
    e.parentNode.parentNode.querySelector('.js-readMoreH').style.display='inline';
    e.parentNode.parentNode.querySelector('.js-readMore').style.display='none';
    e.previousSibling.style.display='none';
}
function readLess(e){
    e.parentNode.parentNode.querySelector('.js-readMoreH').style.display='none';
    e.parentNode.parentNode.querySelector('.js-readMore').style.display='inline';
    e.parentNode.parentNode.querySelector('.dotesEx').style.display= 'inline';
}
</script>
          </div>
      </div><!--blog-post-->
      <!--<div class="fr post-but">-->
      <!--<a href="#" class="button1 red addnote fr" data-trip-id="" data-quote-id="" data-agent-status="">Add note</a>-->
      <!--</div>-->
      <!--<div class="clear-fix"></div>-->
    </div>
  </div>
</div>
<script>
$('.add_note_full_view_5058547').click(function () {
  _gaq.push(['_trackEvent', 'Add_noteV2_full', 'Full_View_Main_Heading', $(this).find('p').last().text()]);
});
$(".noteFilter input").change(function() {
  $(".noteFilter input:checked").each(function() {
      $(".blog-post .notebox." + $(this).val()).show();
  });
  $(".noteFilter input:not(:checked)").each(function() {
      $(".blog-post .notebox." + $(this).val()).hide();
  });
});
</script>
    </div>
    <div class="col-9" id="content-left" style="padding-left:0">

      <div class="give-quote section-head new-section clear-fix my-accordian-head">
        <div class="expand accordion-expand">&nbsp;</div>
        <div class="box-title">
          <h2 class="fl">Traveler requirement</h2>


          
        </div>
      </div>
      <div class="content-box-inner panel content-iner" id="traveller_requirement_container">
      </div>
        <div class="content-box">
          <div class="section-head clear-fix my-accordian-head">
            <div class="expand accordion-expand">&nbsp;</div>
            <h2 class="fl">quotations</h2>



          </div>
          <div class="panel" id="quotes_container">
          </div>
        </div>





        <div>
          <div class="content-box">
            <div class="section-head clear-fix my-accordian-head">
              <div class="expand accordion-expand">&nbsp;</div>
              <h2 class="fl">Voucher & Payment</h2>
              <div class="fr flex alignCenter">
              <span class="top-spinner"> 
              <span class="spinner-Wraper"> 
              <span class="spinner-yellow"> 
              <span class="bounce-sniper-wraper"></span> 
                <span class="double-bounce2-yellow"></span> 
              </span> 
              </span>
              </span>
              <a href="https://www.youtube.com/watch?v=pSb__dOiAAA&amp;feature=youtu.be" target="_blank" class="f14 fw7 colorLink">How it works?</a>
              <!-- <div class="cancel">
              <a href="#" class="cancle-invoice-btn"><img src="https://img.traveltriangle.com//assets/new_ui_images/agents/cancel-icon-cb464aaf90b81956b31837ae7e5e262e.png" alt=""></a>
            </div> -->
              </div>
            </div>
            <div class="panel" id="voucher_payment_container">
            </div>
          </div>
        </div>
        <div class="content-box">
          <div class="section-head clear-fix my-accordian-head">
            <div class="expand accordion-expand">&nbsp;</div>
            <h2 class="fl">Traveler’s Review</h2>
            <div class="fr">
            <!--  <input class="button1 red" type="submit" name="submit" id="submit" value="Mark As resolve">-->
            </div>
          </div>
          <div class="panel" id="trip_feedback_container">
              <div class="content-box-inner">
  <div class="requirment-detail">
    <div class="row">
      <div class="col-9  trip-date-wrap post-full-wrap">
        <div class="trip-new-article post-newarticle">
          <div>
  <ul>
      	<li><h3><span class="heading-text"></span></h3></li>
      	<li><p>Hotel and food quality need improvement, Rest is fine.</p></li>
  </ul>
</div>
        </div>

        <div class="row no-margin-row messgaeforconfirmation_5058547 messgaeforconfirmationsection" data-msg-trip-id='review_5058547'>
                <p class="smalltagforconfirmapproval"><span class="sprite-agent sprite-time-icon-new"></span>Waiting for Admin Approval</p>
<div class="innerarrowformsgshow"></div>
<div class="secondinnerpartformsgshow">
  <p>jklmklml</p>
</div>
 <p class="edit_agent_testimonial button1 blue buton-border mt15 mb0 fright">  <a href="/agents/edit_testimonial_review?trip_id=5058547" data-remote="true">Edit</a></p>
<script>
$(".newtextboxdivforsubbtn_"+5058547).hide();
</script>
            <!-- secondinnerpartformsgshow -->
            <!-- messgaeforconfirmationsection -->
        </div>
      </div>
      <!--col-->
        <div class="col-3 testimonial-wrap">
  <div class="dp-wrap post-style-list">
    <div class="hotel-list-wrap"><span class="hotel-list">Overall rating</span>
      <span class="por">
          <h4><span class="star-text">
		<i class="fa fa-star-o star-trip"></i>
		<i class="fa fa-star-o star-trip"></i>
		<i class="fa fa-star-o star-trip"></i>
		<i class="fa fa-star-o star-trip"></i>
		<i class="fa fa-star-o star-fo"></i>
</span></h4>
      </span>
    </div>
    <div class="hotel-list-wrap"><span class="hotel-list">Hotels </span>
      <span class="por">
          Good
      </span>
    </div>
    <div class="hotel-list-wrap"><span class="hotel-list">Cab & Driver </span>
      <span class="por">
          Very Good
      </span>
    </div>
    <div class="hotel-list-wrap"><span class="hotel-list">Services of Travel Agent </span>
      <span class="por">
          Very Good
      </span>
    </div>
  </div>
</div>  <!--testi-wrap-->

      <div id = "testimonial_review  testimonial_review_5058547" class="testimonial_review" data-review-trip-id='review_5058547'>
      </div>
    </div>
    <!--row-->
  </div>
</div>

<script>
    $(document).on("click", ".rightsidebtnpik" , function(e) {
        e.preventDefault();
        if ($(this).parent().parent().parent().parent().parent().find('.leftpartfortxtboxbig textarea').val().trim() == "")
        {
            $(".overlayforpopupconfirm_alert").show();
            return;
        }
        $(this).parent().parent().parent().find(".overlayforpopupconfirm").show();
    });
    $(document).on("click", ".closeeditview" , function(e) {
        e.preventDefault();
        var trip_id = this.dataset.tripid;
        $(".messgaeforconfirmation_"+ trip_id).show();
        $(".newtextboxdivforsubbtn_"+ trip_id).hide();
    });
    $(document).on("click", ".cancelsmallconfirm" , function(e) {
        e.preventDefault();
        $(".overlayforpopupconfirm").hide();
    });
    $(document).on("click", ".oksmallconfirm" , function(e) {
        e.preventDefault();
        $(".overlayforpopupconfirm_alert").hide();
    });
    $(document).on("click", ".confirmcolorconfirm" , function(e) {
        e.preventDefault();
        var label = $(this).parent().parent().parent().parent().parent().find(".js-counter-view").text();
        var review = $(this).parent().parent().parent().parent().parent().find('.leftpartfortxtboxbig textarea').val();
        var trip_id=$(this).parent().parent().parent().parent().parent().attr("data-review-trip-id");
        trip_id = trip_id.split("_")[1];
        _gaq.push(["_trackEvent", "TestimonialReply", "Submit_review_full ",trip_id + "|" +label]);
        var request = {
            review: review,
            trip_id: trip_id
        }
        $.ajax({
            url: "/agents/testimonial_review",
            data: request,
            method: 'GET',
            dataType: 'script',
            success: function () {
                $(".ajax-loader").hide();

            }

        });
        $(".messgaeforconfirmationsection").show();
        $(".overlayforpopupconfirm").hide();
    });

    $.urlParam = function(name){
        var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
        if (results==null){
            return null;
        }
        else{
            return results[1] || 0;
        }
    }

    $(function(){
        if (!!document.getElementById("testimonial_review")){
            a=$('#testimonial_review').offset().top;
            b=$("#testimonial_review .areaformsgforreview").offset().top;
            $("body").scrollTop(b-a);
        }});

</script>
          </div>
        </div>
  </div>
</div>
<div id="mask"></div>
<div class="overlayforpopupconfirm_alert">
  <div class="popuponactionshowmiddle">
    <div class="uppertextbluepart">
      <p>Alert</p>
    </div><!-- uppertextbluepart -->

    <div class="lowerareaforpopuppart lowerareaforpopuppart_alert">
      <p><span class="sprite-agent sprite-disclaimer"></span>Testimonial Review Cannot Be Blank</p>
      <div class="col-4"></div>
      <div class="col-8 rightbtnfordoubleconfirm"><a class="cancelsmallconfirm oksmallconfirm" href="#">OK</a> </div>
      <div class="clear"></div>
    </div><!-- lowerareaforpopuppart -->
  </div><!-- popuponactionshowmiddle -->
</div>
<div id="js-add-note-popup" class="add-note-popup"></div>

<div id="js-add-note-inner" class="add-note-inner addnote">
  <h3>Add Note - TRIP ID <span id="note_trip_id"></span></h3>

  <div class="form">
    <form accept-charset="UTF-8" action="" data-remote="true" id="note-form" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="iDFjdQQhR2kReB8A5QUpAZtGOyH9c/iBXbFEbBdSOHE=" /></div>
        <input type="hidden" name="remark[followup_status]" id="note_remark_status" value=""/>

        <div class="trav-not-int clearfix">
              <div class='pop-not-reachable  add_note'>
                <span class="add-note-icon sprite-agent not-reachable pull-left"></span>

                <div class="trav-cont">
                  <div class="add-note-heading">
                    <h4>Traveler not reachable</h4>
                  </div>
                      <div class="not-int-option" data-sub-heading-val="7.1">
                        <input class="radio_style not-reachable" id="radio-7.1" name="radio-not-reachable" type="radio" value="7.1">
                        <label for="radio-7.1" class="label_style"><span class="sprite-agent"></span>Phone number doesn&#x27;t work </label>

                        <div class="info-tip">
                          <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                          <div class="add-note-info">
                            <i class="add-tttriangle"></i>
                            <ul>
                                  <li>Followup mail will be sent on your behalf asking traveler to call back.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                      <div class="not-int-option" data-sub-heading-val="7.2">
                        <input class="radio_style not-reachable" id="radio-7.2" name="radio-not-reachable" type="radio" value="7.2">
                        <label for="radio-7.2" class="label_style"><span class="sprite-agent"></span>Couldn&#x27;t talk to traveler this time, try again later </label>

                        <div class="info-tip">
                          <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                          <div class="add-note-info">
                            <i class="add-tttriangle"></i>
                            <ul>
                                  <li>Followup mail will be sent on your behalf asking traveler to call back.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                      <div class="not-int-option" data-sub-heading-val="7.3">
                        <input class="radio_style not-reachable" id="radio-7.3" name="radio-not-reachable" type="radio" value="7.3">
                        <label for="radio-7.3" class="label_style"><span class="sprite-agent"></span>Tried enough, leave the lead </label>

                        <div class="info-tip">
                          <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                          <div class="add-note-info">
                            <i class="add-tttriangle"></i>
                            <ul>
                                  <li>Trip will be hidden from the dashboard in Quotation followup stage to keep your dashboard clean.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                </div>
                <div class="clearfix"></div>
              </div>
              <div class='pop-not-book  add_note'>
                <span class="add-note-icon sprite-agent not-book pull-left"></span>

                <div class="trav-cont">
                  <div class="add-note-heading">
                    <h4>Won&#x27;t book with me</h4>
                  </div>
                      <div class="not-int-option" data-sub-heading-val="2.3">
                        <input class="radio_style not-book" id="radio-2.3" name="radio-not-book" type="radio" value="2.3">
                        <label for="radio-2.3" class="label_style"><span class="sprite-agent"></span>Traveler is not sure about the plan/cancelled plan </label>

                        <div class="info-tip">
                          <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                          <div class="add-note-info">
                            <i class="add-tttriangle"></i>
                            <ul>
                                  <li>Trip will be hidden from the dashboard in Quotation followup stage to keep your dashboard clean.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                      <div class="not-int-option" data-sub-heading-val="2.2">
                        <input class="radio_style not-book" id="radio-2.2" name="radio-not-book" type="radio" value="2.2">
                        <label for="radio-2.2" class="label_style"><span class="sprite-agent"></span>Traveler booked with someone else </label>

                        <div class="info-tip">
                          <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                          <div class="add-note-info">
                            <i class="add-tttriangle"></i>
                            <ul>
                                  <li>Trip will be hidden from the dashboard in Quotation followup stage.</li>
                                  <li>TT trust mail will be sent.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                </div>
                <div class="clearfix"></div>
              </div>
              <div class='pop-talk-progress  add_note'>
                <span class="add-note-icon sprite-agent talk-progress pull-left"></span>

                <div class="trav-cont">
                  <div class="add-note-heading">
                    <h4>Talk in progress with traveler</h4>
                  </div>
                      <div class="not-int-option" data-sub-heading-val="4.1">
                        <input class="radio_style talk-progress" id="radio-4.1" name="radio-talk-progress" type="radio" value="4.1">
                        <label for="radio-4.1" class="label_style"><span class="sprite-agent"></span>Initial stage only - Quote not seen </label>

                        <div class="info-tip">
                          <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                          <div class="add-note-info">
                            <i class="add-tttriangle"></i>
                            <ul>
                                  <li>Last edited quote will be resent for quick access of your quote.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                      <div class="not-int-option" data-sub-heading-val="4.2">
                        <input class="radio_style talk-progress" id="radio-4.2" name="radio-talk-progress" type="radio" value="4.2">
                        <label for="radio-4.2" class="label_style"><span class="sprite-agent"></span>Getting Quote/package customized </label>

                        <div class="info-tip">
                          <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                          <div class="add-note-info">
                            <i class="add-tttriangle"></i>
                            <ul>
                                  <li>It will redirect you to edit quote section.</li>
                                  <li>Followup reminder will be set for tomorrow.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                      <div class="not-int-option" data-sub-heading-val="4.4">
                        <input class="radio_style talk-progress" id="radio-4.4" name="radio-talk-progress" type="radio" value="4.4">
                        <label for="radio-4.4" class="label_style"><span class="sprite-agent"></span>Traveler interested, but will book after few weeks </label>

                        <div class="info-tip">
                          <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                          <div class="add-note-info">
                            <i class="add-tttriangle"></i>
                            <ul>
                                  <li>Followup reminder will be set for next week.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                </div>
                <div class="clearfix"></div>
              </div>
              <div class='pop-finalize-soon  add_note'>
                <span class="add-note-icon sprite-agent finalize-soon pull-left"></span>

                <div class="trav-cont">
                  <div class="add-note-heading">
                    <h4>Traveler will finalize and is &#x27;My Hot&#x27;</h4>
                  </div>
                      <div class="not-int-option" data-sub-heading-val="6.1">
                        <input class="radio_style finalize-soon" id="radio-6.1" name="radio-finalize-soon" type="radio" value="6.1">
                        <label for="radio-6.1" class="label_style"><span class="sprite-agent"></span>Negotiating / Will finalize in 2 to 3 days </label>

                        <div class="info-tip">
                          <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                          <div class="add-note-info">
                            <i class="add-tttriangle"></i>
                            <ul>
                                  <li>Lead will be marked &quot;HOT&quot; exclusively for you.</li>
                                  <li>Your reviews will be sent to traveler to generate trust.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                      <div class="not-int-option" data-sub-heading-val="6.3">
                        <input class="radio_style finalize-soon" id="radio-6.3" name="radio-finalize-soon" type="radio" value="6.3">
                        <label for="radio-6.3" class="label_style"><span class="sprite-agent"></span>Invoice sent to traveler </label>

                        <div class="info-tip">
                          <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                          <div class="add-note-info">
                            <i class="add-tttriangle"></i>
                            <ul>
                                  <li>Lead will be marked &quot;HOT&quot; exclusively for you.</li>
                                  <li>Your reviews will be sent to traveler to generate trust.</li>
                                  <li>Payment link will be sent for easy payment.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                      <div class="not-int-option" data-sub-heading-val="6.4">
                        <input class="radio_style finalize-soon" id="radio-6.4" name="radio-finalize-soon" type="radio" value="6.4">
                        <label for="radio-6.4" class="label_style"><span class="sprite-agent"></span>Traveler will pay soon on my invoice </label>

                        <div class="info-tip">
                          <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                          <div class="add-note-info">
                            <i class="add-tttriangle"></i>
                            <ul>
                                  <li>Lead will be marked &quot;HOT&quot; exclusively for you.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                </div>
                <div class="clearfix"></div>
              </div>
          <div class="pop-customize-now  add_note" style="display: none;">
            <span class="add-note-icon sprite-agent talk-progress pull-left"></span>

            <div class="trav-cont">
              <div class="add-note-heading">
                <h4>Talk in progress with traveler</h4>
              </div>
              <div class="not-int-option" data-sub-heading-val="4.2">
                <label for="radio-4.2" class="label_style"><span class="sprite-agent"></span>Getting Quote/package customized </label>

                <div class="info-tip">
                  <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                  <div class="add-note-info">
                    <i class="add-tttriangle"></i>
                    <ul>
                      <li>It will redirect you to edit quote section.</li>
                      <li>Followup reminder will be set for tomorrow.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>

          <div class="pop-book-later  add_note" style="display: none;">
            <span class="add-note-icon sprite-agent talk-progress pull-left"></span>

            <div class="trav-cont">
              <div class="add-note-heading">
                <h4>Talk in progress with traveler</h4>
              </div>
              <div class="not-int-option" data-sub-heading-val="4.4">
                <label for="radio-4.4" class="label_style"><span class="sprite-agent"></span>Traveler interested, but will book after few weeks </label>

                <div class="info-tip">
                  <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                  <div class="add-note-info">
                    <i class="add-tttriangle"></i>
                    <ul>
                      <li>Followup reminder will be set for next week.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>

          <div class="pop-mark-priority  add_note" style="display: none;">
            <span class="add-note-icon sprite-agent talk-progress pull-left"></span>

            <div class="trav-cont">
              <div class="add-note-heading">
                <h4>Traveler will finalize and is 'My Hot'</h4>
              </div>
              <div class="not-int-option" data-sub-heading-val="6.1">
                <label for="radio-6.1" class="label_style"><span class="sprite-agent"></span>Negotiating / Will finalize in 2 to 3 days </label>
                <div class="info-tip">
                  <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                  <div class="add-note-info">
                    <i class="add-tttriangle"></i>
                    <ul>
                      <li>Lead will be marked "HOT" exclusively for you.</li>
                      <li>Your reviews will be sent to traveler to generate trust.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>

          <div class="pop-remove-lead  add_note" style="display: none;">
            <span class="add-note-icon sprite-agent talk-progress pull-left"></span>

            <div class="trav-cont">
              <div class="add-note-heading">
                <h4>Won't book with me</h4>
              </div>
              <div class="not-int-option" data-sub-heading-val="2.2">
                <label for="radio-2.2" class="label_style"><span class="sprite-agent"></span>Traveler booked with someone else </label>
                <div class="info-tip">
                  <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                  <div class="add-note-info">
                    <i class="add-tttriangle"></i>
                    <ul>
                      <li>Trip will be hidden from the dashboard in Quotation followup stage.</li>
                      <li>TT trust mail will be sent.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>

          <div class="pop-remove-lead-cancelled-plan  add_note" style="display: none;">
            <span class="add-note-icon sprite-agent talk-progress pull-left"></span>

            <div class="trav-cont">
              <div class="add-note-heading">
                <h4>Won't book with me</h4>
              </div>
              <div class="not-int-option" data-sub-heading-val="2.3">
                <label for="radio-2.3" class="label_style"><span class="sprite-agent"></span>Traveler is not sure about the plan/cancelled plan </label>

                <div class="info-tip">
                  <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                  <div class="add-note-info">
                    <i class="add-tttriangle"></i>
                    <ul>
                      <li>Trip will be hidden from the dashboard in Quotation followup stage to keep your dashboard clean.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>

          <div class="pop-traveler-pay-you  add_note" style="display: none;">
            <span class="add-note-icon sprite-agent talk-progress pull-left"></span>

            <div class="trav-cont">
              <div class="add-note-heading">
                <h4>Traveler will finalize and is 'My Hot'</h4>
              </div>
              <div class="not-int-option" data-sub-heading-val="2.2">
                <label for="radio-6.4" class="label_style"><span class="sprite-agent"></span>Traveler will pay soon on my invoice </label>
                <div class="info-tip">
                  <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                  <div class="add-note-info">
                    <i class="add-tttriangle"></i>
                    <ul>
                      <li>Lead will be marked "HOT" exclusively for you.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>

          <div class="pop-quote-not-seen  add_note" style="display: none;">
            <span class="add-note-icon sprite-agent talk-progress pull-left"></span>

            <div class="trav-cont">
              <div class="add-note-heading">
                <h4>Talk in progress with traveler</h4>
              </div>
              <div class="not-int-option" data-sub-heading-val="4.1">
                <label for="radio-4.1" class="label_style"><span class="sprite-agent"></span>Initial stage only - Quote not seen </label>
                <div class="info-tip">
                  <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                  <div class="add-note-info">
                    <i class="add-tttriangle"></i>
                    <ul>
                      <li>Last edited quote will be resent for quick access of your quote.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>

          <div class="pop-call-not-picked  add_note" style="display: none;">
            <span class="add-note-icon sprite-agent talk-progress pull-left"></span>

            <div class="trav-cont">
              <div class="add-note-heading">
                <h4>Traveler not reachable</h4>
              </div>
              <div class="not-int-option" data-sub-heading-val="7.2">
                <label for="radio-7.2" class="label_style"><span class="sprite-agent"></span>Couldn't talk to traveler this time, try again later </label>

                <div class="info-tip">
                  <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                  <div class="add-note-info">
                    <i class="add-tttriangle"></i>
                    <ul>
                      <li>Followup mail will be sent on your behalf asking traveler to call back.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>

          <div class="pop-number-not-working  add_note" style="display: none;">
            <span class="add-note-icon sprite-agent talk-progress pull-left"></span>

            <div class="trav-cont">
              <div class="add-note-heading">
                <h4>Traveler not reachable</h4>
              </div>
              <div class="not-int-option" data-sub-heading-val="7.1">
                <label for="radio-7.1" class="label_style"><span class="sprite-agent"></span>Phone number doesn't work </label>
                <div class="info-tip">
                  <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                  <div class="add-note-info">
                    <i class="add-tttriangle"></i>
                    <ul>
                      <li>Followup mail will be sent on your behalf asking traveler to call back.</li>
                    </ul>
                  </div>
                </div>              </div>
            </div>
            <div class="clearfix"></div>
          </div>

          <div class="pop-remove-lead-not-reachable  add_note" style="display: none;">
            <span class="add-note-icon sprite-agent talk-progress pull-left"></span>

            <div class="trav-cont">
              <div class="add-note-heading">
                <h4>Traveler not reachable</h4>
              </div>
              <div class="not-int-option" data-sub-heading-val="7.3">
                <label for="radio-7.3" class="label_style"><span class="sprite-agent"></span>Tried enough, leave the lead </label>

                <div class="info-tip">
                  <i class="add-note-icon info-icon sprite-agent sprite-information-icon-grey"></i>

                  <div class="add-note-info">
                    <i class="add-tttriangle"></i>
                    <ul>
                      <li>Trip will be hidden from the dashboard in Quotation followup stage to keep your dashboard clean.</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div class="clearfix"></div>
          </div>

          <div class="clearfix"></div>
          <hr class="seprator"/>

          <div class="yournote">
            <p>Your Note</p>
            <textarea class="input txtarea" id="note_agent_remark" name="agent_remark" placeholder="Enter additional information...">
</textarea>
          </div>

          <div class="yournote" id="reminder_div">
            <p>Set Reminder</p>

            <div class="tabular-date-yes">
            <span class="sprite-agent sprite-for-calender-blue-small"></span>
              <p class="calender-place">Date & Time</p>

              <div class="selected-date">
                <input class="input calender-ico" id="scheduler_run_at" name="task_scheduler[run_at]" type="hidden" value="" />
                <input id="reminder_requested_trip_id" name="task_scheduler[requested_trip_id]" type="hidden" value="" />
                <input id="set_reminder" name="set_reminder" type="hidden" />
                <input id="limit_comments" name="limit_comments" type="hidden" value="" />
                <input id="created_reminder" name="created_reminder" type="hidden" value="on" />
                <input id="latest_quote_id" name="latest_quote_id" type="hidden" />
                <input id="datetimepickermin" class="form-control width-260 datepicker-field" type="text" name="reminder_date">
                <span class="calender-cross sprite-agent sprite-for-small-add-cross"></span>
              </div>
            </div>
          </div>
          <div id = "show-error-msg" style="color: #fe7774; display: none;">*Please select a suitable option</div>
          <div class="cancel-add-btns">
            <a class="cancel-btn" href="#">Cancel</a>
            <a class="add-note-btn js_ga_add_note_click_event" href="#" onclick="submit_form();">Add Note</a>
          </div>
        </div>
</form>  </div>
</div>
<script>
    var counter = 0;
    var timer = null;

    var ADD_NOTE_SUB_STATUS = JSON.parse('{"not_sure":2.2,"booked_with_someone_else":2.3,"quote_not_seen":4.1,"getting_package_customized":4.2,"interested":4.4,"negotiating":6.1,"invoice_sent":6.3,"will_pay_soon":6.4,"number_not_working":7.1,"try_again_later":7.2,"tried_enough":7.3}');

    function tictac(){
      counter++;
    }

    function resetInterval()
    {
      clearInterval(timer);
      counter=0;
    }
    function startInterval()
    {
      timer= setInterval("tictac()", 1000);
    }
    function convert_to_range(i)
    {
      if(0 <= i && i <= 5){
        res = "0-5sec";
      }else if(6 <= i && i <= 10){
        res = "6-10sec";
      }else if(11 <= i && i <= 30){
        res = "11-30sec";
      } else if(31 <= i && i <= 120){
        res = "31sec-2min";
      } else if(121 <= i && i <= 300){
        res = "2-5min";
      } else if(301 <= i && i <= 600){
        res = "5-10min";
      } else {
        res = ">10min";
      }
      return res;
    }
    function reset_form() {
        $("#note_remark_status").val("");
        $("#note_agent_remark").val("");
        $(".selected-date").removeClass('visi');
        $('.calender-place').show();
        $('.radio_style').prop('checked', false);
        $('#datetimepickermin').val("");
    }

    $(".add-notepp").live('click', function (event) {
      startInterval();
        event.preventDefault();
        reset_form();
        $(".add-note-popup").fadeIn();
        $("#js-add-note-inner").fadeIn();
        $('body').css('overflow-y','hidden');
        var option = $(this)[0].getAttribute('id');
        $(".add_note").hide();
        $('.pop-' + option).show();
        var trip_id = $(this)[0].getAttribute("data-trip-id");
        var quote_id = $(this)[0].getAttribute("data-quote-id");
        var limit_comments = $(this)[0].getAttribute("data-limit-comments");
        var latest_quote_id = $(this)[0].getAttribute("data-latest-quote");

        var url = "";
        if (typeof quote_id == 'undefined') {
            $("#status_div, #reminder_div").hide();
            url = "/agents/trip_notes?requested_trip_id=" + trip_id;
        } else {
            $("#status_div, #reminder_div").show();
            url = "/requested_trips/" + trip_id + "/quotes/" + quote_id + "/agent_remark";
        }
        $("#js-add-note-inner form").attr("action", url);
        $("#note_trip_id").text(trip_id);
        $("#reminder_requested_trip_id").val(trip_id);
        $("#latest_quote_id").val(latest_quote_id);
        //Enable only radio buttons which are required
        $('.radio_style').attr('disabled', true);
        $("input[type=radio]." + option).attr('disabled', false);
        $("#limit_comments").val(limit_comments);
        if(option == "customize-now"){
            $('#note_remark_status').val(ADD_NOTE_SUB_STATUS["getting_package_customized"])
        }
        else  if (option == "book-later"){
            $('#note_remark_status').val(ADD_NOTE_SUB_STATUS["interested"])
        }
        else  if (option == "mark-priority"){
            $('#note_remark_status').val(ADD_NOTE_SUB_STATUS["negotiating"])
        }
        else  if (option == "remove-lead"){
            $('#note_remark_status').val(ADD_NOTE_SUB_STATUS["not_sure"])
        }
        else  if (option == "traveler-pay-you"){
            $('#note_remark_status').val(ADD_NOTE_SUB_STATUS["will_pay_soon"])
        }
        else  if (option == "remove-lead-cancelled-plan"){
            $('#note_remark_status').val(ADD_NOTE_SUB_STATUS["booked_with_someone_else"])
        }
        else  if (option == "quote-not-seen"){
            $('#note_remark_status').val(ADD_NOTE_SUB_STATUS["quote_not_seen"])
        }
        else  if (option == "number-not-working"){
            $('#note_remark_status').val(ADD_NOTE_SUB_STATUS["number_not_working"])
        }
        else  if (option == "call-not-picked"){
            $('#note_remark_status').val(ADD_NOTE_SUB_STATUS["try_again_later"])
        }
        else  if (option == "remove-lead-not-reachable"){
            $('#note_remark_status').val(ADD_NOTE_SUB_STATUS["tried_enough"])
        }

        agent_status = $('#note_remark_status').val();

        if (agent_status == ADD_NOTE_SUB_STATUS["tried_enough"] || agent_status == ADD_NOTE_SUB_STATUS["booked_with_someone_else"] || agent_status == ADD_NOTE_SUB_STATUS["not_sure"]) {
            $('#reminder_div').hide();
        } else {
            $('#reminder_div').show();

            // Set default date and time
            if (agent_status == ADD_NOTE_SUB_STATUS["interested"]){
                // Next week from now
                $(".selected-date").addClass('visi');
                $('.calender-place').hide();
                $('#datetimepickermin').val(moment().add(24, "hours").format("DD-MM-YYYY HH:mm"));
            }
            else if (agent_status == ADD_NOTE_SUB_STATUS["will_pay_soon"]){
                // Next dat at 11 AM
                $(".selected-date").addClass('visi');
                $('.calender-place').hide();
                $('#datetimepickermin').val(moment().startOf('day').add(1, "days").add(11, "hours").format("DD-MM-YYYY HH:mm"));
            }
        }
    });

    function submit_form() {
        note_not_added = false;
        if ($('.selected-date').hasClass('visi')) {
            $('#set_reminder').val('true');
            _gaq.push(['_trackEvent', 'Add_noteV2', 'Reminder', 'Yes']);
        }
        else {
            $('#set_reminder').val(null);
            _gaq.push(['_trackEvent', 'Add_noteV2', 'Reminder', 'No']);
        }

        if (!($('.radio_style:enabled:checked').val() || $('#note_remark_status').val()))
        {
            $("#show-error-msg").css("display","block");
            return false;
        }
        else
        {
            if(!$('#note_remark_status').val()) {
                $('#note_remark_status').val($('.radio_style:enabled:checked').val());
            }
            $('#scheduler_run_at').val($('#datetimepickermin').val());
            $("#show-error-msg").css("display","none");
            $("#note-form").submit();
            if ($('#note_remark_status').val() == ADD_NOTE_SUB_STATUS["getting_package_customized"]) {
                var trip_id = $("#reminder_requested_trip_id").val();
                var latest_quote_id = $("#latest_quote_id").val();
                var url = "";
                if (latest_quote_id){
                    url = "/requested_trips/" + trip_id + "/quotes/" + latest_quote_id + "/edit#4.2";
                }
                else{
                    url = "/requested_trips/" + trip_id + "/quotes/new#4.2";
                }
            window.open(url, '_blank');
            };
            $("#reminderPopupContainer").css("display","block");
            // location.reload();

          _gaq.push(['_trackEvent','TimeSpentByAgent',"add_note",convert_to_range(counter)]);
          _gaq.push(['_trackEvent', 'Add_noteV2', 'Note_Manual', $("#note_agent_remark").val()]);
          resetInterval();
          return true;
        }
    }
    $('.radio_style:enabled').change(function () {
        $("#show-error-msg").css("display","none");
        var agent_status = $(this)[0].value;
        if (agent_status == ADD_NOTE_SUB_STATUS["tried_enough"] || agent_status == ADD_NOTE_SUB_STATUS["booked_with_someone_else"] || agent_status == ADD_NOTE_SUB_STATUS["not_sure"] || agent_status == ADD_NOTE_SUB_STATUS["interested"])
            $('#reminder_div').hide();
        else
            $('#reminder_div').show();

        $(".selected-date").removeClass('visi');
        $('.calender-place').show();
        $('#datetimepickermin').datetimepicker({

            dayOfWeekStart: 1,
            lang: 'en',
            minDate: 0,
            value:new Date(),
            step: 10,
        });
    });

    $('.radio_style').change(function () {
        var agent_status = $(this)[0].value;
        _gaq.push(['_trackEvent', 'Add_noteV2', 'Subheading', $("label[for='radio-" + agent_status + "']").text()]);
    });
    $(".cancel-btn").click(function (event) {
        event.preventDefault();
        $(".add-note-popup").fadeOut();
        $("#js-add-note-inner").fadeOut();
        $('body').css('overflow-y','auto');
        $("#show-error-msg").css("display","none");
        _gaq.push(['_trackEvent', 'Add_noteV2', 'Cancel']);
      resetInterval();
    });

    $(".add-note-btn").click(function (event) {
        event.preventDefault();
        if (!($('.radio_style:enabled:checked').val() || $('#note_remark_status').val()))
            $("#show-error-msg").css("display","block");
        else{
            $(".add-note-popup").fadeOut();
            $("#js-add-note-inner").fadeOut();
            $('body').css('overflow-y','auto');
            $("#show-error-msg").css("display","none");
            _gaq.push(['_trackEvent', 'Add_noteV2', 'Add note']);
    }
    });
    function showUser(){
      alert("hi");   
    }
    $('#datetimepickermin').datetimepicker({
        
        dayOfWeekStart: 1,
        lang: 'en',
        minDateTime: moment(),
        minDate: 0,
        value:new Date(),
        step: 10,
        format: 'd-m-Y H:i'
    });
    
    
    $(".calender-cross").click(function (event) {
        event.stopPropagation();
        $(".selected-date").removeClass('visi');
        $('.calender-place').show();

        $('#datetimepickermin').datetimepicker({
            dayOfWeekStart: 1,
            lang: 'en',
            minDate: 0,
            value:new Date(),
            step: 10
        });
        $('#datetimepickermin').val("");
    });
    $(function () {
        $(".datepicker-input").datepicker({
            numberOfMonths: 2
        });
    });
    $('.tabular-date-yes').click(function () {
        if ($('#datetimepickermin').val() == ""){
            $('#datetimepickermin').val(moment().format("DD-MM-YYYY h:mm"));
        }
        $('#datetimepickermin').focusin();
        $(".selected-date").addClass('visi');
        $('.calender-place').hide();

    });

</script>

<div style="display:none;" class = 'success-popup'>
  <div class='message'>
    <div class='check'>
    <span class="sprite-agent sprite-success_check_icon"></span>

    </div>
        <p>
          Success
        </p>
        <p>
          <b>
          Congratulations! Your quotation has been sent to the Traveler</b>
        </p>
    <div class = "okay-btn">
      <p><a href="/requested_trips/5058547-Ashwani-Kumar/quotes/new">Create another Quote</a></p>
      <button id='ok'>OKAY</button>
    </div>
  </div>
</div>
<div class="popup" id="ask-review">
  <div class="popup-header">
    <h3>Checklist</h3>
  </div>
  <div class="popup-content">
    <div class="form">
      <div class="form-row">
        <div><input ga_text="Talked to traveler about the requirements in detail" id="talked_to_traveler" name="talked_to_traveler" type="checkbox" value="true" /> Talked to traveler about the requirements in detail</div>
        <br/>
        <div><input ga_text="No quotation changes needed now" id="no_changes" name="no_changes" type="checkbox" value="true" /> No quotation changes needed now</div>
        <div></div>
      </div>
      <div class="form-row clear-fix" align="right">
        <input type="submit" name="submit3" id="cancel_submit" value="Cancel" class="cancle-btn cancel-popup-btn">
        <a href="#" class="hide" id="go_to_create_invoice">go_to_create_invoice</a>
        <input type="submit" name="submit2" id="continue_submit" value="Done" class="send-btn" disabled="disabled" style="color: lightpink;">
      </div>
    </div>
  </div>
</div>

<div class="ttsn-popup-overlay"></div>
<div class="ttsn_requirement"></div>

<div id="booking_info_sec">
</div>

<div id="price_change_sec">
</div>

<div id="delete-incentory-modal"></div>


<!-- Begin Inspectlet Embed Code -->
<!-- End Inspectlet Embed Code -->

<!-- ttsn land experiment starts -->
<!-- ttsn land experiment ends -->


<script>
    var SECTION_TO_API_URL = {
        traveller_requirement_container: "https://traveltriangle.com/agents/v2/requested_trips/5058547/traveller_requirement_detail",
        quotes_container: "https://traveltriangle.com/agents/v2/requested_trips/5058547/quotation_followup_detail",
        ttsn_section_container: "https://traveltriangle.com/agents/v2/requested_trips/5058547/ttsn_section_detail",
        voucher_payment_container: "https://traveltriangle.com/agents/v2/requested_trips/5058547/voucher_payment_detail",
        trip_feedback_container: "https://traveltriangle.com/agents/v2/requested_trips/5058547/traveller_feedback_detail"
    };

    var section_already_loaded = {
        traveller_requirement_container: false,
        quotes_container: false,
        ttsn_section_container: false,
        voucher_payment_container: false,
        trip_feedback_container: false
    };

    section_already_loaded["trip_feedback_container"] = true;


  $(document).ready(function () {

    //pageview event for agent side requested_trip/show
    try{
      (typeof newrelic !== 'undefined') && newrelic.setPageViewName ("agent-requested_trip-show",
        "https://traveltriangle.com");
    }
    catch(e){
      console.log(e);
    }

    $("#quote_from_ttsn_popup").click(function(){
      if($(this).data("funnel")=="voucher")
      {
        var funnel = "voucher";
        var id = $(this).data("invoice-id");
      }
      else
      {
        var funnel = "quote"
        var id = $(".js_dynamic_basic_details:visible").attr("id").split("_")[1];
      }

      $.ajax({
        url: "/quotes/get_ttsn_hotels_data",
        data: {id: id,funnel: funnel},
        method: 'GET',
        dataType: 'script',
        success: function(result){
          // $("#quote_detail_chats").html(result);
          $(".ttsn-popup-overlay").show();
          $(".ttsn-popupDiv").show();
          $('body').addClass("overflowHidden");
        }});

    });

    $('#modified-preferences-strip').show().delay(10000).fadeOut();
    $.funnel_stage = 'post_stay';
    init_dynamic_content();
    $('.blog-post').mCustomScrollbar({
      scrollButtons: {
        enable: false
      }
    });
    $('.historyScroll').mCustomScrollbar({
        scrollButtons: {
            enable: false
        },
        theme: "history"
    });


  $( window ).load(async function() {

    // todo: find use case could find element with online_? class name
    const pubNubChannel = 'notification_3218074' + '-pnpres';
    const classToShowOnline = "online_" + pubNubChannel;
    const selector = `.${classToShowOnline}`;

    // method to call if status changes active or inactive
    const onStatus =  isOnline => {
          RtmsHelper.toggleUserAvailability({isOnline, selector});
    };

    if (RtmsHelper.useRtms) {
      const channelId = 3218074;
      window.tripId = 5058547;
      const channel = 'chat';

      if (channelId && channel) {
          RtmsHelper.subscribeRTMS({channelId, onStatus});
      }
    }

    var paramForChat = window.sessionStorage.getItem("paramForChat5058547");
      if(paramForChat) {
        window.sessionStorage.removeItem("paramForChat5058547");
        var param_for_new_chat = JSON.parse(paramForChat);
        var name= "Ashwani Kumar";
        showChatInAgentDashboard(null,5058547, 278401, 3218074, "Ashwani Kumar", param_for_new_chat.quote_ids[0], param_for_new_chat.quote_ids, param_for_new_chat.quote_prices, param_for_new_chat.quote_perperson, param_for_new_chat.trip_status, param_for_new_chat.trip_rating_color, param_for_new_chat.trip_loc, param_for_new_chat.quote_currencies);
      }

      if (false) {
        $.ajax({
          url: "/ttsn_requests/render_ttsn_request_quote",
          method: 'GET',
          data: {
            requested_trip_id: "5058547"
          },
          dataType: 'script',
          success: function(response) {
            showDatePicker();
          },
        });
      }
  });
  });

  $(function () {
    $('.quote-item').click(function (e) {
      e.preventDefault();
      var quoteID = $(this).data("quote");
      $('.js_dynamic_basic_details').hide();
      $('#quote_' + quoteID).show();

      $(this).siblings().removeClass('active-quote');
      $(this).addClass('active-quote');

    });

    $('.inv-quote-item').click(function (e) {
        e.preventDefault();
        var quoteID = $(this).data("quote");
        $('.js_dynamic_basic_details_inv').hide();
        $('#inv_quote_' + quoteID).show();

        $(this).siblings().removeClass('active-quote');
        $(this).addClass('active-quote');

    });

    function loadSectionFromApi(section_id) {
        var api_url = SECTION_TO_API_URL[section_id] + ".js";
        $.get(api_url).done(
            function () {
                section_already_loaded[section_id] = true;
            }
        ).fail(
            function () {
              alert("Something went wrong. Please try again later.")
            }
        )
    }

    $(".accordion-expand").click(function () {
        var next = $(this).parent().next();
        var next_element_id = next.attr('id');
        if (!section_already_loaded[next_element_id]) {
            loadSectionFromApi(next_element_id)
        }
    });

    $(".div.expand.closed").live("click",function(event){
      event.stopPropagation();
      var next = $(this).parent().next();
      var icon = $(this).find("div.expand.closed");
      var next_element_id = next.attr('id');
      if (!section_already_loaded[next_element_id]) {
          loadSectionFromApi(next_element_id)
      }
      icon.removeClass('closed');
      icon.addClass('opened');
      icon.find("img").attr('src',"https://img.traveltriangle.com//assets/new_ui_images/agents/minus-1145edc9d370a5cdc1259d47af607840.png");
      next.slideToggle();
    });
    $(".create_invoice_div a.checklist_enabled").click(function(e){
      e.preventDefault();
      $("#mask, .popup#ask-review").fadeIn();
      $(".popup#ask-review").animate({
        opacity: 1,
        top: '25%'
      });
      $("#go_to_create_invoice").attr("href", $(this).attr("org_href"));
    })

    $("#ask-review input:checkbox").click(function(){
      if($("#ask-review input:checkbox:checked").length > 0){
        $("#continue_submit").removeAttr("disabled").removeAttr("style");
      } else {
        $("#continue_submit").attr("disabled","disabled").attr("style", "color:lightpink");
      }
    });

    $("#continue_submit").click(function(){
      window.location.href = $("#go_to_create_invoice").attr('href');
      var checklist = "";
      $("#ask-review input:checkbox:checked").each(function(i){checklist += " | " + $(this).attr("ga_text")});
      _gaq.push(['_trackEvent', 'Paid_Waiting_Checklist', 'Checklist',"5058547" + checklist]);
      return false;
    });
    $("#cancel_submit").live("click", function () {
      $("#mask").fadeOut();
      $(".popup").fadeOut();
      $("#go_to_create_invoice").attr("href", "#");
      $("#ask-review input:checkbox").attr("checked", false);
      $("#continue_submit").attr("disabled","disabled").attr("style", "color:lightpink");
      return false;
    });

    /*$(".my-accordian-head.section-head").live("click",function(event){
      event.stopPropagation();
      //debugger;
      var next =  $(this).next();
      if(next.css("display")!="block"){
        //console.log("open now");
        var icon = $(this).find("div.expand.closed")
        icon.removeClass('closed').addClass('opened');
        icon.find("img").attr('src',"https://img.traveltriangle.com//assets/new_ui_images/agents/minus-1145edc9d370a5cdc1259d47af607840.png");
        next.slideToggle();

      }else{
        //console.log("close now");
        var icon = $(this).find("div.expand.opened");
        icon.removeClass('opened').addClass('closed');
        icon.find("img").attr('src',"https://img.traveltriangle.com//assets/new_ui_images/agents/plus-f5501c435e675faf076bd60f1439acbd.png");
        next.slideToggle();
      }

    });*/

  });

  $(document).ready(function () {

      ddaccordion.collapseone('expand', 0);
      ddaccordion.collapseone('expand', 1);
      ddaccordion.collapseone('expand', 2);

    $('#ok').click(function(){go(500)});
     // document.getElementById("inv_shortlist_stat").style.display = "none";
//setTimeout(function(){go(50)},700);
//setTimeout(function(){go(500)},2000);

    function go(nr) {
      $('.message').toggleClass('comein');
      $('.check').toggleClass('scaledown');
      $(".add-note-popup").hide();
    }
    /*< % if quote_decline[0] || quote_decline[1].blank?%>
      var loc = window.location.hash.substr(1);
        if(loc == 'selected_yes') {
          $('.message').toggleClass('comein');
          $('.check').toggleClass('scaledown');
          $(".add-note-popup").show();
          window.location.hash = '#';
        }
    < % end %>*/
  });

  $('.js_ga_full_view_click').click(function () {
    _gaq.push(['_trackEvent', 'DetailView_FollowUp', 'GiveQuote']);
  });

  $(".declineTripId .send-btn").click(function (e) {
    e.preventDefault();
    var trip_decline_reason = $('input.reject_reasons:radio:checked').val();
    declineTrip = $(this).parents("form").attr('action');
    declineTrip = declineTrip + '&trip_decline_reason=' + trip_decline_reason;
    $(this).parents("form").attr('action', declineTrip);
    var label_for_reson = $('input.reject_reasons:radio:checked').attr('data-reason_value');
    _gaq.push(['_trackEvent', 'DetailView_CreateQuote', 'Reject', label_for_reson + '|' + $(this).val()]);
    $(this).parents("form").submit();
  });
    $("#view_invoice").click(function(){
      var funnel_stage = $("#view_invoice span a").text();
      _gaq.push(['_trackEvent', 'Trip_full_view', 'View_invoice',funnel_stage]);
    });
    $('.okay-btn p').on('click', function(){
      var funnel_stage = $(this).text();
      _gaq.push(['_trackEvent', 'Success_Box', 'Send_another_quote',funnel_stage]);
    });
    $('#ok').on('click', function(){
      var funnel_stage = $(this).text();
      _gaq.push(['_trackEvent', 'Success_Box', 'Full_View',funnel_stage]);
    });

    $("#back_to_trip").on('click', function(){
      $("#content-left").css('display', 'block');
      $("#traveller_view").css('display', 'none');
      $("#content-left").scrollTop($(".traveler-content").scrollTop());
    });
</script>

<script>
  function bind_timer(tt_timer, time_input, show_timer) {
    $('.'+tt_timer).ttTimer({
      pauseTimer:"pauseTimer",    // give desired class for pause button
      showTimer:show_timer,      //  give desired class whereever you want to show your timer
      size: 50,                   // size of your circular timer
      colorCircle: 'white',
      background: '#2ECC71',
      anticlockWiseLoading: false,
      duration: {
        seconds: parseInt($('.'+time_input).val())    // give time in  hours minutes or seconds  \
      },
      /*  function whatever actions you want to perform before timer starts  */
      timerHandler: function() {

      },
      /*  function whatever actions you want to perform when timer is paused */
      pause:function(saveTimer){
        var timeRemaining= $("."+this.showTimer).val();

        alert( timeRemaining+"   "+" this much seconds is  remaining");
      },

      /*  Callback function whatever actions you want to perform when timer ends  */
      callback: function(countdown) {
        countdown.destroy();
        //                    alert('timerOver');
      }
    });
  }
</script>



<script>
    window.onload = function show_notice_message() {
    }
  jQuery.each(jQuery('textarea[data-autoresize]'), function() {
    var offset = this.offsetHeight - this.clientHeight;

    var resizeTextarea = function(el) {
      jQuery(el).css('height', 'auto').css('height', el.scrollHeight + offset);
    };
    jQuery(this).on('keyup input', function() { resizeTextarea(this); }).removeAttr('data-autoresize');
  });

  $(document).on('keyup', ".js-textarea-show",function () {
    var textareaValue = $(this).val().length;
    var valueLeft = 500 - textareaValue;
    $(this).next(".js-counter-view").html(valueLeft);
  });

</script>


<div class="black-popup-incl-excl" id="view_new_incentive_popup"></div> <!--black-popup-incl-excl-->
<div class="black-popup-incl-excl" id="view_incentive_popup"></div> <!--black-popup-incl-excl-->

<div class="hover_bkgr_fricc hover_bkgr_fricc2">

  <span class="helper"></span>
  
  <div class="popupContent">
    
    <h3 class="popupContent-heading">
      Have any concerns? We are here to help you
    </h3>

    <div class="popupCloseButton">X</div>
    
    <div class="container-tabs">

      <ul class="js-tabs-options tabs-options">
        <li class="js-yourConcern tab-link current" data-tab="yourConcern">Let us know your concerns
        </li>
        <li class="js-contactManagers tab-link" data-tab="contactManagers">Contacts of TravelTriangle Managers
        </li>
      </ul>

      <div id="yourConcern" class="tab-content current">
        <form accept-charset="UTF-8" action="/agents/create_feedback" class="new_general_feedback" data-remote="true" id="new_general_feedback" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /><input name="authenticity_token" type="hidden" value="iDFjdQQhR2kReB8A5QUpAZtGOyH9c/iBXbFEbBdSOHE=" /></div>
  
  <h6 class="formCommonh6">Please leave your feedback below. We will address it as soon as we can</h6>

  <input id="general_feedback_context" name="general_feedback[context]" type="hidden" />
  
  <div class="form-group formGroupCustom">
    
    <label for="feedback">Please select your feedback category below:*</label>
    
    <div class="radioCategoryContainer clearfix">
      
      <input class="radioCategory" id="radioCategory1" name="general_feedback[category]" required="required" type="radio" value="Compliment" />
      <label for="radioCategory1">
        <span class="spriteFeedback radioCategoryIcon radioComplimentIcon"></span>
        Compliment
      </label>
      
      <input class="radioCategory" id="radioCategory2" name="general_feedback[category]" required="required" type="radio" value="Suggestion" />
      <label for="radioCategory2">
        <span class="spriteFeedback radioCategoryIcon radioSuggestionIcon"></span>
        Suggestion
      </label>
      
      <input class="radioCategory" id="radioCategory3" name="general_feedback[category]" required="required" type="radio" value="Complaint" />
      <label for="radioCategory3">
        <span class="spriteFeedback radioCategoryIcon radioComplaintIcon"></span>
        Complaint
      </label>
    
    </div>
  
  </div>
  
  <div class="form-group formGroupFeedback">
    
    <label for="feedback">Please leave your feedback below:*</label>
    
    <textarea class="inputFormText" cols="40" id="general_feedback_feedback_text" name="general_feedback[feedback_text]" placeholder="Please fill in your answer" required="required" rows="20">
</textarea>
  
  </div>
  
  <input class="submitButton cont" name="commit" type="submit" value="Continue" />

</form>
        <div id="after-form-submit">
          <p>Thank you for submitting the feedback.<br>
          We will address your concerns, if any, as soon as possible.<br><br><br>
          In the meantime, if you are facing any urgent issue, please find contact details 
          of the right person from <a href="#" class="js-adjacent-tab adjacent-tab">adjacent tab.
          </a></p>
        </div>
      </div>
      
      <div id="contactManagers" class="tab-content">
        <div class="clearfix flexContactBox formHeader">
  <div class="flexContactBoxInner">    
    <div class="formHeaderInner">

      <h6 class="formCommonh6">Please find below, contact info of managers to raise your concerns</h6>
      <p>You can search the right department by typing your destination in the box below-</p>

      <input class="inputForm" id="esc_destination" name="esc_destination" placeholder="Ex. Kerala, TTSN" type="text" value="" />

    </div>

    <div id="department-authorities" class="clearfix managersList"></div>
  </div>
</div>
      </div>
    
    </div><!-- container -->
  
  </div>

</div>

<div class="live-ticket-mainwrapper">
  <div class="live-ticketDiv">
      <span class="sprite-agent live-update-icon"></span>
      <div class="live-ticker-tooltip">Live Updates Settings</div>
  </div>
  <div class="live-ticker-settingsDiv hide">
          <h3 class="setting-heading">Live Updates Settings <span class="sprite-agent live-ticker-setting-close"></span></h3>
          <div class="live-radio-btns">
            <input type="radio" name="live-ticker-btns" id="disable-btn">
            <label for="disable-btn"><span class="live-radio-icon"></span>Disable</label>
            <input type="radio" name="live-ticker-btns" id="enable-btn">
            <label for="enable-btn"><span class="live-radio-icon"></span>Enable</label>
          </div>
          <div class="setting-change-btn">
            <a href="javascript:void(0);" class="js-updates-save">Save</a>
          </div>
   </div>
</div>
<div class="live-updates-wrapper">
</div>
<div id = "live_ticker_success_popup">
  <div id="updated-popup-to-enable" class="live-ticker-updated-popup hide">
  <div class="live-ticker-updated-popup-inner">
    <i class="updated-popup-close-icon js-all-updates">&times;</i>
    <span class="sprite-agent live-ticker-updated-icon"></span>
    <span class="popup-text">Your preferences have been changed. You will now start receiving the live updates.</span>
  </div>
</div>
<div id="updated-popup-to-disable" class="live-ticker-updated-popup hide">
  <div class="live-ticker-updated-popup-inner">
    <i class="updated-popup-close-icon js-all-updates">&times;</i>
    <span class="sprite-agent live-ticker-updated-icon"></span>
    <span class="popup-text">Your preferences have been changed. You will not receive any live updates now.</span>
  </div>
</div>
<div id="not-updated-popup" class="live-ticker-updated-popup hide">
  <div class="live-ticker-updated-popup-inner">
    <i class="updated-popup-close-icon">&times;</i>
    <span class="sprite-agent live-ticker-nochanges-icon"></span>
    <span class="popup-text">No changes were found in your current settings</span>
  </div>
</div>
<div id="not-able-to-updated-popup" class="live-ticker-updated-popup hide">
  <div class="live-ticker-updated-popup-inner">
    <i class="updated-popup-close-icon">&times;</i>
    <span class="sprite-agent live-ticker-nochanges-icon"></span>
    <span class="popup-text">Not able to update please try again.</span>
  </div>
</div>
<script>
  $(".updated-popup-close-icon").click(function(){
    $('.live-ticker-updated-popup').addClass('hide');
  });
  $(".live-ticker-updated-popup").click(function(e){
    if($(e.target).hasClass("live-ticker-updated-popup")){
      $('.live-ticker-updated-popup').addClass('hide');
    }
  });
</script>
</div>

<script type="text/javascript">
  var live_ticker_status = eval("1");
  var is_live_ticker_updated = false;
  var is_action = false;
$(document).ready(function(){
 $(".live-ticketDiv").click(function(){
    $(".live-ticker-settingsDiv").removeClass('hide');
  });

  if (live_ticker_status == 1){
    $('#enable-btn').prop('checked', true);
  }
  else{
    $('#disable-btn').prop('checked', true);
  }
  $("#disable-btn").click(function(){
    is_action = true;
  });
  $("#enable-btn").click(function(){
    is_action = true;
  });

  $('.js-updates-save').click(function() {
     if($('#disable-btn').is(':checked')) {
       $.ajax({
         type: 'POST',
         url: '/agents/update_ticker_status',
         data: {'ticker_status' : '0'},
         dataType: 'script',
         success: function(){

         }
       });
        console.log("Disabling");

      }
      else if($('#enable-btn').is(':checked')) {
       $.ajax({
         type: 'POST',
         url: '/agents/update_ticker_status',
         data: {'ticker_status' : '1'},
         dataType: 'script',
         success: function(){

         }
       });
        console.log("Enabling");

      }
    if(is_action == false){
      _gaq.push(["_trackEvent","live_updates_setting","No Action",window.location.pathname]);
    }
    else{
      if ($("#enable-btn").prop("checked") == true){
        _gaq.push(["_trackEvent","live_updates_setting","Enable",window.location.pathname]);
      }
      else{
        _gaq.push(["_trackEvent","live_updates_setting","Disable",window.location.pathname]);
      }
      is_action = false;
    }
  });
  $(".live-ticker-setting-close").click(function(){
    $(this).parents('.live-ticker-settingsDiv').addClass('hide');
  });
  $(".js-all-updates").click(function(){
    $(".live-updates-wrapper").removeClass('hide');
    $('.live-updates').removeClass('hide');
  });

  $(".live-updates-close").click(function(){
    $(this).parents('.live-trip-details').addClass('hide');
  });

});
</script>

<script>


var SESSION_UUID_COOKIE_KEY = 'session_uuid';
var PAGE_UUID_COOKIE_KEY = 'page_uuid';
var LANDING_UUID_COOKIE_KEY = 'landing_uuid';
var REFERER_UUID_KEY = 'referer_uuid';
var DEFAULT_USER_ROLE = 'NOT_SET';
var USER_ID_COOKIE_KEY = 'u_id';
var USER_ROLE_COOKIE_KEY = 'u_role';
var DEFAULT_USER_ID = 1;
var SEPERATOR = '::';
var C_PLATFORM = 'Agent_web';
function sanitize(text) {
    if (typeof text === 'string') {
        return text.replace(/[^a-zA-Z0-9 ]/g, ' ');
    }
    return '';
};
function getPageName() {
    return "Agent Dashboard Page";
};
function prepareEventOriginUri(section, object, cta) {
    var page = getPageName();
    var sanitizedCta = sanitize(cta);
    var result = [C_PLATFORM, page, section, object, sanitizedCta];
    result = result.join(SEPERATOR);
    return result;
};
function initTrackObj() {
    return {
        category: "",
        package_id: 0,
        page_fullname: C_PLATFORM + "::Agent Dashboard Page",
        page_name: getPageName(),
        platform: C_PLATFORM,
        page_uuid: getCookie(PAGE_UUID_COOKIE_KEY),
        session_uuid: getCookie(SESSION_UUID_COOKIE_KEY),
        landing_page_uuid: getCookie(LANDING_UUID_COOKIE_KEY),
        referer_page_uuid: getCookie(REFERER_UUID_KEY),
        user_id: getCookie(USER_ID_COOKIE_KEY) || DEFAULT_USER_ID,
        user_role: getCookie(USER_ROLE_COOKIE_KEY) || DEFAULT_USER_ROLE
    };
}
var trackObj = initTrackObj();
var eventView = {
    event: 'organism_viewed'
};
var eventClicked = {
    event: 'Agent Clicked'
};
function sendEvent(section, object, cta, eventTypeObj, miscId1, miscType1, miscId2, miscType2) {
    var pathParams = window.location.pathname.split('/');
    var analyticObjAgent = Object.assign(trackObj, eventTypeObj, {
        event_origin_uri: prepareEventOriginUri(section, object, cta),
        trip_id: 0,
        quote_id: 0,
        Miscellaneous_Id_1: miscId1,
        Miscellaneous_type_1: miscType1,
        Miscellaneous_Id_2: miscId2,
        Miscellaneous_type_2: miscType2
    });
    window.analytics.track(eventTypeObj.event, analyticObjAgent);
} 



  var gritter_queue = [];
    var live_ticker_notification_status = 1;
  $(".js_ga_event_notification_view_all").click(function(){
    _gaq.push(["_trackEvent","Header_notification ","View_all"]);
  });

  $(".spocs-dashboardlinks-first").click(function(){
    _gaq.push(["_trackEvent","SPOC_View ","SPOCs_Dashboard", "Fly Paradise Tours And Travels"]);
  });
  $(".spoc_name_list_item").click(function(){
    _gaq.push(["_trackEvent","SPOC_View ","SPOC_Click", "Fly Paradise Tours And Travels | " + $(this).attr("data-name")]);
  });
  $(".agent_blog_link").click(function(){
    var stage_funnel = window.location.hash.replace("#", "");
    _gaq.push(["_trackEvent","TopNav ","Blog_Icon", stage_funnel]);
  });
  $(".closeIconReminder,#cancelPopupReminder").on('click',function(){
    $(".overlayReminderPopup").hide();
    $('#datetimepickerReminder').datetimepicker('reset');
  })
  function toogleTooltip(){
    $('.remindWrapper span').click(function () {
      $('.reminderTooltip').hide();
     $(this).next('.reminderTooltip').show();
    });
    $(document).click(function (e) {
        if (!$(e.target).parents().andSelf().is('.remindWrapper span')) {
            $(".reminderTooltip").hide();
        }
    });
    $(".reminderTooltip").click(function (e) {
        e.stopPropagation();
    });
  }
  $('#datetimepickerReminder').datetimepicker({
      dayOfWeekStart: 1,
      lang: 'en',
      minDate: 0,
      inline:true,
      value:new Date(),
      step: 10,
      onChangeDateTime:function(dp,$input){
        var datevalue =  $input.val();
        $(".reminderDateValue").val(datevalue)
      } 
  });
  var colorClass;
  function color_for_status(text) {
    switch (text) {
      case "Hot":
        colorClass = "red-text";
        break;
      case "My Hot":
        colorClass = "red-text";
        break;
      case "Admin Hot":
        colorClass = "blue-text";
        break;
      case "In Progress":
        colorClass = "blue-text";
        break;
      case "Good Lead":
        colorClass = "purple-text";
        break;
      case "Booker":
        colorClass = "orange-text";
        break;
      case "Cancelled":
        colorClass = "grey-text";
        break;
      case "No Response":
        colorClass = "grey-text";
        break;
      case "Booked":
        colorClass = "red-text";
        break;
      case "Dormant":
        colorClass = "orange-text";
        break;
      case "Cold":
        colorClass = "light-grey-text";
        break;
      default:
      colorClass = "green-text"
    }
  }
  $("#ApplyPopupReminder").on("click",function(){
    var applyDataval = $(this).attr("data")
    var reminderDateValue=$(".reminderDateValue").val();
    updateTextInstance('edit',function(){
      rosterMsgRight('Well done! Remember to add note once you have followed up','active');
      $("#"+applyDataval).closest('.schduleRemintderWraper').parent().remove();
      $(".scheduleReminder > div").show();
      $(".scheduleReminder > div:nth-child(n+4)").hide();
      countReminder();
    },null,reminderDateValue);
    $('#cancelPopupReminder').trigger('click');
  })
  function clockTimer(timeId){
    var checkTimeData = setInterval(function(){
      var counter = document.getElementById(timeId);
      if(counter){
        clearInterval(checkTimeData)
        var timeoutHandle;
        function countdown(minutes, seconds) {
          var seconds = 60;
          var mins = minutes
          function tick() {
            var current_minutes = mins - 1
            seconds--;
            counter.innerHTML =
              current_minutes.toString() + ":" + (seconds < 10 ? "0" : "") + String(seconds);
            if (seconds > 0) {
              timeoutHandle = setTimeout(tick, 1000);
            } else {
              if (mins > 1) {
                setTimeout(function() {
                  countdown(mins - 1);
                }, 1000);

              }
            }
          }
          tick();
        }
      countdown(30);
      }
    }, 200);
  }
  var monthShortNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
function formatDateAMPM(date) {
  var timeDate = new Date(date);
  var hours = timeDate.getHours();
  var minutes = timeDate.getMinutes();
  var ampm = hours >= 12 ? 'pm' : 'am';
  hours = hours % 12;
  hours = hours ? hours : 12; // the hour '0' should be '12'
  minutes = minutes < 10 ? '0'+minutes : minutes;
  var strTime = hours + ':' + minutes + ' ' + ampm;
  return  strTime+' '+timeDate.getDate() + ' ' + monthShortNames[timeDate.getMonth()] + ', ' + timeDate.getFullYear();
}
  function timerReminderNotication(id){
    var checkReminderTimer = setInterval(function(){
      var el = document.getElementById(id);
      if(el) {
        clearInterval(checkReminderTimer);
        var canvas = el,
          width = canvas.width,
          height = canvas.height;

          var ctx = canvas.getContext('2d');
          ctx.lineWidth = 3;
          ctx.strokeStyle = '#56c5c1';
          ctx.shadowOffsetX = 0;
          ctx.shadowOffsetY = 0;

          var x = width / 2,
              y = height / 2,
              radius = 31,
              circum = Math.PI * 2,
              start = Math.PI / -2, 
              finish = 1800, 
              curr = 0; 

          var raf =
              window.requestAnimationFrame ||
              window.mozRequestAnimationFrame ||
              window.webkitRequestAnimationFrame ||
              window.msRequestAnimationFrame;
          window.requestAnimationFrame = raf;
          function animate(draw_to) {
            ctx.clearRect(0,0,width,height);
            ctx.beginPath();
            ctx.arc(x,y,radius,start,draw_to,false);
            ctx.stroke();
            curr++;
            if(curr<=finish) {
              requestAnimationFrame(function() {
                setTimeout(function(){ animate(circum*curr/1800+start); }, 990);
              });
            }
          }
          animate();
      }
    }, 200);
  }  
  function rosterMsgRight(text,daynamicClass){
    $('.rosterMsg').show();
    $('.tosterMid p').text(text);
    $('.sucessRoster').addClass(daynamicClass)
    $('.rosterMsg .iconRight').addClass(daynamicClass)
    var tosterHide = setTimeout(function() {
      clearInterval(tosterHide);
      $('.rosterMsg').hide();
      $('.sucessRoster').removeClass(daynamicClass)
      $('.rosterMsg .iconRight').removeClass(daynamicClass)
    }, 4000);
    $('.rosterMsg').mouseover(function(){
    clearInterval(tosterHide);
    }).mouseout(function(){
      tosterHide = setInterval(function(){ 
        $('.rosterMsg').hide();
        $('.sucessRoster').removeClass(daynamicClass)
        $('.rosterMsg .iconRight').removeClass(daynamicClass)
      }, 4000) ;
    })
    $('.close-toastr').on('click',function(){
      $(this).closest('.rosterMsg').hide();
      clearInterval(tosterHide);
    })
  }
  function openReminder(){
  $('.reminderOpen span').on('click',function(e){
    updateTextInstance('close',function(tripId){
      window.open('/requested_trips/'+tripId);
      rosterMsgRight('Okay! We will remind you again','active');
      $(e.target).closest('.schduleRemintderWraper').parent().remove();
      $(".scheduleReminder > div").show();
      $(".scheduleReminder > div:nth-child(n+4)").hide();
      countReminder();
    });
  })
  } 
  function closeQuite(){
    $('.closeQuiteReminder').on('click',function(){
      $(this).parent().remove();
    })
  }

  function countReminder(){
    var remLength=$('.schduleRemintderWraper').length;
      var pendingRem= remLength-3;
      if( remLength > 3){
        $(".reminderCounts").text("You have "+pendingRem+" more reminders").show();
      }
      else{
        $(".reminderCounts").hide();
      }
  } 
  function rescheduleReminder(){
    $('.rescheduleTime1').on('click',function(e){
      updateTextInstance('edit',function(){
        rosterMsgRight('Well done! Remember to add note once you have followed up','active');
        $(e.target).closest('.schduleRemintderWraper').parent().remove();
        $(".scheduleReminder > div").show();
        $(".scheduleReminder > div:nth-child(n+4)").hide();
        countReminder();
      },60);
    })
    $('.rescheduleTime2').on('click',function(e){
      updateTextInstance('edit',function(){
        rosterMsgRight('Well done! Remember to add note once you have followed up','active');
        $(e.target).closest('.schduleRemintderWraper').parent().remove();
        $(".scheduleReminder > div").show();
        $(".scheduleReminder > div:nth-child(n+4)").hide();
        countReminder();
      },15);      
    })
    $(".rescheduleTimeCal").on('click', function(){
      var resuduleId = $(this).attr("id")
      $(".overlayReminderPopup").show();
      $(".overlayReminderPopup #ApplyPopupReminder").attr("data",resuduleId)
    })
  }
  function genRandomNum(n) {
    var rand = Math.floor(Math.random() * n);
    if (rand === 0) {
        return rand + 1;
    } else {
        return rand;
    }
}


  $('#flights-header-link').on('click', function(){
      GABind.triggerEvent($(this));
  })

function truncate(string){
   if (string!=null && string.length > 50)
      return string.substring(0,50)+' ...';
   else
      return string;
}

function add_ttsn_request_notification(msgData){
  updateNotificationCount(msgData);
  prependNewNotification(msgData.notification_sub_category, msgData.notification_category, msgData.data.trip_id, null , msgData.message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color,
    null, null, msgData.id);
}
  function mark_paid_to_tt_rejected_notification(msgData){
    updateNotificationCount(msgData);
    prependNewNotification(msgData.notification_sub_category, msgData.notification_category, msgData.data.trip_id, null , msgData.message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color,
        null, null, msgData.id);
  }

  function add_rps_live_ticker_message(msgData) {
    updateNotificationCount(msgData);
    prependNewNotification(
      msgData.notification_sub_category, msgData.notification_category, msgData.data.trip_id, null , msgData.message,
      msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color, null, null, msgData.id
    );
    append_to_live_ticker(msgData,msgData.notification_sub_category);
  }

  function adb_inventory_status_notification(msgData) {
      updateNotificationCount(msgData);
      prependNewNotification(msgData.notification_sub_category, msgData.notification_category, msgData.data.trip_id, null , msgData.message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color,
          null, null, msgData.id);
  }

function add_reminder_for_voucher_upload(msgData){
  updateNotificationCount(msgData);
  prependNewNotification('reminder_for_voucher_upload', 'Hot Follow Up', msgData.data.trip_id, msgData.data.quote_id, msgData.message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color, null, null, msgData.id);
}
// new method for pending cab details notification
function add_reminder_for_cab_details(msgData){
  updateNotificationCount(msgData);
  prependNewNotification('cab_details', 'Post Booking', msgData.data.trip_id, msgData.data.quote_id, msgData.message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color, null, null, msgData.id);
  if (live_ticker_notification_status == 1){
    append_to_live_ticker(msgData,'cab_details');
    // this is for showing browser notifications on right upper corner
    $(".ui-widget.ui-corner-top.ui-chatbox .ui-chatbox-content").show();
  }
}
///////////////////////////////
function add_quote_viewed_notification(msgData)
{
  updateNotificationCount(msgData);

  var notification_message=truncate_msg_data(msgData.message);
  prependNewNotification('quote_viewed', 'Follow Up', msgData.data.trip_id, msgData.data.quote_id, notification_message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color, null, null, msgData.id);

  if (live_ticker_notification_status == 1){
    append_to_live_ticker(msgData,'quote_viewed');
    // this is for showing browser notifications on right upper corner
    $(".ui-widget.ui-corner-top.ui-chatbox .ui-chatbox-content").show();
  }

  //this is for alerting live ticker update
    //var message=msgData.message;
    //alert(message);
}
function truncate_msg_data(notification_message){
    return notification_message.split(' (')[0];
}

function updateText(data){
  var msgData = data;
          return function(status,callback,rescheduleTime,exactTime){
            var calculateRunTime = function(runTime, rescheduleTime){
                var finalTime = new Date(runTime);
                var currentDate = new Date();
                if ( rescheduleTime ){
                  finalTime = new Date(currentDate.getTime() + rescheduleTime*60000);
                }
                if ( exactTime ){
                  return exactTime;
                }
                return finalTime.toLocaleString();
            };

            $.ajax({
              type: "POST",
              url: "/agents/v2/requested_trips/"+msgData.data.trip_id+"/task_schedulers/"+msgData.data.requested_trip_id+"/update_or_close",
              dataType: "json",
              data:{
                run_at: calculateRunTime(msgData.data.run_at,rescheduleTime),
                user_id: msgData.data.user_info.user_id,
                task_operation: status
              },
              success: function(data) {
                if (callback){
                  callback(msgData.data.trip_id);
                }
              },
              error: function(xhr,status,error){
                rosterMsgRight('There seems to be some problem. Please try again!','errorMsg');
                return false;
              }
            });
          };
}
var updateTextInstance;
  var a = '';
function append_to_live_ticker(msgData,notification_sub_category){
  a = msgData;
    var user_specific_class='rm_'+msgData.data.user_info.user_id+'_'+msgData.data.trip_id;
    var element=document.getElementsByClassName(user_specific_class);
    var rps_notifications = ['rps_manual_quote_percent', 'rps_add_note_percent', 'rps_phone_no_percent', 'rps_total_conversions', 'rps_a2c', 'rps_manual_quoting_time_mins', 'rps_manual_quoting_time_hours'];
    if (((element.length == 0) && (msgData.data.trip_id != undefined)) || rps_notifications.indexOf(notification_sub_category) != -1) {
//      var live_ticker_element = '<div class="live-trip-details '+ user_specific_class +'">' +
//          '<a href="' + msgData.data.url + '" target="_blank" onclick="return live_ticker_ga(\''+msgData.data.funnel_stage+'\',\''+msgData.data.trip_status+'\',\''+msgData.data.to_loc+'\');"><div class="live-updates">' +
//          '<h2><span class="online-icon"></span> <span>Trip ID:' + msgData.data.trip_id  + '</span></h2>' +
//      '<p><strong>' + msgData.data.user_info.calling_name + '</strong> to ' + msgData.data.to_loc + ' has viewed your quote</p>' +
//      '</div> </a> <i class="sprite-agent live-updates-close"></i> </div>';
        var text_content = '';
        var title_content ='';
        var schedule_content = '';
        var url = ''
        if(notification_sub_category == 'quote_viewed'){
          text_content =  '<p id="live-ticker-text"><strong>' + msgData.data.traveller_info.calling_name + '</strong> to ' + msgData.data.to_loc + ' has viewed your quote</p>';
          title_content = '<span class="gritter-online-icon"></span> <span id="liveticker-trip-id">Trip ID:' + msgData.data.trip_id  + '</span>';
          url = msgData.data.url;
        }
        else if(notification_sub_category == 'scheduled_task_reminder') {
          updateTextInstance = updateText(msgData);
          var reminderTime = formatDateAMPM(msgData.data.run_at);
          var canvasID = 'canvasBar_' + genRandomNum(9999);
          var timeId= 'clockTime' + genRandomNum(9999);
          var resudule ='apply' + genRandomNum(9999);
          color_for_status (msgData.data.trip_status) 
          schedule_content =  '<div class="notificationReminder"><div class="timerWraper"><canvas id="' + canvasID + '" class=" barCanvash" width="65" height="65"></canvas><div class="watchTimerwraper"> <span class="countDownTime" id="' + timeId + '"></span><span class="contentTime">Remaing</span></div></div><div class="reminderTripWraper"><p><span class="'+colorClass+' statusColor">'+ msgData.data.trip_status+" "+'</span><span class="reminderUser">'+ msgData.data.traveller_info.first_name+" "+msgData.data.traveller_info.last_name+" "+'</span><span id="liveticker-trip-id">Trip ID: ' + msgData.data.trip_id + '</span></p><p id="live-ticker-text"> <span>A reminder was set for ' + reminderTime +'</span></p> </div><div class="reminderTooltipWraper"><div class="remindWrapper"><span>Remind Me Later</span> <div class="reminderTooltip"><div class="rescheduleTimeCal"  id="' + resudule + '">Reschedule</div><div class="rescheduleTime1">After 1 hr</div><div class="rescheduleTime2">After 15 mins</div></div></div><div class="reminderOpen"><span>Open</span></div></div></div>';
          url = msgData.data.url;
          timerReminderNotication(canvasID);      
          clockTimer(timeId);            
         }
        else if(rps_notifications.indexOf((msgData.notification_sub_category) != -1)) {
          if(msgData.notification_category == 'RPS_POINTS_UPDATE') {
            if(msgData.notification_sub_category == 'rps_a2c') {
              if(msgData.redeemed_points) {
                text_content =  '<p id="live-ticker-text"> ' +
                  'You have a new conversion Trip - <a href=' + msgData.requested_trip_link + '>Trip ID ' + msgData.data.trip_id +
                  '</a> and redeemed Rs. ' + msgData.redeemed_points + '. Also you get ' + msgData.delta_points + ' coins.</p>';
                title_content = '<span></span> <span id="liveticker-trip-id">Hurray! </span>';
              } else {
                text_content =  '<p id="live-ticker-text"> ' +
                  'You have a new conversion Trip - <a href=' + msgData.requested_trip_link + '>Trip ID ' + msgData.data.trip_id +
                  '</a>. Here are ' + msgData.delta_points + ' coins for you</p>';
                title_content = '<span></span> <span id="liveticker-trip-id">Hurray! </span>';
              }
            } else {
              text_content =  '<p id="live-ticker-text"> ' +
                'You have moved to the next level of ' + msgData.notification_sub_category_display + ' and earned an additional ' +
                msgData.delta_points + ' coins. </p>';
              title_content = '<span></span> <span id="liveticker-trip-id">Congratulations! </span>';
            }
          } else if (msgData.notification_category == 'RPS_MULTIPLIER_UPDATE') {
            if(msgData.notification_sub_category == 'rps_a2c') {
              if(msgData.redeemed_points) {
                text_content =  '<p id="live-ticker-text"> ' +
                  'You have a new conversion Trip - <a href=' + msgData.requested_trip_link + '>Trip ID ' + msgData.data.trip_id +
                  '</a> and redeemed Rs. ' + msgData.redeemed_points + '. Also you get ' + msgData.delta_points + 'X multiplier.</p>';
                title_content = '<span></span> <span id="liveticker-trip-id">Hurray! </span>';
              } else {
                text_content =  '<p id="live-ticker-text">' +
                  'You have a new conversion Trip - <a href=' + msgData.requested_trip_link + '>Trip ID ' + msgData.data.trip_id +
                  '</a>. Here are ' + msgData.delta_points + 'X multiplier.</p>';
                title_content = '<span></span> <span id="liveticker-trip-id">Hurray! </span>';
              }
            } else {
              text_content =  '<p id="live-ticker-text"> ' +
                'You have moved to the next level of ' + msgData.notification_sub_category_display + ' and earned ' +
                msgData.delta_points + 'X multiplier. </p>'
              title_content = '<span></span> <span id="liveticker-trip-id">Wow! </span>';
            }
          } else if (msgData.notification_category == 'RPS_MULTIPLIER_DROP') {
            text_content =  '<p id="live-ticker-text">' +
              'You have slipped down the ' + msgData.notification_sub_category_display + ' level and lost ' +
              msgData.delta_points + ' coins. ' + msgData.second_message + '</p>';
            title_content = '<span></span> <span id="liveticker-trip-id">Oops! </span>';
          } else if (msgData.notification_category == 'RPS_POINTS_DROP') {
            text_content =  '<p id="live-ticker-text">' +
              'You have slipped down the ' + msgData.notification_sub_category_display + ' level. Now you have ' +
              msgData.delta_points + 'X multiplier.</p>';
            title_content = '<span></span> <span id="liveticker-trip-id">Oops! </span>';
          }
        }
        else{
          text_content = '<span class="gritter-cab-icon-con"><span class="gritter-cab-icon sprite-agent"></span></span><p id="live-ticker-text"><strong  class="pl60">' + msgData.message+ '</strong></p>';
          title_content = '<span id="liveticker-trip-id" class="pl60">Trip ID:' + msgData.data.trip_id  + '</span>';
          url = msgData.data.url+'#cab-notification';
        }   

        var quiteReminderCount = 'quiteReminder_'+genRandomNum(9999);
        var scheduleReminderCount = 'scheduleReminder_'+genRandomNum(9999);
        if (title_content){
          $('#reminderWraper .quiteReminder').append("<div class="+quiteReminderCount+"><div class='closeQuiteReminder'></div><div class='quiteRemintderWraper'><div>"+title_content+"</div><div>"+text_content+"</div></div></div>");
          closeQuite();
        }
        if (schedule_content){
          $('#reminderWraper .scheduleReminder').append("<div class="+scheduleReminderCount+"><div class='schduleRemintderWraper'>"+schedule_content+"</div></div>");
          toogleTooltip();
          rescheduleReminder();
          openReminder() ;
          $(".scheduleReminder > div").show();
          $(".scheduleReminder > div:nth-child(n+4)").hide();
          countReminder();
        }
        var setTimeSchedule = setTimeout(function() {
          if($('.'+scheduleReminderCount)){
            $('.'+scheduleReminderCount).remove();
            $(".scheduleReminder > div").show();
            $(".scheduleReminder > div:nth-child(n+4)").hide();
            countReminder();
          }
          clearInterval(setTimeSchedule);
        }, 1800000);
        var setTimeQuite = setTimeout(function() {
          if($('.'+quiteReminderCount)){
            $('.'+quiteReminderCount).remove();
          }
          clearInterval(setTimeQuite);
        }, 20000);
        return false;
    }

    else {
      var err = new Error('Error through append_to_live_ticker function' + msgData);
      (typeof newrelic !== 'undefined') && newrelic.noticeError(err);
    }
    // reset_live_ticker(user_specific_class);
}

var timers_hash={};
function reset_live_ticker(user_specific_class){
    var timer = timers_hash[user_specific_class];
    if (timer) {
        clearTimeout(timer); //cancel the previous timer.
        timer = null;
    }
    timers_hash[user_specific_class]= setTimeout(function(){
        $('.'+user_specific_class).remove();
        delete timers_hash[user_specific_class];
    },30*1000);
}

function add_phone_no_available_notification(msgData)
{
  updateNotificationCount(msgData);
    var notification_message=truncate_msg_data(msgData.message);
  prependNewNotification('phone_no_available', 'Hot Follow Up', msgData.data.trip_id, null, notification_message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color, null, null, msgData.id);
}
function add_quote_accepted_notification(msgData)
{
  updateNotificationCount(msgData);
    var notification_message=truncate_msg_data(msgData.message);
  prependNewNotification('quote_accepted', '', msgData.data.trip_id, msgData.data.quote_id, notification_message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color, null, msgData.data.create_invoice_url, msgData.id);
  msgData["trip_id"] = msgData.data.trip_id;
  msgData["commentable_id"] = msgData.data.quote_id;
}
function add_quote_booked_notification(msgData)
{
  updateNotificationCount(msgData);
  var notification_message=truncate_msg_data(msgData.message);
  prependNewNotification('quote_booked', 'Quote Booked', msgData.data.trip_id, msgData.data.quote_id, notification_message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color, null, msgData.data.create_invoice_url, msgData.id);
  msgData["trip_id"] = msgData.data.trip_id;
  msgData["commentable_id"] = msgData.data.quote_id;
}

function add_invoice_accepted_notification(msgData)
{
  updateNotificationCount(msgData);
  var notification_message=truncate_msg_data(msgData.message);
  prependNewNotification('invoice_accepted', 'Invoice Accepted', msgData.data.trip_id, msgData.data.quote_id, notification_message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color, null, null, msgData.id);
}

function add_invoice_rejected_notification(msgData)
{
  updateNotificationCount(msgData);
  var notification_message=truncate_msg_data(msgData.message);
  prependNewNotification('invoice_rejected', 'Invoice Rejected', msgData.data.trip_id, msgData.data.quote_id, notification_message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color, null, null, msgData.id);
}
function add_comment_added_notification(msgData)
{
  updateNotificationCount(msgData);
  var notification_message=truncate_msg_data(msgData.message);
  prependNewNotification('comment_added', 'Hot Follow Up', msgData.data.trip_id, msgData.data.quote_id,notification_message, msgData.created_at, msgData.data.url, msgData.data.trip_status, msgData.data.trip_rating_color, msgData.data.actionable_data.comment.comment_text, null, msgData.id);
}
function add_reminder_notification(msgData){
    updateNotificationCount(msgData);
    prependNewNotification('reminder_for_follow_up', 'Follow Up', msgData.data.trip_id,msgData.data.quote_id,msgData.message, msgData.created_at,msgData.data.url,msgData.data.trip_status, msgData.data.trip_rating_color,null,null,msgData.id,msgData);
}

function add_task_reminder_notification(msgData){
    if (live_ticker_notification_status == 1){
        append_to_live_ticker(msgData, "scheduled_task_reminder");
        // this is for showing browser notifications on right upper corner
        $(".ui-widget.ui-corner-top.ui-chatbox .ui-chatbox-content").show();
    }
}

function open_rtrip(msgData, data) {
        window.open(msgData.data.url, '_blank', 'menubar=0');
      }

  function replaceURLWithHTMLLinks(text) {
    var exp = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/i;
    return text.replace(exp,"<a href='$1'>$1</a>");
  }

var presenceSubscribedChannelList = [];

function subscribePresenceTraveler(channel)
{
  if($.inArray(channel, presenceSubscribedChannelList) == -1) {
    presenceSubscribedChannelList.push(channel);
  }

  var classToShowOnline = "online_"+channel;
}

function subscribeRTMSPresenceTraveler({channelId})
{

  const onStatus = (isOnline) => {
      const selector = `.online_notification_${channelId}-pnpres`;
      // if (isOnline) {
      //   debugger;
      // }
      RtmsHelper.toggleUserAvailability({isOnline, selector});
  };

  RtmsHelper.subscribeRTMS({channelId, onStatus});
}

function subscribePresenceTravelerOnPage()
{
    $(".chat_enabled_agent_db").each(function(i, element){
        let channel = element.getAttribute("data-trip_user_channel");

        if (RtmsHelper.useRtms) {
            const channelId = RtmsHelper.extractId(channel);
            subscribeRTMSPresenceTraveler({channelId});
        } else {
          // append pnpres for the pubnub
          channel += "-pnpres";
          if($.inArray(channel, presenceSubscribedChannelList) == -1) {
            presenceSubscribedChannelList.push(channel);
            subscribePresenceTraveler(channel);
          }
        }
      });
}

  function unSubscribePresenceTravelerOnPage()
  {
    if (!RtmsHelper.useRtms) {
      $(".chat_enabled_agent_db").each(function(i, element){
        channel = element.getAttribute("data-trip_user_channel") + "-pnpres";
        var index = presenceSubscribedChannelList.indexOf(channel);
        if(index!=-1)
        {
          presenceSubscribedChannelList.splice(index, 1);
        }
      });
    }
  }

  $(window).bind('beforeunload', function (e) {
    presenceSubscribedChannelList = [];
  });


var callbacks = {
  system: {
    'quote_viewed': add_quote_viewed_notification,
    'comment_added': add_comment_added_notification,
    'quote_accepted': add_quote_accepted_notification,
    'invoice_accepted': add_invoice_accepted_notification,
    'invoice_rejected': add_invoice_rejected_notification,
    'quote_booked': add_quote_booked_notification,
    'phone_no_available': add_phone_no_available_notification,
    'reminder_for_follow_up': add_reminder_notification,
    'scheduled_task_reminder': add_task_reminder_notification,
    'incoming_call_from_traveller': open_rtrip,
    'preferences_edited': add_edit_preferences_notifiaction,
    'reminder_for_voucher_upload': add_reminder_for_voucher_upload,
    'cab_details': add_reminder_for_cab_details,
    'ttsn_request_updated': add_ttsn_request_notification,
    'ttsn_price_check_served': add_ttsn_request_notification,
    'ttsn_request_inventory_booked': add_ttsn_request_notification,
    'ttsn_request_voucher_uploaded': add_ttsn_request_notification,
    'mark_paid_to_tt_rejected': mark_paid_to_tt_rejected_notification,
    'adb_inventory_status_changed': adb_inventory_status_notification,
    'rps_manual_quote_percent': add_rps_live_ticker_message,
    'rps_add_note_percent': add_rps_live_ticker_message,
    'rps_phone_no_percent': add_rps_live_ticker_message,
    'rps_a2c': add_rps_live_ticker_message,
    'rps_manual_quoting_time_mins': add_rps_live_ticker_message,
    'rps_manual_quoting_time_hours': add_rps_live_ticker_message,
    'rps_target_points_achieved': add_rps_live_ticker_message,
  },
  chat: {
    'comment_added': showChatInAgentDashboard
  }
};

window.callbacks = callbacks;
  /* pubnub uuid *  */
  var setTab_Index = function() {
      var tabs_count = getCookie('tabs_count');
      if ((tabs_count == null) || (tabs_count == NaN) || (tabs_count == 'NaN') || (parseInt(tabs_count) < 0)){
          tabs_count = 1;
          //setCookie('tabs_arr', ["1"]);
      }
      else{
          tabs_count = parseInt(tabs_count) + 1;
      }
      var tab_arr_coockie = getCookie("tabs_arr");
      if(tab_arr_coockie && tab_arr_coockie.length>0){
          var tab_arr = tab_arr_coockie.split(',');
      }else{
          var tab_arr = [];
      }

      //setCookie('tabs_count', tabs_count);
      for(var i=0;i<tabs_count-1; i++){
          if(parseInt(tab_arr[i])>i+1){
              tab_arr.splice(i,0,i+1);
              $.tab_index = i+1;
              break;
          }
      }
      if(tab_arr.length<tabs_count){
          tab_arr.push(tabs_count);
          $.tab_index = tabs_count;
      }

  }

  setTab_Index();

  if (RtmsHelper.useRtms) {
      RtmsHelper.initNotificationsSystem(callbacks);
  } else {
      init_notifications_system(callbacks);
  }

  var agentSubscribeTravelerChannels = {
    run: function() {
      presenceSubscribedChannelList = [];
      subscribePresenceTravelerOnPage();
    }
  }

  $(document).ready(function(){
    $(".user-profile-updated").hover(function(){
      $(".containerfornewueragent").hide();
      $('.agent_real_name').show();
      $(".profile_down_icon").hide();
    });
    $(".user-profile-updated").blur(function(){$(".containerfornewueragent").show();$('.agent_real_name').hide();$(".profile_down_icon").show();});
    $(".user-profile-updated").mouseleave(function(){$(".containerfornewueragent").show();$('.agent_real_name').hide();$(".profile_down_icon").show();});
    $(".account_dropdown").each(function(){
      if($(this).children().length === 1)
        $(this).addClass("showHovered");
    })

    $('.announcementLink').on('click',function(){
      sendEvent('', '', 'Annoucement link', eventClicked, '', '', '', '');
    })
  });

$('ul#top-nav li.notification-menu').on('click', function(){

  var notification_cnt = parseFloat($('#notification-count').text());

  $('.dropdown-notifications').toggle();
  //$('#notification-count').text(0);
  $('#notification-count').hide();
});


  var term = "";
  $('#global_search_field').autocomplete({
        minLength : 3,
        delay: 1000,
        html: true,
        source: function( request, response ){
          term = request.term;
          params = {term: term};

          $.get('/users/search', params,function(data){
            var count = 0;
            response($.map(data, function(item) {
              for(var empty in  item){
                count = count + 1;
              }
              return {
                  value: item.name,
                  name: item.name,
                  phone: item.phone_number,
                  trip_id: item.trip_id,
                  lead_stage: item.lead_stage,
                  trip_user_id: item.trip_user_id,
                  quote_ids: item.quote_ids,
                  quote_prices: item.quote_prices,
                  quotes_perperson: item.quotes_perperson,
                  user_name: item.user_name,
                  can_initiate_chat_with_traveler: item.can_initiate_chat_with_traveler,
                  trip_rating_color: item.trip_rating_color,
                  trip_status_text: item.trip_status_text,
                  to_loc: item.to_loc,
                  quote_currencies: item.quote_currencies
                }
            }));
            if(count == 0){
              var funnel_stage = $("#global_search_field").val();
              _gaq.push(["_trackEvent","Search","No_Result",funnel_stage]);
            }
          });
        },
        open: function () {
          // If it's not already added
          if (!$('#ac-see-all').length) {
//             Add it
            $('<li id="ac-see-all"><a target="_blank" href="/users/search?search_type=full&term=' + term + '">See All</a></li>').appendTo('ul.ui-autocomplete');
          }
        },
        select: function( event, ui ){
          return false;
        }
      }).data("ui-autocomplete")._renderItem = function( ul, item ) {

          if (item && item.trip_id) {
            var rgxp = new RegExp(term, 'gi');
            var repl = '<strong>' + term + '</strong>';
            var channel = "notification_" + item.trip_user_id + "-pnpres";
            const channelId = item.trip_user_id;

            var classToShowOnline = "online_" + channel;

            const onStatus =  isOnline => {
                const selector = `.${classToShowOnline}`;
                RtmsHelper.toggleUserAvailability({isOnline, selector});
              };
            if (RtmsHelper.useRtms) {
              RtmsHelper.subscribeRTMS({channelId, onStatus});
            } else {
              subscribePresenceTraveler(channel);
            }
            var traveler_detail_for_search = item.name;
            if(item.is_phone_shown_to_current_user) {
              traveler_detail_for_search += ", " + item.phone;
            }

            if(item.can_initiate_chat_with_traveler && item.lead_stage.indexOf("Post Stay") == -1) {
              var search_chat_element = "<div class='search-autocomplete-div-openchatwin' data-quote_ids='" + item.quote_ids + "' data-quote_prices='" + item.quote_prices + "' data-quotes_perperson='" + item.quotes_perperson + "' data-trip_id='" + item.trip_id + "' data-trip_user_id='" + item.trip_user_id + "' data-trip_user_name='" + item.user_name + "' data-trip_to_loc='" + item.to_loc + "' data-trip_status_text='" + item.trip_status_text + "' data-trip_rating_color='" + item.trip_rating_color + "' data-quote_currencies='"+ item.quote_currencies + "' data-lead_stage='" + item.lead_stage + "'><span class='chat-icon-blue'></span>Chat</div>";
              var returnvalue = $("<li class='search-autocomplete-list'" + (item.lead_stage == "Status: Cancelled" ? "style='background-color:#fbfbaf;'" : "") + "></li>")
                  .data("item.autocomplete", item)
                  .append(("<span class='" + classToShowOnline + "'></span><div class='search-autocomplete-div'><a href='/requested_trips/" + item.trip_id + "' target='_blank'>" + ("<div class='result_row_1'>" + traveler_detail_for_search + "</div>" +
                  "<div class='result_row_2'>Trip Id " + item.trip_id + "</div>").replace(rgxp, repl) +
                  "<div class='result_row_2'>" + item.lead_stage + "</div>" +
                  "</a></div>" + search_chat_element))
                  .appendTo(ul);

              if (RtmsHelper.useRtms) {
                    RtmsHelper.subscribeRTMS({channelId, onStatus});

              }
              return returnvalue;
            }
            else {
              return $("<li class='search-autocomplete-list'" + (item.lead_stage == "Status: Cancelled" ? "style='background-color:#fbfbaf;'" : "") + "></li>")
                  .data("item.autocomplete", item)
                  .append(("<div class='search-autocomplete-div'><a href='/requested_trips/" + item.trip_id + "' target='_blank'>" +  ("<div class='result_row_1'>" + traveler_detail_for_search + "</div>" +
                  "<div class='result_row_2'>Trip Id " + item.trip_id + "</div>").replace(rgxp, repl) +
                  "<div class='result_row_2'>" + item.lead_stage + "</div>" +
                  "</a></div>"))
                  .appendTo(ul);
            }
          }

          else {
            var err = new Error('Error through UI Auto_Search' + item);
            (typeof newrelic !== 'undefined') && newrelic.noticeError(err);
          }
      };

  $('#global_search_field').on('keyup', function(event){
    if(event.which == 13){
      $("#global_search_field").autocomplete("search");
    }
  });
  $("#ui-id-1").on("click", ".ui-menu-item", function(event) {
    var funnel_stage = $("#global_search_field").val();
    _gaq.push(["_trackEvent","Search","Auto_Search",funnel_stage]);
  });

  $("#search_button").click(function(){
    $("#global_search_field").autocomplete("search").focus();
    var funnel_stage = $("#global_search_field").val();
    _gaq.push(["_trackEvent","Search","Search_Icon",funnel_stage]);
  });

</script>
<style>
  span.ui-helper-hidden-accessible {
    display: none;
  }
  ul.ui-autocomplete {
    width: 286px;
    float: left;
    background-color: white;
    border: 1px solid lightgray;
    box-shadow: gray 1px 4px 17px;
    z-index: 100001;
  }
/*  ul.ui-autocomplete li {
    border-bottom: 1px solid lightgray;
    padding: 10px;
    cursor: pointer;
  }
  ul.ui-autocomplete li a{
    text-decoration: none;
  }*/

  .ui-widget-content {
    background: #fff;
  }
  ul#ui-id-1.ui-autocomplete {
    min-width: 287px;
  }
    ul.ui-autocomplete li.search-autocomplete-list.ui-menu-item {
      border-bottom: 1px solid lightgray;
      padding: 10px;
      cursor: pointer;
      display: block;
    }
    ul.ui-autocomplete li.search-autocomplete-list.ui-menu-item a{
      text-decoration: none;
    }
  li.search-autocomplete-list.ui-menu-item .ui-state-active {
        border: 0;
        background: none;
        font-weight: normal;
        color: inherit;
        margin: 0;
  }
  li.search-autocomplete-list.ui-menu-item .ui-state-active .search-autocomplete-div-openchatwin {
    color: #0000ff;
  }
  .ui-widget.ui-widget-content li.ui-menu-item a, .ui-widget.ui-widget-content li.ui-menu-item .ui-menu-item-wrapper {
      display: block;
      padding: 5px;
      font-size: 12px;
  }


  .result_row_1 {
    font-size: 12px;
    color: #6d6d6d;
  }
  .result_row_2 {
    font-size: 11px;
    color: #b6b6b6;
  }
  .result_row_1 strong, .result_row_2 strong {
    color: black;
  }
  #ac-see-all {
    text-align: right;
    font-weight: 600;
    color: #56c4c1;
  }
  .highlight1 {
    background-color: yellow;
  }
  .headerLink {
    color: #fff !important;
    font-size: 12px;
    line-height: 16px;
    font-weight: 700;
    text-decoration: none;
  }
  .notificationNumberCount {
    display: inline-block;
    font-size: 10px;
    line-height: 16px;
    min-width: 34px;
    background: #ff5959;
    color: #fff;
    text-align: center;
    border-radius: 8px;
    margin-left: 4px;
    padding: 0 4px;
  }
  .flightLinkHeader a{
  text-decoration: none;
  color: white;
  }
  .flightLinkHeader{
  line-height: 24px;
  }
</style>

<!-- agent gst ppopup -->
<!--end-->
<!--popup for intl agents-->
<!--end-->
<script>
  var wait_gscq_count = 1;
  function wait_for_gscq(){
    if (wait_gscq_count > 10) {
      console.log('getsitecontrol was not activated.');
      return;
    }
    if(typeof _gscq !== "undefined"){
      _gscq.push(['user','requested_trip_id', "5058547"]);
      _gscq.push(['user','quote_id', ""]);
        _gscq.push(['user','user_id', "278401"]);
      console.log('getsitecontrol activated successfully.');
    }
    else{
      wait_gscq_count += 1;
      console.log('getsitecontrol not yet active.');
      setTimeout(wait_for_gscq, 1000);
    }
  }

  wait_for_gscq();
</script>

<script type="text/javascript">
  function run_third_party_scripts_footer_js(){
    var email_tracking_user_id = getCookie("u_id");
    var email_tracking_url = "";
    var vcomm_email_tracking_url = "";
    var lead_tracking_url = "";

    if( (email_tracking_user_id != "") || (email_tracking_user_id != null) )
    {
      email_tracking_url = "http://tracking.icubeswire.com/GL3QJ?adv_sub=" + email_tracking_user_id;
      lead_tracking_url = "http://tracking.icubeswire.com/SL3PZ?adv_sub=" + email_tracking_user_id;
      vcomm_email_tracking_url = "https://tracking.vcommission.com/SL67x?adv_sub=" + email_tracking_user_id;

      $("#email_tracking").attr("src", email_tracking_url);
      $("#vcomm_email_tracking").attr("src", vcomm_email_tracking_url);
      $("#lead_tracking").attr("src", lead_tracking_url)
    }
  }

    document.addEventListener("AfterWindowLoadJS", function(){
    run_third_party_scripts_footer_js();
  });
</script>

<script>
  function fbq_event_trigger(event) {
    fbq('track', "CustomEvent", {event: event});
  }

</script>



<!-- This code will only be fired when on customiztion form after trip is created -->

<!-- If you have to put any third party JS then place it at the top as
          ADWORDS CODE HAS TO BE AT THE BOTTOM
-->

<script>
  function fbq_event_trigger(event) {
      fbq('track', "CustomEvent", {event: event});
  }
</script>


</body>
</html>

<!-- User tracking data -->
<script>
  window.inlineManualTracking = {
    uid: "278401", // Only this field is mandatory
    email: "john@doe.com",
    username: "johndoe",
    name: "John Doe",
    created: 1360610467,
    updated: 1433168312,
    roles: ["admin", "editor"],
    group: "Doe & Partners Inc.",
    plan: "Gold"
  }
</script>
<!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-MKM4NX"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MKM4NX');
    $(".search-autocomplete-div-openchatwin").live('click',function(event){
      event.preventDefault();
      var search_trip_id = this.getAttribute("data-trip_id");
      var search_trip_user_id = this.getAttribute("data-trip_user_id");
      var search_trip_user_name = this.getAttribute("data-trip_user_name");
      var search_quote_ids = this.getAttribute("data-quote_ids") ? this.getAttribute("data-quote_ids").split(',') : [];
      var search_quote_prices = this.getAttribute("data-quote_prices") ? this.getAttribute("data-quote_prices").split(',') : [];
      var search_quote_perperson = this.getAttribute("data-quotes_perperson") ? this.getAttribute("data-quotes_perperson").split(',') : [];
      var search_q_id = search_quote_ids.length == 0 ? -1 : search_quote_ids[0];
      var to_loc = this.getAttribute("data-trip_to_loc");
      var trip_status_text = this.getAttribute("data-trip_status_text");
      var trip_rating_color = this.getAttribute("data-trip_rating_color");
      var search_quote_currencies = this.getAttribute("data-quote_currencies") ? this.getAttribute("data-quote_currencies").split(',') : [];
      showChatInAgentDashboard(null, search_trip_id, 278401, search_trip_user_id, search_trip_user_name, search_q_id, search_quote_ids, search_quote_prices, search_quote_perperson, trip_status_text, trip_rating_color, to_loc, search_quote_currencies);

        _gaq.push(["_trackEvent","Chat","Global Search", search_trip_id + "|" + this.getAttribute("data-lead_stage") + "|" + to_loc ]);

    });

</script>
<script src="https://assets.traveltriangle.com//assets/fingerprint-8197f6576a7a7f6f3201428fbb86c54a.js" type="text/javascript"></script>
<!-- End Google Tag Manager -->
<script type="text/javascript">
      if (getCookie('u_name') != 'Admin' && getCookie('u_role') != 'agent' )
  {
      var is_page_refresh = false;

      var event_map = [];
      var count_timer = 0;
      var track_url = "/track_user_activities"; // home_controller => track_user_activities
        $(document).ready(function(e) {
      $('a').on('click', function() { is_page_refresh = true; }); 
      $('form').on('submit', function() { is_page_refresh = true; });
      $("input[type=submit]").on("click", function() {is_page_refresh = true;});

      if ((fingerprint = getCookie('fingerprint')) == null){
        fingerprint = new Fingerprint().get();
      }
      
      $(document).ready(function(e) { // DOUBT: why are we including $(document).ready inside $(document).ready
        var key=e.which || e.keyCode;
        if (key == 116) //F5
        {
          is_page_refresh = true;
          event_map.push(key);
        }

        onkeydown = onkeyup = function(e){ // Ctrl + R
          e = e || event; // to deal with IE
          // 17 => Control Key, 82 => r/R Key
          if (e.keyCode == 17 || e.keyCode == 82){ event_map.push(e.keyCode);}
        }

        get_browsering_data();
        tabs_count = getCookie('tabs_count');
        if ((tabs_count == null) || (tabs_count == NaN) || (tabs_count == 'NaN') || (parseInt(tabs_count) < 0)){
          tabs_count = 1;
        }
        else{
          tabs_count = parseInt(tabs_count) + 1;
          console.log("tabs count incremented from position 1: " + tabs_count);
        }

        setCookie('tabs_count', tabs_count);
        $(window).bind('beforeunload', function(eventObject) {
            tabs_count = getCookie("tabs_count");
            tabs_count = parseInt(tabs_count) - 1; // since this page in going to be closed, hence reduce tabs_count by 1
            setCookie("tabs_count", tabs_count);


          // if user pressed ctrl+r or F5 then it is a page refresh
          if ((event_map.indexOf(17) != -1 && event_map.indexOf(82) != -1) || (event_map.indexOf(116) != -1)){
            is_page_refresh = true;
          }
          
          get_browsering_data();
          update_cookie();
          var result = get_id_or_fingerprint();
          var id = result[0];
          var type = result[1];
          // the condition "parseInt(tabs_count) == 0" makes sure that the data gets sent to the server only when
          // the last tab is closed in case the user has opened multiple tabs
          if (!is_page_refresh && parseInt(tabs_count) == 0  && type != 'fingerprint'){
              $.ajax({
                      url: track_url,
                      async: false,
                      cache: false,
                      success: null,
                      global: false,
                      data: {data: getCookie(id), id: id, type: type}
              });
            setCookie(id, "");
            // TODO : trip cookie should probably be set to "" here
          }
          event_map = [];
          return ;
        });
      });
      });
  }
var browering_urls = {}; 
// this variable comes in scope on page load and retains its values until page unload
// this variable also handles the case when same url is opened in multiple tabs since it will be unique for each tab
// value of browering_urls is updated by get_browsering_data on page load and unload
// function update_cookie then uses its values to set cookies at page unload 

function get_id_or_fingerprint () {
  var id = getCookie('u_id');
  if (id == "" || id == null ){
    return [fingerprint, "fingerprint"];
  }
  return [id, "u_id"];
}

function get_browsering_data(){
  // this function gets called on page load and also on page unload
  var url = get_url();
  var d = new Date();
  var h = {};
  if (browering_urls[url] == undefined){
    // on page load set values for open_time and time_spend
    h['open_time'] = d;
    h['time_spend'] = 0;
    browering_urls[url] = h;
  }
  else{
    // on page unload calculate and set time_spend value on this page
    browering_urls[url]['time_spend'] = (d - browering_urls[url]['open_time'])/1000; // convert in seconds
  }

}

function get_url () {
  var url = window.location.pathname;
  var search_params = window.location.search
  if (search_params != "") {
    search_params = search_params.split('&').join('__')
    url = url + search_params;
  };
  url = url.replace(/[;&\\\#,+()$~%.'":*?<>{}]/g, '___');
  // Hnadling special characters bcoz special characters breaking things on server params;
  return url;
}

function update_cookie () {
  var url = get_url();
  var result = get_id_or_fingerprint();
  var brow_url = browering_urls[url];
  var id = result[0];

  // Map before logged in data against user id (when user register wid us)
  var type = result[1];
  if (type != 'fingerprint'){
    // Get previous data (before loggin)
    var f_print = getCookie('fingerprint');
    var predata = getCookie(f_print);
    if (predata != "" && predata != null){
      predata = parseJSONFromString(predata);
      var temp = {};
      Object.keys(predata).forEach(function (k) {
        d = k.split('XX');
        new_key = id + 'XX' +d[1];
        temp[new_key] = predata[k];
      }) ;
      setCookie(id, JSON.stringify(temp));
      setCookie(f_print, "");
    }
  }

  var r = getCookie(id);
  url = id + 'XX' + url;
  if (r == null || r == "" ){
    // console.log("first time set cookie")
    var h = {};
    var h1 = {};
    h1['open_time'] = [brow_url['open_time']];
    h1['time_spend'] = [brow_url['time_spend']];

    h[url] = h1;
    setCookie(id, JSON.stringify(h));
  }
  else if (r != null && r != ""){
    r = parseJSONFromString(r);
    if (r[url] != null ){
      r[url]['open_time'].push(brow_url['open_time']);
      r[url]['time_spend'].push(brow_url['time_spend']);
      setCookie(id, JSON.stringify(r));  
      //console.log("update_cookie");
    }
    else{
      var h1 = {};
      h1['open_time'] = [brow_url['open_time']];
      h1['time_spend'] = [brow_url['time_spend']];
      r[url] = h1;
      setCookie(id, JSON.stringify(r));
    }
  }
}

function parseJSONFromString(str){
  var obj;
  try {
    obj = jQuery.parseJSON(str);
  }
  catch(err){
    var newStr = str.slice(0,str.lastIndexOf(','));
    obj = jQuery.parseJSON(newStr+"}");
  } 
  return obj;
}
// Visitor tracking ends here

var _gaq = _gaq || [];

function load_top_menu(){
  var c_user_name = getCookie("u_name");
  var c_user_role = getCookie("u_role");
  var is_admin = (c_user_role != undefined && c_user_role == "admin" ) ? true : false
  var is_agent = (c_user_role != undefined && c_user_role == "agent" ) ? true : false
  var is_logged_in = (c_user_name != undefined && c_user_name != "") ? true : false
  var user_mail_id = getCookie("u_email");
  var user_phone_no = getCookie("user_phone_no");
  var current_user_id = getCookie("u_id");
  var tt_referer = getCookie("ttr_id");
  var tt_mailer = getParameterByName("tt_mailer");
  var tracking_code='UA-15374527-10';
  var fingerprint = getCookie("fingerprint");
  var subaccount_user_id=getCookie("u_sid");

  if (fingerprint == null)
  {
    fingerprint = new Fingerprint().get();
    setCookie("fingerprint",fingerprint, 365);
  }

  if (is_logged_in) //loggedin user
  {
    c_user_name = c_user_name.replace(/['+']+/g, " ");
    $(document).ready(function(){
  $(".Maintopnavi").html("<div class=\"Dashboardothernavi\">\n  <span>Welcome <b id=\"u_name\">Fly Paradise Tours And Travels<\/b>&nbsp;&nbsp;|&nbsp;&nbsp;<a href=\'/refer-your-friends\' data-remote=\"true\">Refer a Friend<\/a>  &nbsp;&nbsp;|&nbsp;&nbsp;<a href=\"#customer-support\">Customer Support<\/a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href=\"/dashboard\">My Dashboard<\/a>&nbsp;&nbsp;|<\/span>\n<\/div>    \n<div class = \'Dashboardothernavi\' id=\'account_link\'>\n  <span><ul class=\'sf-menu sf-js-enabled sf-shadow\'>\n   <li class=\"first\">\n     My Account\n     <ul id=\'settings\' class = \'menu sf-js-enabled\' style=\"visibility: hidden; display:none;\">\n      <li class=\'\'><a href=\"/users/edit\">Edit Account<\/a><\/li>\n      <li class=\'\'><a href=\"/users/edit\">Change Password<\/a><\/li>\n      <li class=\'\'><a href=\"/users/sign_out\">Sign out<\/a><\/li>\n     <\/ul>\n    <\/li>\n  <\/ul><\/span>\n<\/div>\n");

  $('.link_cust_support').on('click', function(){
    if(location.href != '/'){
      window.location = '/#customer-support';
    }
  });

  //$('.logout').click(function(){
    //destroyChatCookies();
  //});
  try{
    $("#account_link ul").superfish();
  } catch(e){}
  var updownflag = 1;
  
  $("#accountdd").click(function(){
      $( this).parent().next().toggle();
      if (updownflag == 1 ) {
        $(this).children("span").removeClass("ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-n");
        $(this).parent().addClass('white').removeClass('normal');
        updownflag = 0;
      }
      else{
        $(this).children("span").removeClass("ui-icon-triangle-1-n").addClass("ui-icon-triangle-1-s");
        $(this).parent().removeClass('white').addClass('normal');
        updownflag = 1;
      }
  });
  
  $('li.ddchoice').click(function() {
        window.location = $('a', this).attr('href');
    });
  
  $(document).mousedown(function(e) {
     if (!$(e.target).closest('.ddchoice').length && !$(e.target).closest('#accountdd').length && updownflag == 0)
       		$("#accountdd").trigger('click');
  });
  
});

    // google analytics
    if (is_admin)
    {
      tracking_code='UA-15374527-9';
    }
    else if (is_agent)
    {
      tracking_code='UA-15374527-8';
    }
    $("#u_name").text(c_user_name);

    if (!is_admin)
    {
      if (typeof(user_mail_id) != 'undefined' && $("#usr_email").val() == ""){
        $("#usr_email").val(user_mail_id);
      }
      if (typeof(user_phone_no) != 'undefined' && $(".phone_field").val() == ""){
        $(".phone_field").val(user_phone_no);
      }
      _gaq.push(['_setCustomVar', 2, 'UserID',(current_user_id && is_agent && subaccount_user_id) ? subaccount_user_id : current_user_id, 2]);
    }
    else if (tt_referer != undefined || tt_referer != "" )
    {
      _gaq.push(['_setCustomVar', 1, 'from_referer', tt_referer, 2]);
    }
    var arr = ["/", "/trips/", "/travel-to/"];
    var ref = window.location.pathname;

    if ( arr.indexOf(ref) && jQuery.isFunction(window.facebook_login_disable))
    {
      facebook_login_disable();
    }

  }
  else
  {
    $(document).ready(function(){
      $(".Maintopnavi").html("<div class=\"Signinsingup\">\n  <a href=\"/online-leads-for-travel-agents\">Travel Agent? - Get leads<\/a> &nbsp;&nbsp;|&nbsp;&nbsp; \n  <a href=\'/refer-your-friends\' data-remote=\"true\">Refer a Friend<\/a>  &nbsp;&nbsp;|&nbsp;&nbsp; \n  <a href=\'/users/sign_up\'>Sign Up<\/a>  &nbsp;&nbsp;|&nbsp;&nbsp; \n  <a href=\"/\" class=\"signin\">Sign In<\/a>\n\n  <script>\n//  console.log(\"JS Loaded!!\");\n  //  var jQueryTemp = jQuery.noConflict(true);\n //   var jQueryOriginal = jQuery || jQueryTemp;\n<\/script>\n<script type=\"text/javascript\">\n    // Restore original jQuery:\n   // window.jQuery = window.$ = jQueryOriginal;\n<\/script>\n\n<fieldset id=\"signin_menu\">\n  <form accept-charset=\"UTF-8\" action=\"/users/sign_in\" class=\"new_user\" id=\"new_user\" method=\"post\"><div style=\"margin:0;padding:0;display:inline\"><input name=\"utf8\" type=\"hidden\" value=\"&#x2713;\" /><input name=\"authenticity_token\" type=\"hidden\" value=\"iDFjdQQhR2kReB8A5QUpAZtGOyH9c/iBXbFEbBdSOHE=\" /><\/div>\n     <input id=\"next\" name=\"next\" type=\"hidden\" value=\"/requested_trips/5058547-Ashwani-Kumar\" />\n    <p>\n      <label for=\"user_email\">Email<\/label>\n\n      <input class=\"email_regex suggestedemail_class\" id=\"usr_email\" name=\"user[email]\" size=\"30\" type=\"text\" value=\"\" />\n      <div id=\"email_suggestion\"  class= \"email_suggestion\"\n           style=\"font-size: 12px; text-align: right;\n                   word-wrap: break-word;\"><\/div>\n    <\/p>\n    <p>\n      <label for=\"user_password\">Password<\/label>\n      <input id=\"user_password\" name=\"user[password]\" size=\"30\" type=\"password\" />\n    <\/p>\n    <p class=\"remember\">\n      <input id=\"signin_submit\" name=\"commit\" type=\"submit\" value=\"Sign in\" />\n      <input name=\"user[remember_me]\" type=\"hidden\" value=\"0\" /><input id=\"user_remember_me\" name=\"user[remember_me]\" type=\"checkbox\" value=\"1\" /> \n      <label for=\"user_remember_me\">Remember me<\/label>\n    <\/p>\n    <p class=\"forgot-username\"> \n      <a href=\"/users/password/new\">Forgot your password?<\/a>\n    <\/p>\n    <hr />\n    <div>\n      <a class=\"zocial facebook auth_provider\" href=\"/auth/facebook\">\n        Sign in with Facebook\n      <\/a>\n      <br/><br/>\n      <a class=\"zocial googleplus auth_provider\" href=\"/auth/google_oauth2\">\n        Sign in with Google\n      <\/a>\n  <\/div>\n<\/form><\/fieldset>\n\n<\/div><!--sign in and signup block-->\n");

      $(".signin").click(function(e) {
         e.preventDefault();
         $("fieldset#signin_menu").toggle('slow');
       });

       $("fieldset#signin_menu").mouseup(function() {
         return false;
       });

       $(document).mouseup(function(e) {
         //if($(e.target).parent("a.signin").length==0) {
         if(!$(e.target).hasClass('signin')){
           $(".signin").removeClass("menu-open");
           $("fieldset#signin_menu").hide('slow');
         }
       });

    });
    _gaq.push(['_setCustomVar', 2, 'UserID', fingerprint, 2]);
  }
  // common google analytics code
  _gaq.push(['_setAccount', tracking_code ]);
  _gaq.push(['_trackPageview']);
  setTimeout("_gaq.push(['_trackEvent', '10_seconds', 'read'])",10000);
  if ( tt_mailer !== undefined || tt_mailer !== "" )
  {
    _gaq.push(['_setCustomVar', 1, 'from_mailers', tt_mailer, 2]);
  }

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  
  $("#notice").hide();


  var referer = getParameterByName("referer");
  if (typeof(referer) != 'undefined' && referer != "" ) {
    $("#referer").val(referer);
    var old_referer = getCookie('referer');
    if ( old_referer == null) {
      setCookie('referer', referer);
    }else if (old_referer.indexOf(referer) == -1) {
      setCookie('referer', old_referer+"__"+referer)
    }
  }

  
}
if (window.location.search.indexOf('new_ui=true') >= 0) {
  setCookie("new_ui", true);
}else if (window.location.search.indexOf('utm_expid') >=0 || window.location.search.indexOf('utm_campaign=EXP-Andaman-DOM') >= 0 || window.location.search.indexOf('Hon_Gen_ProdTest') >= 0 || window.location.search.indexOf('utm_campaign=EXP-KERALA-DOM') >= 0 || window.location.search.indexOf('utm_campaign=EXP-KASHMIR-DOM') >= 0) {
  setCookie("old_ui", true);
}
var new_ui = getCookie("new_ui");
if (new_ui == "true"){
  _gaq.push(['_setCustomVar', 3, 'ui_type', "new_ui", 1]);
}
var old_ui = getCookie("old_ui");
if (old_ui == "true"){
  _gaq.push(['_setCustomVar', 3, 'ui_type', "old_ui", 1]);
}

$(document).ready(function(){
  $(document).ready(function(){
	var server_call = eval(getCookie("s_call")); 
  if (server_call == null || server_call == undefined || server_call == false)
  {
    var tt_rid = getParameterByName('tt_rid');
    $.get("/get_top_menu.js?ref=/requested_trips/5058547-Ashwani-Kumar&notice=&tt_rid="+tt_rid);
  }
  else
  {
    setTimeout(load_top_menu,0)
  }
});

});

</script>


<script type="text/javascript">
  var now = new Date();
  var expires = (now.getTime() + (365*24*60*60*1000)); //expires 365 dayController from now
  now.setTime(expires);
  document.cookie="landing=1; expires=" + now.toGMTString() + "; path=/";
  $(document).ready(function(){
    $(".agentFundingBannerClose").click(function(){$(".agentFundingBanner").hide()});
    $('#notification-count').hide();
    document.dispatchEvent(new Event('domCustomLoaded'));
    // var notification_cnt = parseFloat($('#notification-count').text());
    // if(isNaN(notification_cnt) || notification_cnt == 0)
    // {
    //   $('.details_div_con').prepend(getNotificationHTMLRow());
    // }

    var winWidth = $(window).width();
    if(winWidth>=1199)
    {
      $(".navicon").hide();
      $(".navicon-colomn").hide();
    }
    /*$(".task-info").each(function(i,element){
       if(element.innerText.trim().length){
          $(element).addClass("text-avaialable");
       }else{
          $(element).addClass("text-not-avaialable");
          $(element).parent().addClass("middle-align");
       }
    })*/

   /* if($("#logo")){
      $(".navicon-colomn").hide();
    }*/


  });

  $(window).resize(function() {
    var winWidth = $(window).width();
    if(winWidth>=1199)
    {
      $(".navicon").hide();
      $(".navicon-colomn").hide();
      var winW = $(window).width();
      if (winW >= 1199) {
        var headerH = $("#header").outerHeight();
        var headerH_2 = 0;
        if ($("#header_2").length) {
          headerH_2 = $("#header_2").outerHeight();
        }
        var leftPanelTopPos ;
        if($("#mask").css("display")=='block'){
          leftPanelTopPos=0;
        }
        else
          leftPanelTopPos = headerH + headerH_2;

        var leftPanelH = $("#left-panel").outerHeight();

        $("#left-panel").css({
          "top": 0,
          "height": 700,
          "min-height": 700
        });

      }
      $("#dropdown-filter-wrap").removeClass("tabview");
    }
    else
    {
      $("#dropdown-filter-wrap").addClass("tabview");
      $(".navicon-colomn").show();
      $(".navicon").show();
    }

  });

   function live_ticker_ga(funnel_stage,trip_status,destination){
        _gaq.push(["_trackEvent","Live ticker","Ticker", (funnel_stage+'|'+ destination+'|'+trip_status)]);
    }
    $("#logo").on('click',function(){
      _gaq.push(["_trackEvent","GLobal_Icon ","Icon_home","TT logo"]);
    });
    $("#accounts_link").on('click', function(){
      var stage_funnel = $(this).text();
      _gaq.push(["_trackEvent","TopNav ","Accounts",stage_funnel]);
    });
  /*$("#commission_link").on('click', function(){
    var stage_funnel = $(this).text();
    _gaq.push(["_trackEvent","TopNav ","Commission_Invoices",stage_funnel]);
  });*/



$( document ).ready(function() {
  $( ".add-note-small-btn" ).live("mouseover",function() {
    var windowHeight = window.innerHeight;
    var btnTop =  $(this)[0].getClientRects()[0].top;
    var btm = windowHeight - btnTop;
    console.log(btm);
    if(btm <= 216){
      console.log("if me gya");
       $(this).parent().find(".add-note-set-reminder-small-view").css('margin','-236px auto 0');
    }
    else{
      $(this).parent().find(".add-note-set-reminder-small-view").css('margin','0 auto');
    }
  });
});

$(".notification-menu").on('click', function(){
  var stage_funnel = $("#notification-count").text();
  if(stage_funnel != "0"){
    _gaq.push(["_trackEvent","Notification ","Notification_new_lead",stage_funnel]);
  }
  else{
    _gaq.push(["_trackEvent","TapNav ","Notification_icon",stage_funnel]);
  }
});
    $("#account_commission li").on('click', function(){
      var stage_funnel = $(this).text();
      _gaq.push(["_trackEvent","TapNav ","Accounts",stage_funnel]);
    });

    $(".rightlinkorcontainere").click(function(e){
      $(".containeronhovermain").toggle();
      e.preventDefault();
    });
  $("body").click(function(evt){
    if(evt.target.id != "app_download_link" && evt.target.id != "app_download_box"){
      $(".containeronhovermain").hide();
    }
  });
function prependlastThreeNotifications(data){
  arr  = [];
  for(i =0;i<data.length;i++){
    arr.push(getNotificationHTMLRow(data[i].notification_sub_category, data[i].notification_category, data[i].data.trip_id, data[i].data.quote_id, data[i].message, data[i].created_at, data[i].data.url, data[i].data.trip_status, data[i].data.trip_rating_color, null, data[i].data.create_invoice_url, data[i].id, data[i]))
  }
  return arr
}
$(document).ready(function(){
  var notif = []
  if($('.details_div_con_main').length ==0)
  {
    $.ajax({
        url: '/agents/notifications_show',
        method: 'GET',
        data: {latest_three : 1},
        dataType: 'json',
        async: false,
        success: function (msgData) {
          if (msgData!=null && msgData!=[]){
            notif = prependlastThreeNotifications(msgData)
          }
        }
    });
  }
  $('.details_div_con').append(notif);
  //showlastThreeNotifications();
});
$(document).click(function(e){
  var container = $(".dropdown-notifications");
  var well_container = $(".notification-menu");
  if (!container.is(e.target) && container.has(e.target).length === 0 && !well_container.is(e.target) && well_container.has(e.target).length === 0)
    {
        container.css("display", "none");
    }
});

  $(document).keyup(function(e) {
    var container = $(".dropdown-notifications");
    if (e.keyCode === 27) {
      container.css("display", "none");
    }
  });

$(document).ready(function(){
  var is_show_security_doc = false;
  var is_small_view = false;
  if(is_show_security_doc){
    $(".security-feature-doc").show();
    if(is_small_view){
      $(".security-feature-doc").css("padding-left", "349");
    }
  }
  else{
    $(".security-feature-doc").hide();
  }
});


// escalation matrix js
$(".questionMarkButton").click(function(){
  $('.hover_bkgr_fricc2').show();
});

$(".trigger_popup_fricc").click(function(){
  $('.hover_bkgr_fricc').show();
  _gaq.push(['_trackEvent', 'Escalation', 'help-icon_clicked']);
});

$('.popupCloseButton').click(function(){
  $('.hover_bkgr_fricc2').hide();
});

$('.js-showContacts').click(function(){
  $('.js-managersListLayer').hide();
});

$(document).ready(function(){

  $('.js-tabs-options li').click(function(){
    var tab_id = $(this).attr('data-tab');

    $('.js-tabs-options li').removeClass('current');
    $('.tab-content').removeClass('current');

    $(this).addClass('current');
    $("#"+tab_id).addClass('current');

    _gaq.push(['_trackEvent', 'Escalation', 'tab-clicks_clicked']);
  });

  $('.js-adjacent-tab').click(function(){
    $(".js-yourConcern").removeClass('current');
    $("#yourConcern").removeClass('current');

    $('.js-contactManagers').addClass('current');
    $("#contactManagers").addClass('current');

    _gaq.push(['_trackEvent', 'Escalation', 'adjacent-tab_clicked']);
  });

  var pageNameMap = {
      "rf": "Rapid Fire",
      "requirment": "Create Quote",
      "quote": "Quotation FollowUp",
      "payment": "Voucher & Payment",
      "during-stay": "During Stay",
      "post-stay": "Post Stay"
  };

  $('title').bind("DOMSubtreeModified", function(e){
    var additionalText = pageNameMap[window.location.hash.substr(1)];
    if (additionalText) {
      var pageName = $('meta[name=page_fullname]').attr('content') + "-" + additionalText;
      var page_info_json = PageView.get_page_info();
      page_info_json["page_fullname"] = PageView.getCompleteClient() + GlobalConfig.eventURISeparator + pageName;
      AnalyticsWrapper.page_view(page_info_json["page_name"], page_info_json, {});
    }
  });

});

  function checkIfQuoteIsDownloadedForAgent(quote_id, do_not_show_loader, cnt){

      if(cnt === 4){
          // remove current quote_id from cookies
          var existing_quote_ids = JSON.parse(getCookie('agent_quote_dwnld_polling_rqst'));
          var index = existing_quote_ids.indexOf(quote_id);
          if (index > -1) {
              existing_quote_ids.splice(index, 1);
          }
          setCookie('agent_quote_dwnld_polling_rqst', JSON.stringify(existing_quote_ids), 1);
          console.log('3 Checks completed. Blocking polling. Removed current quote id from cookie', quote_id, getCookie('agent_quote_dwnld_polling_rqst'));

          return;
      }

      // Do not show loader when polling
      if (do_not_show_loader){
          avoidLoadingOnPage(false);
      }

      $.post('/quotes/' + quote_id + '/check_quote_download.pdf', function(data) {
          if (data['success'] === true){
              console.log('Polling: Quote ', quote_id, ' downloaded successfully.');

              // remove current quote_id from cookies
              var existing_quote_ids = JSON.parse(getCookie('agent_quote_dwnld_polling_rqst'));
              var index = existing_quote_ids.indexOf(quote_id);
              if (index > -1) {
                  existing_quote_ids.splice(index, 1);
              }
              setCookie('agent_quote_dwnld_polling_rqst', JSON.stringify(existing_quote_ids), 1);
              console.log('Removed current quote id from cookie', quote_id, getCookie('agent_quote_dwnld_polling_rqst'));

              // change 'Get Quote' button to 'Download Quote'
              var url = "quotes/" + quote_id + "/download_quote.pdf?download_quote=true";
              $('#get-quote-div-' + quote_id).hide();
              $('#download-quote-div-' + quote_id).html('<a href=/' + url + ' target="_blank" class="js_ga_quotation_followup_clicks no-text-underline-quote" data-ga-action="Download">\n' +
                  '                  <span class="sprite-DownloadAsPDF_grey1 sprite-agent">\n' +
                  '                 </span>\n' +
                  '\n' +
                  '                  Download Quote\n' +
                  '                </a>');

              // Unbind show loader
              avoidLoadingOnPage(true);

              // download file
              window.location.href = data['download_url'];
          } else {

              // Unbind show loader
              avoidLoadingOnPage(true);

              console.log('Polling: To check if quote ', quote_id, ' is downloaded.', cnt);
              setTimeout(function() {
                  checkIfQuoteIsDownloadedForAgent(quote_id, true, cnt+1);
              }, 15000);
          }
      });
  }

  if(getCookie('agent_quote_dwnld_polling_rqst')){
      var quote_ids = JSON.parse(getCookie('agent_quote_dwnld_polling_rqst'));
      quote_ids.forEach(function (quote_id){
          checkIfQuoteIsDownloadedForAgent(quote_id, true, 1);
      });
  }

  function checkIfInvoiceIsDownloadedForAgent(invoice_id, do_not_show_loader, cnt){

      if(cnt === 4){
          // remove current invoice_id from cookies
          var existing_invoice_ids = JSON.parse(getCookie('agent_invoice_dwnld_polling_rqst'));
          var index = existing_invoice_ids.indexOf(invoice_id);
          if (index > -1) {
              existing_invoice_ids.splice(index, 1);
          }
          setCookie('agent_invoice_dwnld_polling_rqst', JSON.stringify(existing_invoice_ids), 1);
          console.log('3 Checks completed. Blocking polling. Removed current invoice id from cookie', invoice_id, getCookie('agent_invoice_dwnld_polling_rqst'));

          return;
      }

      // Do not show loader when polling
      if (do_not_show_loader){
          avoidLoadingOnPage(false);
      }

      $.post('/invoices/' + invoice_id + '/check_invoice_download.pdf', function(data) {
          if (data['success'] === true){
              console.log('Polling: Invoice ', invoice_id, ' downloaded successfully.');

              // remove current invoice_id from cookies
              var existing_invoice_ids = JSON.parse(getCookie('agent_invoice_dwnld_polling_rqst'));
              var index = existing_invoice_ids.indexOf(invoice_id);
              if (index > -1) {
                  existing_invoice_ids.splice(index, 1);
              }
              setCookie('agent_invoice_dwnld_polling_rqst', JSON.stringify(existing_invoice_ids), 1);
              console.log('Removed current invoice id from cookie', invoice_id, getCookie('agent_invoice_dwnld_polling_rqst'));

              // change 'Get Invoice' button to 'Download Invoice'
              var url = "invoices/" + invoice_id + "/download_invoice.pdf?download_invoice=true";
              $('#get-invoice-div-' + invoice_id).hide();
              $('#download-invoice-div-' + invoice_id).html('<a href="' + data['download_url'] + '" target="_blank" class="js_ga_quotation_followup_clicks no-text-underline-invoice flex flexDColumn alignCenter" data-ga-action="Download">\n' +
                  '                  <span class="sprite-agent sprite-for-download-second">\n' +
                  '                 </span>\n' +
                  '\n' +
                  '                <span>  Download Invoice\n</span>' +
                  '                </a>');

              // Unbind show loader
              avoidLoadingOnPage(true);
              $("#notice-msg").text("Your requested invoice is downloaded.")
              $(".notice").show()
              // download file
              window.location.href = data['download_url'];
          } else {

              // Unbind show loader
              avoidLoadingOnPage(true);

              console.log('Polling: To check if invoice ', invoice_id, ' is downloaded.', cnt);
              setTimeout(function() {
                  checkIfInvoiceIsDownloadedForAgent(invoice_id, true, cnt+1);
              }, 15000);
          }
      });
  }

  if(getCookie('agent_invoice_dwnld_polling_rqst')){
      var invoice_ids = JSON.parse(getCookie('agent_invoice_dwnld_polling_rqst'));
      invoice_ids.forEach(function (invoice_id){
          checkIfInvoiceIsDownloadedForAgent(invoice_id, true, 1);
      });
  }
  
</script>
